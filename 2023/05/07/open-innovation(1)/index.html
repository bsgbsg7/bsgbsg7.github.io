<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Open Innovation（software） | Bsgbsg7's World</title><meta name="author" content="Bsgbsg7"><meta name="copyright" content="Bsgbsg7"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="1.选题与要求个人图书馆 需求：（1）实现图书的增删改查；图书的信息包括：id, 书名、出版社、分类号、ISBN号、出版日期、价格、购买日期；可以按照书名、出版社等检索分页展示图书列表（2）实现简单的借出、归还管理。（图书表可以增加是否在架字段）同时要有借还日志(增加一个借还历史表，每次借和还占用一条记录，字段有：图书的id，借出时间、归还时间、借阅人)（3）借还历史日志的分页查询展示  考核内容">
<meta property="og:type" content="article">
<meta property="og:title" content="Open Innovation（software）">
<meta property="og:url" content="http://example.com/2023/05/07/open-innovation(1)/index.html">
<meta property="og:site_name" content="Bsgbsg7&#39;s World">
<meta property="og:description" content="1.选题与要求个人图书馆 需求：（1）实现图书的增删改查；图书的信息包括：id, 书名、出版社、分类号、ISBN号、出版日期、价格、购买日期；可以按照书名、出版社等检索分页展示图书列表（2）实现简单的借出、归还管理。（图书表可以增加是否在架字段）同时要有借还日志(增加一个借还历史表，每次借和还占用一条记录，字段有：图书的id，借出时间、归还时间、借阅人)（3）借还历史日志的分页查询展示  考核内容">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/head.jpg">
<meta property="article:published_time" content="2023-05-07T02:31:04.919Z">
<meta property="article:modified_time" content="2023-05-07T08:38:08.004Z">
<meta property="article:author" content="Bsgbsg7">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/head.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2023/05/07/open-innovation(1)/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="/My%20Blog" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: {"limitDay":600,"position":"top","messagePrev":"此文章已经有","messageNext":"没有更新了, 内容可能已经比较旧啦。"},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":200},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: Bsgbsg7","link":"链接: ","source":"来源: Bsgbsg7's World","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Open Innovation（software）',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-05-07 16:38:08'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/style.css?1"><link rel="stylesheet" href="/css/emoji.css?1"><div id="myscoll"></div><svg aria-hidden="true" style="position:absolute; overflow:hidden; width:0; height:0"><symbol id="icon-sun" viewBox="0 0 1024 1024"><path d="M960 512l-128 128v192h-192l-128 128-128-128H192v-192l-128-128 128-128V192h192l128-128 128 128h192v192z" fill="#FFD878" p-id="8420"></path><path d="M736 512a224 224 0 1 0-448 0 224 224 0 1 0 448 0z" fill="#FFE4A9" p-id="8421"></path><path d="M512 109.248L626.752 224H800v173.248L914.752 512 800 626.752V800h-173.248L512 914.752 397.248 800H224v-173.248L109.248 512 224 397.248V224h173.248L512 109.248M512 64l-128 128H192v192l-128 128 128 128v192h192l128 128 128-128h192v-192l128-128-128-128V192h-192l-128-128z" fill="#4D5152" p-id="8422"></path><path d="M512 320c105.888 0 192 86.112 192 192s-86.112 192-192 192-192-86.112-192-192 86.112-192 192-192m0-32a224 224 0 1 0 0 448 224 224 0 0 0 0-448z" fill="#4D5152" p-id="8423"></path></symbol><symbol id="icon-moon" viewBox="0 0 1024 1024"><path d="M611.370667 167.082667a445.013333 445.013333 0 0 1-38.4 161.834666 477.824 477.824 0 0 1-244.736 244.394667 445.141333 445.141333 0 0 1-161.109334 38.058667 85.077333 85.077333 0 0 0-65.066666 135.722666A462.08 462.08 0 1 0 747.093333 102.058667a85.077333 85.077333 0 0 0-135.722666 65.024z" fill="#FFB531" p-id="11345"></path><path d="M329.728 274.133333l35.157333-35.157333a21.333333 21.333333 0 1 0-30.165333-30.165333l-35.157333 35.157333-35.114667-35.157333a21.333333 21.333333 0 0 0-30.165333 30.165333l35.114666 35.157333-35.114666 35.157334a21.333333 21.333333 0 1 0 30.165333 30.165333l35.114667-35.157333 35.157333 35.157333a21.333333 21.333333 0 1 0 30.165333-30.165333z" fill="#030835" p-id="11346"></path></symbol></svg><meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="/atom.xml" title="Bsgbsg7's World" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/head.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">16</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 小窝</span></a></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fas fa-book-open"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 休闲</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fas fa-link"></i><span> 社交</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-user-group"></i><span> 友人</span></a></li><li><a class="site-page child" href="/message/"><i class="fa-fw fas fa-envelope"></i><span> 留言</span></a></li></ul></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fas fa-heart"></i><span> 个人</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/bibi/"><i class="fa-fw fas fa-face-laugh-wink"></i><span> 叨叨</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-paper-plane"></i><span> 关于</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="Bsgbsg7's World"><span class="site-name">Bsgbsg7's World</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 小窝</span></a></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fas fa-book-open"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 休闲</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fas fa-link"></i><span> 社交</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-user-group"></i><span> 友人</span></a></li><li><a class="site-page child" href="/message/"><i class="fa-fw fas fa-envelope"></i><span> 留言</span></a></li></ul></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fas fa-heart"></i><span> 个人</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/bibi/"><i class="fa-fw fas fa-face-laugh-wink"></i><span> 叨叨</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-paper-plane"></i><span> 关于</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Open Innovation（software）</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-05-07T02:31:04.919Z" title="发表于 2023-05-07 10:31:04">2023-05-07</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-05-07T08:38:08.004Z" title="更新于 2023-05-07 16:38:08">2023-05-07</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">14.9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>71分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Open Innovation（software）"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="1-选题与要求"><a href="#1-选题与要求" class="headerlink" title="1.选题与要求"></a>1.选题与要求</h2><h3 id="个人图书馆"><a href="#个人图书馆" class="headerlink" title="个人图书馆"></a>个人图书馆</h3><blockquote>
<p>需求：<br>（1）实现图书的增删改查；图书的信息包括：id, 书名、出版社、分类号、ISBN号、出版日期、价格、购买日期；可以按照书名、出版社等检索分页展示图书列表<br>（2）实现简单的借出、归还管理。（图书表可以增加是否在架字段）<br>同时要有借还日志(增加一个借还历史表，每次借和还占用一条记录，字段有：图书的id，借出时间、归还时间、借阅人)<br>（3）借还历史日志的分页查询展示</p>
</blockquote>
<h3 id="考核内容"><a href="#考核内容" class="headerlink" title="考核内容"></a>考核内容</h3><blockquote>
<p>每个学生选择一个题目，不分组<br>1、学会编写软件需求分析文档、软件详细设计文档<br>2、掌握后端软件开发方法，熟悉 java 和 IDEA 开发环境<br>3、掌握前端软件开发方法，熟悉 vscode 环境，熟悉 typescript 语言和 react 框架<br>4、熟练使用git版本管理工具</p>
<p>提交内容：<br>软件需求分析文档、软件详细设计文档、源代码、答辩PPT</p>
</blockquote>
<h2 id="2-后端学习"><a href="#2-后端学习" class="headerlink" title="2.后端学习"></a>2.后端学习</h2><h3 id="基本步骤"><a href="#基本步骤" class="headerlink" title="基本步骤"></a>基本步骤</h3><ul>
<li><p>MySQL设计表</p>
</li>
<li><p>generatorConfig.xml添加table信息</p>
</li>
<li><p>run maven</p>
</li>
<li><p>service中添加interface</p>
</li>
<li><p>impl.java中添加java类</p>
</li>
<li><p>添加对应controller 类</p>
</li>
</ul>
<h3 id="分页查询"><a href="#分页查询" class="headerlink" title="分页查询"></a>分页查询</h3><ul>
<li><p>浏览器按F12进入开发者模式</p>
</li>
<li><p>前端向后端发送的请求格式</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;current&quot;:1,&quot;pageSize&quot;:20,&quot;departmentName&quot;:&quot;通信&quot;&#125;</span><br></pre></td></tr></table></figure>

<p>  表示请求当前页面，页面大小和部门名称</p>
<ul>
<li>后端向前端发送的JSON数据格式</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    code<span class="punctuation">:</span> <span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">    data<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      current<span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">      pageSize<span class="punctuation">:</span> <span class="number">20</span><span class="punctuation">,</span></span><br><span class="line">      total<span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">      list<span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          id<span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">          departmentName<span class="punctuation">:</span> <span class="string">&quot;通信所3444&quot;</span><span class="punctuation">,</span></span><br><span class="line">          contact<span class="punctuation">:</span> <span class="string">&quot;张三&quot;</span><span class="punctuation">,</span></span><br><span class="line">          contactPhone<span class="punctuation">:</span> <span class="string">&quot;ddd&quot;</span><span class="punctuation">,</span></span><br><span class="line">          description<span class="punctuation">:</span> <span class="string">&quot;这是一条备注&quot;</span><span class="punctuation">,</span></span><br><span class="line">          createdAt<span class="punctuation">:</span> <span class="string">&quot;2019-12-03 17:31:28&quot;</span><span class="punctuation">,</span></span><br><span class="line">          updatedAt<span class="punctuation">:</span> <span class="string">&quot;2023-03-03 10:36:23&quot;</span><span class="punctuation">,</span></span><br><span class="line">          createdBy<span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">          createdByDesc<span class="punctuation">:</span> <span class="string">&quot;管理员&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          id<span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">          departmentName<span class="punctuation">:</span> <span class="string">&quot;通信所&quot;</span><span class="punctuation">,</span></span><br><span class="line">          contact<span class="punctuation">:</span> <span class="string">&quot;张三&quot;</span><span class="punctuation">,</span></span><br><span class="line">          contactPhone<span class="punctuation">:</span> <span class="string">&quot;1532384234234&quot;</span><span class="punctuation">,</span></span><br><span class="line">          description<span class="punctuation">:</span> <span class="string">&quot;这是一条备注&quot;</span><span class="punctuation">,</span></span><br><span class="line">          createdAt<span class="punctuation">:</span> <span class="string">&quot;2019-12-03 17:48:06&quot;</span><span class="punctuation">,</span></span><br><span class="line">          updatedAt<span class="punctuation">:</span> <span class="string">&quot;2023-03-03 10:36:29&quot;</span><span class="punctuation">,</span></span><br><span class="line">          createdBy<span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">          createdByDesc<span class="punctuation">:</span> <span class="string">&quot;管理员&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    message<span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">    success<span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#125;</span>;</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">- 后端中controller中的</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line">  Page&lt;DepartmentVO&gt; </span><br></pre></td></tr></table></figure>

<p>  分页数据，返回模板类&#x2F;泛化类的数据，Page类表示返回的Json数据格式中的内容</p>
<ul>
<li>前端向后端发送的查询内容由 DepartmentQueryDTO 类接收</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">listDepartment(<span class="meta">@RequestBody</span> DepartmentQueryDTO queryDTO)</span><br></pre></td></tr></table></figure>

<ul>
<li>模糊查询</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">queryDTO.setDepartmentName(FormatUtils.makeFuzzySearchTerm(queryDTO.getDepartmentName()));</span><br></pre></td></tr></table></figure>

<p>  注意MyBatis 自动生成的Mapper类</p>
<p>  <strong>Mapper.xml里，要添加count的SQL定义</strong></p>
<ul>
<li>MySQL查询记录语句</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select count(*) from department；</span><br><span class="line">select count(*) from department where department_name like &#x27;%通信%&#x27;;</span><br></pre></td></tr></table></figure>

<ul>
<li>Mybatis</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;where&gt;</span><br><span class="line">    &lt;if test=&quot;departmentName != null&quot;&gt;</span><br><span class="line">  	  department_name like #&#123;departmentName&#125;	</span><br><span class="line">    &lt;/if&gt;</span><br><span class="line">&lt;/where&gt;</span><br></pre></td></tr></table></figure>

<p>  不是NULL，则有输入过滤条件。</p>
<p>  #{departmentName}会将departmentName内容替换到MySQL语句中，若有多个逻辑条件，则用and逻辑与</p>
<ul>
<li>利用myBatis到数据库中查询数据，以分页的方式</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 根据查询条件获取部门列表</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> queryDTO 查询条件</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> offset   开始位置</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> limit    记录数量</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> 部门列表</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">List&lt;Department&gt; <span class="title function_">list</span><span class="params">(</span></span><br><span class="line"><span class="params">    <span class="meta">@Param(&quot;queryDTO&quot;)</span> DepartmentQueryDTO queryDTO,</span></span><br><span class="line"><span class="params">    <span class="meta">@Param(&quot;offset&quot;)</span> Integer offset,</span></span><br><span class="line"><span class="params">    <span class="meta">@Param(&quot;limit&quot;)</span> Integer limit</span></span><br><span class="line"><span class="params">)</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>将Department对象转VO对象</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将实体对象转换为VO对象</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> department 实体对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> nameMap</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> VO对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> DepartmentVO <span class="title function_">convertToVO</span><span class="params">(Department department, Map&lt;Integer, String&gt; nameMap)</span> &#123;</span><br><span class="line">        <span class="type">DepartmentVO</span> <span class="variable">departmentVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DepartmentVO</span>();</span><br><span class="line">        <span class="comment">//把第一个对象的字段，复制到第二个对象，前提要求是字段必须对应</span></span><br><span class="line">        BeanUtils.copyProperties(department, departmentVO);</span><br><span class="line"></span><br><span class="line">        departmentVO.setCreatedByDesc(nameMap.get(department.getCreatedBy()));</span><br><span class="line">        <span class="keyword">return</span> departmentVO;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>IDEA F8单步执行Run over  F7 Run into</li>
</ul>
<h3 id="避免重复创建部门"><a href="#避免重复创建部门" class="headerlink" title="避免重复创建部门"></a>避免重复创建部门</h3><ol>
<li><h4 id="dao中创建Mapper类"><a href="#dao中创建Mapper类" class="headerlink" title="dao中创建Mapper类"></a>dao中创建Mapper类</h4></li>
</ol>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Department <span class="title function_">getByName</span><span class="params">(<span class="meta">@Param(&quot;name&quot;)</span>String name)</span>;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><h4 id="xml中添加"><a href="#xml中添加" class="headerlink" title="xml中添加"></a>xml中添加</h4></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 获取名字 --&gt;</span><br><span class="line">    &lt;select id=&quot;getByName&quot; resultMap=&quot;BaseResultMap&quot;&gt;</span><br><span class="line">        select  *</span><br><span class="line">        from department</span><br><span class="line">        where department_name = *&#123;name&#125;</span><br><span class="line">    &lt;/select&gt;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><h4 id="Impl中添加Assert"><a href="#Impl中添加Assert" class="headerlink" title="Impl中添加Assert"></a>Impl中添加Assert</h4></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Assert.isNull(departmentMapper.getByName(departmentDTO.getDepartmentName()),<span class="string">&quot;部门已经存在&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>​     </p>
<h2 id="3-前端学习"><a href="#3-前端学习" class="headerlink" title="3.前端学习"></a>3.前端学习</h2><p>只看java基本语法，能够在项目中写代码即可</p>
<h3 id="基本知识"><a href="#基本知识" class="headerlink" title="基本知识"></a>基本知识</h3><ol>
<li><h4 id="箭头函数"><a href="#箭头函数" class="headerlink" title="箭头函数"></a>箭头函数</h4></li>
</ol>
<blockquote>
<p>c: int add(int a, int b);<br>ts:  function add(a: number, b: number);<br>ts: 数据类型：number(数字类型，3, 5.2), string, boolean, …</p>
<p>箭头函数是没有名字的<br>Typescript &#x3D;&gt; javascript &#x3D;&gt; 在浏览器中运行<br>chrome V8 js引擎，单进程单线程里run的<br>异步函数： 非阻塞 </p>
</blockquote>
<ol start="2">
<li><h4 id="定义一个回调函数"><a href="#定义一个回调函数" class="headerlink" title="定义一个回调函数"></a>定义一个回调函数</h4></li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义一个Delete的回调函数</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">handleDelete</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (!selectedRowKeys?.<span class="property">length</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="title function_">openConfirm</span>(<span class="string">`您确定删除<span class="subst">$&#123;selectedRowKeys.length&#125;</span>条记录吗`</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">        <span class="comment">// await deleteBook(selectedRowKeys);</span></span><br><span class="line">        refAction.<span class="property">current</span>?.<span class="title function_">reload</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><h4 id="声明变量与方法"><a href="#声明变量与方法" class="headerlink" title="声明变量与方法"></a>声明变量与方法</h4></li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//声明两个常量，变量名为selectedRowKeys，改变变量值的方法为selectRow</span></span><br><span class="line"><span class="keyword">const</span> [selectedRowKeys, selectRow] = useState&lt;<span class="built_in">number</span>[]&gt;([]);</span><br><span class="line"><span class="comment">//声明页面级状态变量，将变量传递给对话框，&lt;&gt;内表示是什么类型的数据，()为空表示不对其初始化</span></span><br><span class="line"><span class="keyword">const</span> [book, setBook] = useState&lt;<span class="variable constant_">API</span>.<span class="property">BookVO</span>&gt;();</span><br></pre></td></tr></table></figure>

<ol start="4">
<li><h4 id="以异步非阻塞方式运行"><a href="#以异步非阻塞方式运行" class="headerlink" title="以异步非阻塞方式运行"></a>以异步非阻塞方式运行</h4></li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">myfunc</span>();</span><br></pre></td></tr></table></figure>

<ol start="5">
<li><h4 id="回调式"><a href="#回调式" class="headerlink" title="回调式"></a>回调式</h4></li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">myfunc</span>().<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data）；</span><br><span class="line">	<span class="title function_">myFunc2</span>().<span class="title function_">then</span>(<span class="function"><span class="params">d</span>=&gt;</span>&#123;</span><br><span class="line">	   <span class="comment">//...</span></span><br><span class="line">	&#125;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="6">
<li><h4 id="异步函数的执行方式"><a href="#异步函数的执行方式" class="headerlink" title="异步函数的执行方式"></a>异步函数的执行方式</h4></li>
</ol>
<p><strong>注意只有外部是async异步函数的时候才可以在内部使用await</strong></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">myfff</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">myfunc</span>();</span><br><span class="line"></span><br><span class="line">   <span class="comment">///....</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="7">
<li><h4 id="分页展示数据结果集的antd-pro"><a href="#分页展示数据结果集的antd-pro" class="headerlink" title="分页展示数据结果集的antd pro"></a>分页展示数据结果集的antd pro</h4></li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">ProTable</span>&lt;<span class="variable constant_">API</span>.<span class="property">DepartmentVO</span>&gt; </span><br></pre></td></tr></table></figure>

<ol start="8">
<li><h4 id="刷新操作"><a href="#刷新操作" class="headerlink" title="刷新操作"></a>刷新操作</h4></li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> refAction = useRef&lt;<span class="title class_">ActionType</span>&gt;(<span class="literal">null</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">refAction.<span class="property">current</span>?.<span class="title function_">reload</span>();</span><br></pre></td></tr></table></figure>

<ol start="9">
<li><h4 id="ProTable存储数据"><a href="#ProTable存储数据" class="headerlink" title="ProTable存储数据"></a>ProTable存储数据</h4></li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//params为分页信息，protable自动将params传递给listBook，</span></span><br><span class="line"><span class="comment">//数据由convertPageData转换为antd protable的数据格式</span></span><br><span class="line">request=&#123;<span class="keyword">async</span> (params = &#123;&#125;) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">convertPageData</span>(<span class="keyword">await</span> <span class="title function_">listBook</span>(params));</span><br><span class="line">&#125;&#125;</span><br></pre></td></tr></table></figure>

<ol start="10">
<li><h4 id="模态对话框显示数据"><a href="#模态对话框显示数据" class="headerlink" title="模态对话框显示数据"></a>模态对话框显示数据</h4></li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置book为当前record，并且使对话框可视化</span></span><br><span class="line"><span class="attr">render</span>: <span class="function">(<span class="params">dom, record</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">a</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">        setBook(record);</span></span><br><span class="line"><span class="language-xml">        setVisible(true);</span></span><br><span class="line"><span class="language-xml">    &#125;&#125;</span></span><br><span class="line"><span class="language-xml">    &gt;</span></span><br><span class="line"><span class="language-xml">        &#123;dom&#125;</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line">);</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">InputDialog</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">//<span class="attr">接收book数据</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">detailData</span>=<span class="string">&#123;book&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">onClose</span>=<span class="string">&#123;(result)</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">    setVisible(false);</span></span><br><span class="line"><span class="language-xml">    result &amp;&amp; refAction.current?.reload();</span></span><br><span class="line"><span class="language-xml">&#125;&#125;</span></span><br><span class="line"><span class="language-xml">visible=&#123;visible&#125;</span></span><br><span class="line"><span class="language-xml">/&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h4><blockquote>
<p>页面级状态发生变化的时候<br>重新渲染</p>
<p>页面被加载的时候，第一次执行你的渲染函数<br>React巧妙的技术</p>
<p>useEffect开始会执行一次</p>
<p>当数组中的变量变化时，useEffect会被调用</p>
<p>useModel: 应用级状态，所有页面模块可共享。页面刷新或关闭浏览器后消失 umi useModal</p>
</blockquote>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">waitTime</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (props.<span class="property">detailData</span>) &#123;</span><br><span class="line">        form?.<span class="property">current</span>?.<span class="title function_">setFieldsValue</span>(props.<span class="property">detailData</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        form?.<span class="property">current</span>?.<span class="title function_">resetFields</span>();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;, [    变量    ]);</span><br></pre></td></tr></table></figure>



<h3 id="npm安装"><a href="#npm安装" class="headerlink" title="npm安装"></a>npm安装</h3><ol>
<li><p>更换淘宝源之后npm install还会报错</p>
</li>
<li><p>即使使用清除命令也会报错</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">清理缓存命令：</span><br><span class="line">npm cache clean --force</span><br></pre></td></tr></table></figure>
</li>
<li><p>手动删除缓存目录中的全部内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\bsgbs\AppData\Local\npm-cache</span><br></pre></td></tr></table></figure>
</li>
<li><p>再次运行npm install即可完成安装</p>
</li>
</ol>
<h3 id="OpenAPI运行出错"><a href="#OpenAPI运行出错" class="headerlink" title="OpenAPI运行出错"></a>OpenAPI运行出错</h3><p>装好依赖之后发现运行OpenAPI会报错</p>
<h4 id="解决方案："><a href="#解决方案：" class="headerlink" title="解决方案："></a>解决方案：</h4><ol>
<li><p>删除安装目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">E:\Files\Projects\CXCollege\software\frontend\web-frontend-master\web-frontend\node_modules</span><br></pre></td></tr></table></figure>
</li>
<li><p>重装npn install</p>
</li>
<li><p>运行后端之后，再次尝试npm run openapi成功运行</p>
</li>
</ol>
<hr>
<ol>
<li>使用Navicat新建book表格</li>
</ol>
<p><img src="E:\Files\Projects\CXCollege\software\Image\1.png" alt="1"></p>
<p>2.generatorConfig.xml添加table信息</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">&quot;book&quot;</span> <span class="attr">domainObjectName</span>=<span class="string">&quot;Book&quot;</span> <span class="attr">enableCountByExample</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">enableUpdateByExample</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">enableDeleteByExample</span>=<span class="string">&quot;false&quot;</span> <span class="attr">enableSelectByExample</span>=<span class="string">&quot;false&quot;</span> <span class="attr">selectByExampleQueryId</span>=<span class="string">&quot;false&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>3.run maven</p>
<p>4.service中添加interface</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> redlib.backend.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> redlib.backend.dto.TestDTO;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BookService</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(BookDTO bookDTO)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4.impl中添加java类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> redlib.backend.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.dao.BookMapper;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.dto.BookDTO;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.model.Book;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.service.BookService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">BookService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BookMapper bookMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(BookDTO bookDTO)</span> &#123;</span><br><span class="line">        <span class="type">Book</span> <span class="variable">book</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Book</span>();</span><br><span class="line">        book.setBookName(bookDTO.getBook_name());</span><br><span class="line">        book.setIsbn(bookDTO.getISBN());</span><br><span class="line">        book.setBookAuthor(bookDTO.getBook_author());</span><br><span class="line">        book.setBookPublish(bookDTO.getBook_publish());</span><br><span class="line">        book.setBookPrice(bookDTO.getBook_price());</span><br><span class="line">        book.setBookType(bookDTO.getBook_type());</span><br><span class="line">        book.setBookLocation(bookDTO.getBook_location());</span><br><span class="line">        bookMapper.insert(book);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>5.添加对应controller 类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> redlib.backend.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.annotation.NeedNoPrivilege;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.dto.BookDTO;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.service.BookService;</span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/book&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BookService bookService;</span><br><span class="line">    <span class="meta">@PostMapping(&quot;addRecord&quot;)</span></span><br><span class="line">    <span class="meta">@NeedNoPrivilege</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addRecord</span><span class="params">(<span class="meta">@RequestBody</span> BookDTO bookDTO)</span>&#123;</span><br><span class="line">        bookService.insert(bookDTO);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>6.添加DTO类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> redlib.backend.dto;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.math.BigDecimal;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookDTO</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String Book_name;</span><br><span class="line">    <span class="keyword">private</span> String ISBN;</span><br><span class="line">    <span class="keyword">private</span> String Book_author;</span><br><span class="line">    <span class="keyword">private</span> String Book_publish;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal Book_price;</span><br><span class="line">    <span class="keyword">private</span> String Book_type;</span><br><span class="line">    <span class="keyword">private</span> String Book_location;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="常用注解"><a href="#常用注解" class="headerlink" title="常用注解"></a>常用注解</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span>：引用其他组件</span><br><span class="line"><span class="meta">@Data</span>的使用： lombok，自动生成getter和setter</span><br><span class="line"><span class="meta">@Slf4j</span>的使用：日志。可以直接用log.debug, log.error等</span><br><span class="line"><span class="meta">@Service</span>:  业务服务组件。这个组件可以访问数据库</span><br><span class="line"><span class="meta">@RestController</span>:  控制器组件</span><br><span class="line"><span class="meta">@GetMapping</span>和<span class="meta">@PostMapping</span>:  控制器方法注解，指定URL路径</span><br><span class="line"><span class="meta">@NeedNoToken</span>:  不需要登录即可访问的方法</span><br></pre></td></tr></table></figure>



<h2 id="4-个人图书馆"><a href="#4-个人图书馆" class="headerlink" title="4.个人图书馆"></a>4.个人图书馆</h2><p>图书信息表 <em>book</em></p>
<table>
<thead>
<tr>
<th>字段名称</th>
<th>数据类型</th>
<th>索引</th>
<th>样例</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>book_id</td>
<td>int(10)</td>
<td>Primary Key</td>
<td>1234</td>
<td>书籍ID</td>
</tr>
<tr>
<td>book_name</td>
<td>char(20)</td>
<td></td>
<td>马原</td>
<td>书籍名称</td>
</tr>
<tr>
<td>isbn</td>
<td>char(13)</td>
<td></td>
<td>1234567891234</td>
<td>ISBN</td>
</tr>
<tr>
<td>book_author</td>
<td>char(10)</td>
<td></td>
<td>作者</td>
<td>书籍作者</td>
</tr>
<tr>
<td>book_publish</td>
<td>char(20)</td>
<td></td>
<td>山大出版社</td>
<td>书籍出版社</td>
</tr>
<tr>
<td>book_price</td>
<td>double(20,2)</td>
<td></td>
<td>30.23</td>
<td>书籍价格</td>
</tr>
<tr>
<td>book_type</td>
<td>char(20)</td>
<td></td>
<td></td>
<td>书籍类型</td>
</tr>
<tr>
<td>book_boutime</td>
<td>datetime</td>
<td></td>
<td></td>
<td>购买时间</td>
</tr>
<tr>
<td>book_pubtime</td>
<td>datetime</td>
<td></td>
<td></td>
<td>出版时间</td>
</tr>
</tbody></table>
<h3 id="基本页面框架"><a href="#基本页面框架" class="headerlink" title="基本页面框架"></a>基本页面框架</h3><h4 id="后端"><a href="#后端" class="headerlink" title="后端"></a>后端</h4><ul>
<li><h4 id="增加接口"><a href="#增加接口" class="headerlink" title="增加接口"></a>增加接口</h4></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> redlib.backend.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> redlib.backend.dto.BookDTO;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.dto.query.BookQueryDTO;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.model.Page;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.vo.BookVO;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BookService</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(BookDTO bookDTO)</span>;</span><br><span class="line">    Page&lt;BookVO&gt; <span class="title function_">listByPage</span><span class="params">(BookQueryDTO queryDTO)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><h4 id="Impl中实现Service"><a href="#Impl中实现Service" class="headerlink" title="Impl中实现Service"></a>Impl中实现Service</h4></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> redlib.backend.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeanUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.Assert;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.dao.BookMapper;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.dto.BookDTO;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.dto.query.BookQueryDTO;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.model.Book;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.model.Page;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.service.AdminService;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.service.BookService;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.service.utils.BookUtils;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.utils.FormatUtils;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.utils.PageUtils;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.vo.BookVO;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">BookService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BookMapper bookMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AdminService adminService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(BookDTO bookDTO)</span> &#123;</span><br><span class="line">        <span class="type">Book</span> <span class="variable">book</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Book</span>();</span><br><span class="line">        book.setBookName(bookDTO.getBookName());</span><br><span class="line">        book.setIsbn(bookDTO.getISBN());</span><br><span class="line">        book.setBookAuthor(bookDTO.getBookAuthor());</span><br><span class="line">        book.setBookPublish(bookDTO.getBookPublish());</span><br><span class="line">        book.setBookPrice(bookDTO.getBookPrice());</span><br><span class="line">        book.setBookType(bookDTO.getBookType());</span><br><span class="line">        book.setBookBoutime(bookDTO.getBookBoutime());</span><br><span class="line">        book.setBookPubtime(bookDTO.getBookPubtime());</span><br><span class="line">        bookMapper.insert(book);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Page&lt;BookVO&gt; <span class="title function_">listByPage</span><span class="params">(BookQueryDTO queryDTO)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (queryDTO == <span class="literal">null</span>) &#123;</span><br><span class="line">            queryDTO = <span class="keyword">new</span> <span class="title class_">BookQueryDTO</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//模糊查询</span></span><br><span class="line">        queryDTO.setBookName(FormatUtils.makeFuzzySearchTerm(queryDTO.getBookName()));</span><br><span class="line">        <span class="comment">//将查询条件发送给dao接口，先查询命中个数</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">size</span> <span class="operator">=</span> bookMapper.count(queryDTO);</span><br><span class="line">        <span class="type">PageUtils</span> <span class="variable">pageUtils</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PageUtils</span>(queryDTO.getCurrent(), queryDTO.getPageSize(), size);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (size == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// 没有命中，则返回空数据。</span></span><br><span class="line">            <span class="keyword">return</span> pageUtils.getNullPage();</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;Book&gt; list = bookMapper.list(queryDTO, pageUtils.getOffset(), pageUtils.getLimit());</span><br><span class="line">        Set&lt;String&gt; adminIds = list.stream().map(Book::getBookName).collect(Collectors.toSet());</span><br><span class="line">        adminIds.addAll(list.stream().map(Book::getBookAuthor).collect(Collectors.toSet()));</span><br><span class="line">        <span class="comment">//Map&lt;String, String&gt; nameMap = adminService.getNameMap(adminIds);</span></span><br><span class="line"></span><br><span class="line">        List&lt;BookVO&gt; voList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (Book book : list) &#123;</span><br><span class="line">            <span class="type">BookVO</span> <span class="variable">vo</span> <span class="operator">=</span> BookUtils.convertToVO(book);</span><br><span class="line">            voList.add(vo);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//按照前端支持的格式返回给前端</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(pageUtils.getCurrent(), pageUtils.getPageSize(), pageUtils.getTotal(), voList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><h5 id="新增BookUtils-java封装各种功能"><a href="#新增BookUtils-java封装各种功能" class="headerlink" title="新增BookUtils.java封装各种功能"></a>新增BookUtils.java封装各种功能</h5></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> redlib.backend.service.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeanUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.Assert;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.dto.BookDTO;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.model.Book;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.utils.FormatUtils;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.vo.BookVO;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookUtils</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 规范并校验bookDTO</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bookDTO 实体对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">validateBook</span><span class="params">(BookDTO bookDTO)</span> &#123;</span><br><span class="line">        FormatUtils.trimFieldToNull(bookDTO);</span><br><span class="line">        Assert.notNull(bookDTO, <span class="string">&quot;书籍数据不能为空&quot;</span>);</span><br><span class="line">        Assert.hasText(bookDTO.getBookName(), <span class="string">&quot;书名不能为空&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> BookVO <span class="title function_">convertToVO</span><span class="params">(Book book)</span> &#123;</span><br><span class="line">        <span class="type">BookVO</span> <span class="variable">bookVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BookVO</span>();</span><br><span class="line">        BeanUtils.copyProperties(book, bookVO);</span><br><span class="line">        <span class="keyword">return</span> bookVO;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><h5 id="在BookMapper-java中添加"><a href="#在BookMapper-java中添加" class="headerlink" title="在BookMapper.java中添加"></a>在BookMapper.java中添加</h5></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Book&gt; <span class="title function_">list</span><span class="params">(<span class="meta">@Param(&quot;queryDTO&quot;)</span> BookQueryDTO queryDTO, <span class="meta">@Param(&quot;offset&quot;)</span> Integer offset, <span class="meta">@Param(&quot;limit&quot;)</span> Integer limit)</span>;</span><br><span class="line"></span><br><span class="line">Integer <span class="title function_">count</span><span class="params">(BookQueryDTO queryDTO)</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li><h5 id="xml中添加-1"><a href="#xml中添加-1" class="headerlink" title="xml中添加"></a>xml中添加</h5></li>
</ul>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 获取名字个数(分页) --&gt;</span><br><span class="line">&lt;select id=<span class="string">&quot;count&quot;</span> resultType=<span class="string">&quot;integer&quot;</span>&gt;</span><br><span class="line">  select <span class="title function_">count</span><span class="params">(*)</span></span><br><span class="line">  from book</span><br><span class="line">  &lt;where&gt;</span><br><span class="line">    &lt;<span class="keyword">if</span> test=<span class="string">&quot;bookName != null&quot;</span>&gt;</span><br><span class="line">      book_name like #&#123;bookName&#125;</span><br><span class="line">    &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">  &lt;/where&gt;</span><br><span class="line">&lt;/select&gt;</span><br><span class="line">  </span><br><span class="line">&lt;!-- 获取部门(分页) --&gt;</span><br><span class="line">&lt;select id=<span class="string">&quot;list&quot;</span> resultMap=<span class="string">&quot;BaseResultMap&quot;</span>&gt;</span><br><span class="line">  select</span><br><span class="line">  &lt;include refid=<span class="string">&quot;Base_Column_List&quot;</span>/&gt;</span><br><span class="line">  from book</span><br><span class="line">  &lt;where&gt;</span><br><span class="line">    &lt;<span class="keyword">if</span> test=<span class="string">&quot;queryDTO.bookName != null&quot;</span>&gt;</span><br><span class="line">      Book_name like #&#123;queryDTO.bookName&#125;</span><br><span class="line">    &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">  &lt;/where&gt;</span><br><span class="line">  limit #&#123;offset&#125;, #&#123;limit&#125;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><h5 id="BookController-java中添加"><a href="#BookController-java中添加" class="headerlink" title="BookController.java中添加"></a>BookController.java中添加</h5></li>
</ul>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> BookService bookService;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@PostMapping(&quot;listBook&quot;)</span></span><br><span class="line"><span class="meta">@Privilege(&quot;page&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Page&lt;BookVO&gt; <span class="title function_">listBook</span><span class="params">(<span class="meta">@RequestBody</span> BookQueryDTO queryDTO)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> bookService.listByPage(queryDTO);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><h5 id="添加BookQueryDTO-java模糊查询"><a href="#添加BookQueryDTO-java模糊查询" class="headerlink" title="添加BookQueryDTO.java模糊查询"></a>添加BookQueryDTO.java模糊查询</h5></li>
</ul>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> redlib.backend.dto.query;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookQueryDTO</span> <span class="keyword">extends</span> <span class="title class_">PageQueryDTO</span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 书籍名称，模糊匹配</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String bookName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="前端"><a href="#前端" class="headerlink" title="前端"></a>前端</h4><ul>
<li><h5 id="routes-ts中添加页面路由"><a href="#routes-ts中添加页面路由" class="headerlink" title="routes.ts中添加页面路由"></a>routes.ts中添加页面路由</h5></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">        path: &#x27;/base/book&#x27;,</span><br><span class="line">        name: &#x27;book&#x27;,</span><br><span class="line">        component: &#x27;./base/book&#x27;,</span><br><span class="line">        access: &#x27;hasPrivilege&#x27;</span><br><span class="line">      &#125;,</span><br></pre></td></tr></table></figure>

<ul>
<li><h5 id="在-src-locales-zh-CN-menu-ts修改维护菜单中文名称"><a href="#在-src-locales-zh-CN-menu-ts修改维护菜单中文名称" class="headerlink" title="在\src\locales\zh-CN\menu.ts修改维护菜单中文名称"></a>在\src\locales\zh-CN\menu.ts修改维护菜单中文名称</h5></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;menu.base.book&#x27;: &#x27;书籍管理&#x27;,</span><br></pre></td></tr></table></figure>

<ul>
<li><h5 id="创建-src-pages-base-book-index-tsx"><a href="#创建-src-pages-base-book-index-tsx" class="headerlink" title="创建 \src\pages\base\book\index.tsx"></a>创建 \src\pages\base\book\index.tsx</h5></li>
</ul>
<p><img src="E:\Files\Projects\CXCollege\software\Image\2.png" alt="2"></p>
<ul>
<li><h5 id="运行Openapi"><a href="#运行Openapi" class="headerlink" title="运行Openapi"></a>运行Openapi</h5></li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run openapi</span><br></pre></td></tr></table></figure>

<ul>
<li><h5 id="基本框架代码"><a href="#基本框架代码" class="headerlink" title="基本框架代码"></a>基本框架代码</h5></li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; deleteBook, listBook &#125; <span class="keyword">from</span> <span class="string">&#x27;@/services/api/book&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; convertPageData &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; openConfirm &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/ui&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">PlusOutlined</span>, <span class="title class_">DeleteOutlined</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@ant-design/icons&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ActionType</span>, <span class="title class_">PageContainer</span>, <span class="title class_">ProColumns</span>, <span class="title class_">ProTable</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@ant-design/pro-components&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Button</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useRef, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">InputDialog</span> <span class="keyword">from</span> <span class="string">&#x27;./InputDialog&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> refAction = useRef&lt;<span class="title class_">ActionType</span>&gt;(<span class="literal">null</span>);</span><br><span class="line">  <span class="comment">//声明两个常量，变量名为selectedRowKeys，改变变量值的方法为selectRow</span></span><br><span class="line">  <span class="keyword">const</span> [selectedRowKeys, selectRow] = useState&lt;<span class="built_in">number</span>[]&gt;([]);</span><br><span class="line">  <span class="comment">//声明页面级状态变量，将变量传递给对话框，&lt;&gt;内表示是什么类型的数据，()为空表示不对其初始化</span></span><br><span class="line">  <span class="keyword">const</span> [book, setBook] = useState&lt;<span class="variable constant_">API</span>.<span class="property">BookVO</span>&gt;();</span><br><span class="line">  <span class="keyword">const</span> [visible, setVisible] = <span class="title function_">useState</span>(<span class="literal">false</span>);</span><br><span class="line">  <span class="comment">//定义一个Delete的回调函数</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handleDelete</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (!selectedRowKeys?.<span class="property">length</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="title function_">openConfirm</span>(<span class="string">`您确定删除<span class="subst">$&#123;selectedRowKeys.length&#125;</span>条记录吗`</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">      <span class="comment">// await deleteBook(selectedRowKeys);</span></span><br><span class="line">      refAction.<span class="property">current</span>?.<span class="title function_">reload</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> <span class="attr">columns</span>: <span class="title class_">ProColumns</span>&lt;<span class="variable constant_">API</span>.<span class="property">BookVO</span>&gt;[] = [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;ID&#x27;</span>,</span><br><span class="line">      <span class="attr">dataIndex</span>: <span class="string">&#x27;bookId&#x27;</span>,</span><br><span class="line">      <span class="attr">width</span>: <span class="number">100</span>,</span><br><span class="line">      <span class="attr">search</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;书名&#x27;</span>,</span><br><span class="line">      <span class="attr">dataIndex</span>: <span class="string">&#x27;bookName&#x27;</span>,</span><br><span class="line">      <span class="attr">width</span>: <span class="number">100</span>,</span><br><span class="line">      <span class="attr">render</span>: <span class="function">(<span class="params">dom, record</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">          <span class="language-xml"><span class="tag">&lt;<span class="name">a</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">              setBook(record);</span></span><br><span class="line"><span class="language-xml">              setVisible(true);</span></span><br><span class="line"><span class="language-xml">            &#125;&#125;</span></span><br><span class="line"><span class="language-xml">          &gt;</span></span><br><span class="line"><span class="language-xml">            &#123;dom&#125;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line">        );</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;ISBN&#x27;</span>,</span><br><span class="line">      <span class="attr">dataIndex</span>: <span class="string">&#x27;isbn&#x27;</span>,</span><br><span class="line">      <span class="attr">width</span>: <span class="number">100</span>,</span><br><span class="line">      <span class="attr">search</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;分类号&#x27;</span>,</span><br><span class="line">      <span class="attr">dataIndex</span>: <span class="string">&#x27;bookType&#x27;</span>,</span><br><span class="line">      <span class="attr">width</span>: <span class="number">100</span>,</span><br><span class="line">      <span class="attr">search</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;作者&#x27;</span>,</span><br><span class="line">      <span class="attr">dataIndex</span>: <span class="string">&#x27;bookAuthor&#x27;</span>,</span><br><span class="line">      <span class="attr">width</span>: <span class="number">100</span>,</span><br><span class="line">      <span class="attr">search</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;出版社&#x27;</span>,</span><br><span class="line">      <span class="attr">dataIndex</span>: <span class="string">&#x27;bookPublish&#x27;</span>,</span><br><span class="line">      <span class="attr">width</span>: <span class="number">100</span>,</span><br><span class="line">      <span class="attr">search</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;出版时间&#x27;</span>,</span><br><span class="line">      <span class="attr">dataIndex</span>: <span class="string">&#x27;bookPubtime&#x27;</span>,</span><br><span class="line">      <span class="attr">width</span>: <span class="number">100</span>,</span><br><span class="line">      <span class="attr">search</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;价格&#x27;</span>,</span><br><span class="line">      <span class="attr">dataIndex</span>: <span class="string">&#x27;bookPrice&#x27;</span>,</span><br><span class="line">      <span class="attr">width</span>: <span class="number">100</span>,</span><br><span class="line">      <span class="attr">search</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;购买时间&#x27;</span>,</span><br><span class="line">      <span class="attr">dataIndex</span>: <span class="string">&#x27;bookBoutime&#x27;</span>,</span><br><span class="line">      <span class="attr">width</span>: <span class="number">100</span>,</span><br><span class="line">      <span class="attr">search</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  ];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">PageContainer</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &lt;ProTable<span class="tag">&lt;<span class="name">API.BookVO</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        actionRef=&#123;refAction&#125;</span></span><br><span class="line"><span class="language-xml">        rowKey=&quot;id&quot;</span></span><br><span class="line"><span class="language-xml">        //params为分页信息，protable自动将params传递给listBook，</span></span><br><span class="line"><span class="language-xml">        //数据由convertPageData转换为antd protable的数据格式</span></span><br><span class="line"><span class="language-xml">        request=&#123;async (params = &#123;&#125;) =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">          return convertPageData(await listBook(params));</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;</span></span><br><span class="line"><span class="language-xml">        toolBarRender=&#123;() =&gt; [</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">key</span>=<span class="string">&quot;primary&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">              setBook(undefined);</span></span><br><span class="line"><span class="language-xml">              setVisible(true);</span></span><br><span class="line"><span class="language-xml">            &#125;&#125;</span></span><br><span class="line"><span class="language-xml">          &gt;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">PlusOutlined</span> /&gt;</span> 新建</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">Button</span>&gt;</span>,</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">key</span>=<span class="string">&quot;primary&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">danger</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">onClick</span>=<span class="string">&#123;handleDelete&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">disabled</span>=<span class="string">&#123;!selectedRowKeys?.length&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          &gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">DeleteOutlined</span> /&gt;</span> 删除</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">Button</span>&gt;</span>,</span></span><br><span class="line"><span class="language-xml">        ]&#125;</span></span><br><span class="line"><span class="language-xml">        columns=&#123;columns&#125;</span></span><br><span class="line"><span class="language-xml">        rowSelection=&#123;&#123;</span></span><br><span class="line"><span class="language-xml">          onChange: (rowKeys) =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">            selectRow(rowKeys as number[]);</span></span><br><span class="line"><span class="language-xml">          &#125;,</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      /&gt;</span></span><br><span class="line"><span class="language-xml">      //通过visible控制状态框是否显示</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">InputDialog</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">detailData</span>=<span class="string">&#123;book&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onClose</span>=<span class="string">&#123;(result)</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">          setVisible(false);</span></span><br><span class="line"><span class="language-xml">          result &amp;&amp; refAction.current?.reload();</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;</span></span><br><span class="line"><span class="language-xml">        visible=&#123;visible&#125;</span></span><br><span class="line"><span class="language-xml">      /&gt;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">PageContainer</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  );</span></span><br><span class="line"><span class="language-xml">&#125;;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><h5 id="完成基本页面显示"><a href="#完成基本页面显示" class="headerlink" title="完成基本页面显示"></a>完成基本页面显示</h5></li>
</ul>
<p><img src="E:\Files\Projects\CXCollege\software\Image\6.png" alt="5"></p>
<hr>
<h3 id="为Book增加功能"><a href="#为Book增加功能" class="headerlink" title="为Book增加功能"></a>为Book增加功能</h3><h4 id="后端-1"><a href="#后端-1" class="headerlink" title="后端"></a>后端</h4><h5 id="1-addBook"><a href="#1-addBook" class="headerlink" title="1.addBook"></a>1.addBook</h5><ul>
<li><h5 id="增加接口-1"><a href="#增加接口-1" class="headerlink" title="增加接口"></a>增加接口</h5></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Integer <span class="title function_">addBook</span><span class="params">(BookDTO bookDTO)</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li><h5 id="BookController-java中添加-1"><a href="#BookController-java中添加-1" class="headerlink" title="BookController.java中添加"></a>BookController.java中添加</h5></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;addBook&quot;)</span></span><br><span class="line"><span class="meta">@NeedNoPrivilege</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addBook</span><span class="params">(<span class="meta">@RequestBody</span> BookDTO bookDTO)</span>&#123;</span><br><span class="line">    bookService.addBook(bookDTO);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><h5 id="添加BookQueryDTO-java"><a href="#添加BookQueryDTO-java" class="headerlink" title="添加BookQueryDTO.java"></a>添加BookQueryDTO.java</h5></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> redlib.backend.dto.query;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookQueryDTO</span> <span class="keyword">extends</span> <span class="title class_">PageQueryDTO</span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 书籍名称，模糊匹配</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">    <span class="keyword">private</span> String bookName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><h5 id="完善Impl实现"><a href="#完善Impl实现" class="headerlink" title="完善Impl实现"></a>完善Impl实现</h5></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Integer <span class="title function_">addBook</span><span class="params">(BookDTO bookDTO)</span>&#123;</span><br><span class="line">    <span class="comment">// 校验输入数据正确性</span></span><br><span class="line">    BookUtils.validateBook(bookDTO);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">             * 此处后续可以增加条件</span></span><br><span class="line"><span class="comment">             *   相同名称的书籍可能可以共存（不同ISBN）</span></span><br><span class="line"><span class="comment">             * */</span></span><br><span class="line">    <span class="comment">//        Assert.isNull(bookMapper.getByName(bookDTO.getBook_name()),&quot;书籍已经存在&quot;);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建实体对象，用以保存到数据库</span></span><br><span class="line">    <span class="type">Book</span> <span class="variable">book</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Book</span>();</span><br><span class="line">    <span class="comment">// 将输入的字段全部复制到实体对象中</span></span><br><span class="line">    BeanUtils.copyProperties(bookDTO, book);</span><br><span class="line">    <span class="comment">// 调用DAO方法保存到数据库表</span></span><br><span class="line">    bookMapper.insert(book);</span><br><span class="line">    <span class="keyword">return</span> book.getBookId();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h6 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h6><p>接口地址：book&#x2F;addBook</p>
<p>请求方法: POST</p>
<p>入参：</p>
<table>
<thead>
<tr>
<th>参数名</th>
<th>参数描述</th>
<th>数据类型</th>
<th>必填</th>
<th>示例&#x2F;备注</th>
</tr>
</thead>
<tbody><tr>
<td>bookName</td>
<td>名称</td>
<td>String</td>
<td>M</td>
<td>书名</td>
</tr>
<tr>
<td>isbn</td>
<td>ISBN</td>
<td>String</td>
<td>M</td>
<td>1234567891234</td>
</tr>
<tr>
<td>bookAuthor</td>
<td>作者</td>
<td>String</td>
<td>M</td>
<td>作者</td>
</tr>
<tr>
<td>bookPublish</td>
<td>出版社</td>
<td>String</td>
<td>M</td>
<td>山大</td>
</tr>
<tr>
<td>bookPrice</td>
<td>价格</td>
<td>Double</td>
<td>O</td>
<td>23.13</td>
</tr>
<tr>
<td>bookPubtime</td>
<td>出版时间</td>
<td>String</td>
<td>O</td>
<td>2021-08-09</td>
</tr>
<tr>
<td>bookBoutime</td>
<td>购买时间</td>
<td>String</td>
<td>O</td>
<td>2021-08-09</td>
</tr>
<tr>
<td>bookType</td>
<td>分类号</td>
<td>String</td>
<td>O</td>
<td>GV943</td>
</tr>
</tbody></table>
<p><strong>出参：</strong>无</p>
<p>示例：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span><span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;message&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;success&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>接口描述：</p>
<p>1、 校验必填项不能为空</p>
<p>2、 将入参保存至book表各对应字段</p>
<h6 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h6><p>成功新增信号与系统</p>
<p><img src="E:\Files\Projects\CXCollege\software\Image\12.png" alt="12"></p>
<p><img src="E:\Files\Projects\CXCollege\software\Image\13.png" alt="13"></p>
<h5 id="2-updateBook"><a href="#2-updateBook" class="headerlink" title="2.updateBook"></a>2.updateBook</h5><ul>
<li><h5 id="增加接口-2"><a href="#增加接口-2" class="headerlink" title="增加接口"></a>增加接口</h5></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Integer <span class="title function_">updateBook</span><span class="params">(BookDTO bookDTO)</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li><h5 id="BookController-java中添加-2"><a href="#BookController-java中添加-2" class="headerlink" title="BookController.java中添加"></a>BookController.java中添加</h5></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;updateBook&quot;)</span></span><br><span class="line"><span class="meta">@Privilege(&quot;update&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Integer <span class="title function_">updateBook</span><span class="params">(<span class="meta">@RequestBody</span> BookDTO bookDTO)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> bookService.updateBook(bookDTO);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><h5 id="完善Impl实现-1"><a href="#完善Impl实现-1" class="headerlink" title="完善Impl实现"></a>完善Impl实现</h5></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Integer <span class="title function_">updateBook</span><span class="params">(BookDTO bookDTO)</span> &#123;</span><br><span class="line">    <span class="comment">// 校验输入数据正确性</span></span><br><span class="line">    <span class="type">Token</span> <span class="variable">token</span> <span class="operator">=</span> ThreadContextHolder.getToken();</span><br><span class="line">    BookUtils.validateBook(bookDTO);</span><br><span class="line">    Assert.notNull(bookDTO.getBookId(), <span class="string">&quot;书籍id不能为空&quot;</span>);</span><br><span class="line">    <span class="type">Book</span> <span class="variable">book</span> <span class="operator">=</span> bookMapper.selectByPrimaryKey(bookDTO.getBookId());</span><br><span class="line">    Assert.notNull(book, <span class="string">&quot;没有找到书籍，Id为：&quot;</span> + bookDTO.getBookId());</span><br><span class="line"></span><br><span class="line">    BeanUtils.copyProperties(bookDTO, book);</span><br><span class="line">    bookMapper.updateByPrimaryKey(book);</span><br><span class="line">    <span class="keyword">return</span> book.getBookId();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h6 id="描述-1"><a href="#描述-1" class="headerlink" title="描述"></a>描述</h6><p>接口地址：book&#x2F;updateBook</p>
<p>请求方法: POST</p>
<p>入参：书籍id</p>
<table>
<thead>
<tr>
<th>参数名</th>
<th>参数描述</th>
<th>数据类型</th>
<th>必填</th>
<th>示例&#x2F;备注</th>
</tr>
</thead>
<tbody><tr>
<td>bookName</td>
<td>名称</td>
<td>String</td>
<td>M</td>
<td>书名</td>
</tr>
<tr>
<td>isbn</td>
<td>ISBN</td>
<td>String</td>
<td>M</td>
<td>1234567891234</td>
</tr>
<tr>
<td>bookAuthor</td>
<td>作者</td>
<td>String</td>
<td>M</td>
<td>作者</td>
</tr>
<tr>
<td>bookPublish</td>
<td>出版社</td>
<td>String</td>
<td>M</td>
<td>山大</td>
</tr>
<tr>
<td>bookPrice</td>
<td>价格</td>
<td>Double</td>
<td>O</td>
<td>23.13</td>
</tr>
<tr>
<td>bookPubtime</td>
<td>出版时间</td>
<td>String</td>
<td>O</td>
<td>2021-08-09</td>
</tr>
<tr>
<td>bookBoutime</td>
<td>购买时间</td>
<td>String</td>
<td>O</td>
<td>2021-08-09</td>
</tr>
<tr>
<td>bookType</td>
<td>分类号</td>
<td>String</td>
<td>O</td>
<td>GV943</td>
</tr>
</tbody></table>
<p><strong>出参：</strong>无</p>
<p>示例：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span><span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;message&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;success&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>接口描述：</p>
<p>1、 校验必填项不能为空</p>
<h6 id="测试-1"><a href="#测试-1" class="headerlink" title="测试"></a>测试</h6><p>山大—&gt;科学出版社，成功修改</p>
<p><img src="E:\Files\Projects\CXCollege\software\Image\9.png" alt="9"></p>
<p><img src="E:\Files\Projects\CXCollege\software\Image\10.png" alt="10"></p>
<p><img src="E:\Files\Projects\CXCollege\software\Image\11.png" alt="11"></p>
<h5 id="3-deleteByCodes"><a href="#3-deleteByCodes" class="headerlink" title="3.deleteByCodes"></a>3.deleteByCodes</h5><ul>
<li><h5 id="增加接口-3"><a href="#增加接口-3" class="headerlink" title="增加接口"></a>增加接口</h5></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">deleteByCodes</span><span class="params">(List&lt;Integer&gt; ids)</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li><h5 id="BookController-java中添加-3"><a href="#BookController-java中添加-3" class="headerlink" title="BookController.java中添加"></a>BookController.java中添加</h5></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;deleteBook&quot;)</span></span><br><span class="line"><span class="meta">@Privilege(&quot;delete&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteBook</span><span class="params">(<span class="meta">@RequestBody</span> List&lt;Integer&gt; ids)</span> &#123;</span><br><span class="line">    bookService.deleteByCodes(ids);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><h5 id="完善Impl实现-2"><a href="#完善Impl实现-2" class="headerlink" title="完善Impl实现"></a>完善Impl实现</h5></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Integer <span class="title function_">updateBook</span><span class="params">(BookDTO bookDTO)</span> &#123;</span><br><span class="line">    <span class="comment">// 校验输入数据正确性</span></span><br><span class="line">    <span class="type">Token</span> <span class="variable">token</span> <span class="operator">=</span> ThreadContextHolder.getToken();</span><br><span class="line">    BookUtils.validateBook(bookDTO);</span><br><span class="line">    Assert.notNull(bookDTO.getBookId(), <span class="string">&quot;书籍id不能为空&quot;</span>);</span><br><span class="line">    <span class="type">Book</span> <span class="variable">book</span> <span class="operator">=</span> bookMapper.selectByPrimaryKey(bookDTO.getBookId());</span><br><span class="line">    Assert.notNull(book, <span class="string">&quot;没有找到书籍，Id为：&quot;</span> + bookDTO.getBookId());</span><br><span class="line"></span><br><span class="line">    BeanUtils.copyProperties(bookDTO, book);</span><br><span class="line">    bookMapper.updateByPrimaryKey(book);</span><br><span class="line">    <span class="keyword">return</span> book.getBookId();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><h5 id="添加BookMapper-java"><a href="#添加BookMapper-java" class="headerlink" title="添加BookMapper.java"></a>添加BookMapper.java</h5></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">deleteByCodes</span><span class="params">(<span class="meta">@Param(&quot;codeList&quot;)</span> List&lt;Integer&gt; codeList)</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li><h5 id="添加BookMapper-xml"><a href="#添加BookMapper-xml" class="headerlink" title="添加BookMapper.xml"></a>添加BookMapper.xml</h5></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 批量删除 --&gt;</span><br><span class="line">  &lt;update id=&quot;deleteByCodes&quot;&gt;</span><br><span class="line">    delete from book</span><br><span class="line">    where book_id in</span><br><span class="line">    &lt;foreach item=&quot;item&quot; index=&quot;index&quot; collection=&quot;codeList&quot; open=&quot;(&quot; separator=&quot;,&quot; close=&quot;)&quot;&gt;</span><br><span class="line">      #&#123;item&#125;</span><br><span class="line">    &lt;/foreach&gt;</span><br></pre></td></tr></table></figure>



<h6 id="描述-2"><a href="#描述-2" class="headerlink" title="描述"></a>描述</h6><p>接口地址：book&#x2F;deleteBook</p>
<p>请求方法: POST</p>
<p>入参：</p>
<table>
<thead>
<tr>
<th>参数名</th>
<th>参数描述</th>
<th>数据类型</th>
<th>必填</th>
<th>示例&#x2F;备注</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>书籍ID</td>
<td>Integer</td>
<td>M</td>
<td>0: 57</td>
</tr>
</tbody></table>
<p><strong>出参：</strong>无</p>
<p>示例：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span><span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;message&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;success&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>接口描述：暂无</p>
<h6 id="测试-2"><a href="#测试-2" class="headerlink" title="测试"></a>测试</h6><p>成功删除《马原》</p>
<p><img src="E:\Files\Projects\CXCollege\software\Image\14.png" alt="14"></p>
<p><img src="E:\Files\Projects\CXCollege\software\Image\15.png" alt="15"></p>
<h5 id="4-多种模糊查询"><a href="#4-多种模糊查询" class="headerlink" title="4.多种模糊查询"></a>4.多种模糊查询</h5><ul>
<li><h5 id="BookQueryDTO-java"><a href="#BookQueryDTO-java" class="headerlink" title="BookQueryDTO.java"></a>BookQueryDTO.java</h5></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> String isbn;</span><br><span class="line"><span class="keyword">private</span> String author;</span><br><span class="line"><span class="keyword">private</span> String publisher;</span><br><span class="line"><span class="keyword">private</span> String category;</span><br><span class="line"><span class="keyword">private</span> String status;</span><br></pre></td></tr></table></figure>

<ul>
<li><h5 id="完善Impl实现-3"><a href="#完善Impl实现-3" class="headerlink" title="完善Impl实现"></a>完善Impl实现</h5></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">queryDTO.setName(FormatUtils.makeFuzzySearchTerm(queryDTO.getName()));</span><br><span class="line">queryDTO.setIsbn(FormatUtils.makeFuzzySearchTerm(queryDTO.getIsbn()));</span><br><span class="line">queryDTO.setAuthor(FormatUtils.makeFuzzySearchTerm(queryDTO.getAuthor()));</span><br><span class="line">queryDTO.setPublisher(FormatUtils.makeFuzzySearchTerm(queryDTO.getPublisher()));</span><br><span class="line">queryDTO.setCategory(FormatUtils.makeFuzzySearchTerm(queryDTO.getCategory()));</span><br><span class="line">queryDTO.setStatus(FormatUtils.makeFuzzySearchTerm(queryDTO.getStatus()));</span><br></pre></td></tr></table></figure>

<ul>
<li><h5 id="添加BookMapper-xml-1"><a href="#添加BookMapper-xml-1" class="headerlink" title="添加BookMapper.xml"></a>添加BookMapper.xml</h5></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=&quot;list&quot; resultMap=&quot;BaseResultMap&quot;&gt;</span><br><span class="line">    select</span><br><span class="line">    &lt;include refid=&quot;Base_Column_List&quot;/&gt;</span><br><span class="line">    from book</span><br><span class="line">    &lt;where&gt;</span><br><span class="line">      &lt;if test=&quot;queryDTO.name != null&quot;&gt;</span><br><span class="line">        name like #&#123;queryDTO.name&#125;</span><br><span class="line">      &lt;/if&gt;</span><br><span class="line">      &lt;if test=&quot;queryDTO.isbn != null&quot;&gt;</span><br><span class="line">        isbn like #&#123;queryDTO.isbn&#125;</span><br><span class="line">      &lt;/if&gt;</span><br><span class="line">      &lt;if test=&quot;queryDTO.author != null&quot;&gt;</span><br><span class="line">        author like #&#123;queryDTO.author&#125;</span><br><span class="line">      &lt;/if&gt;</span><br><span class="line">      &lt;if test=&quot;queryDTO.publisher != null&quot;&gt;</span><br><span class="line">        publisher like #&#123;queryDTO.publisher&#125;</span><br><span class="line">      &lt;/if&gt;</span><br><span class="line">      &lt;if test=&quot;queryDTO.category != null&quot;&gt;</span><br><span class="line">        category like #&#123;queryDTO.category&#125;</span><br><span class="line">      &lt;/if&gt;</span><br><span class="line">      &lt;if test=&quot;queryDTO.status != null&quot;&gt;</span><br><span class="line">        status like #&#123;queryDTO.status&#125;</span><br><span class="line">      &lt;/if&gt;</span><br><span class="line">    &lt;/where&gt;</span><br><span class="line">    limit #&#123;offset&#125;, #&#123;limit&#125;</span><br><span class="line">  &lt;/select&gt;</span><br></pre></td></tr></table></figure>



<h4 id="前端-1"><a href="#前端-1" class="headerlink" title="前端"></a>前端</h4><p>修改 src\pages\base\book\InputDialog\index.tsx 文件</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ModalForm</span>, <span class="title class_">ProForm</span>, <span class="title class_">ProFormInstance</span>, <span class="title class_">ProFormText</span>, <span class="title class_">ProFormDatePicker</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@ant-design/pro-components&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; message &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useEffect, useRef &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; waitTime &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; addBook, updateBook &#125; <span class="keyword">from</span> <span class="string">&#x27;@/services/api/book&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> moment <span class="keyword">from</span> <span class="string">&#x27;dayjs&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">InputDialogProps</span> &#123;</span><br><span class="line">  detailData?: <span class="variable constant_">API</span>.<span class="property">BookDTO</span>;</span><br><span class="line">  <span class="attr">visible</span>: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">onClose</span>: <span class="function">(<span class="params">result: <span class="built_in">boolean</span></span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">InputDialog</span>(<span class="params">props: InputDialogProps</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> form = useRef&lt;<span class="title class_">ProFormInstance</span>&gt;(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">waitTime</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (props.<span class="property">detailData</span>) &#123;</span><br><span class="line">        form?.<span class="property">current</span>?.<span class="title function_">setFieldsValue</span>(props.<span class="property">detailData</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        form?.<span class="property">current</span>?.<span class="title function_">resetFields</span>();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;, [props.<span class="property">detailData</span>, props.<span class="property">visible</span>]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">onFinish</span> = <span class="keyword">async</span> (<span class="params">values: <span class="built_in">any</span></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; bookName, isbn, bookAuthor, bookPublish, bookPrice, bookType, bookBoutime, bookPubtime &#125; = values;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">data</span>: <span class="variable constant_">API</span>.<span class="property">BookDTO</span> = &#123;</span><br><span class="line">      <span class="attr">bookId</span>: props.<span class="property">detailData</span>?.<span class="property">bookId</span>,</span><br><span class="line">      bookName,</span><br><span class="line">      isbn,</span><br><span class="line">      bookAuthor,</span><br><span class="line">      bookPublish,</span><br><span class="line">      bookPrice,</span><br><span class="line">      bookType,</span><br><span class="line">      bookBoutime,</span><br><span class="line">      bookPubtime,</span><br><span class="line"></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">if</span> (props.<span class="property">detailData</span>) &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="title function_">updateBook</span>(data);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="title function_">addBook</span>(data);</span><br><span class="line">    &#125;</span><br><span class="line">    message.<span class="title function_">success</span>(<span class="string">&#x27;保存成功&#x27;</span>);</span><br><span class="line">    props.<span class="title function_">onClose</span>(<span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="comment">//返回一个模态对话框</span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">ModalForm</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">width</span>=<span class="string">&#123;600&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">onFinish</span>=<span class="string">&#123;onFinish&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">formRef</span>=<span class="string">&#123;form&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">modalProps</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">destroyOnClose:</span> <span class="attr">true</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onCancel:</span> () =&gt;</span> props.onClose(false),</span></span><br><span class="line"><span class="language-xml">      &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      title=&#123;props.detailData ? &#x27;修改书籍&#x27; : &#x27;新增书籍&#x27;&#125;</span></span><br><span class="line"><span class="language-xml">      open=&#123;props.visible&#125;</span></span><br><span class="line"><span class="language-xml">    &gt;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ProForm.Group</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ProFormText</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;bookName&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">label</span>=<span class="string">&quot;书籍名称&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">rules</span>=<span class="string">&#123;[</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &#123;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">required:</span> <span class="attr">true</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">message:</span> &#x27;<span class="attr">请输入书籍名称</span>！&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &#125;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          ]&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ProFormText</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;isbn&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">label</span>=<span class="string">&quot;ISBN&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">rules</span>=<span class="string">&#123;[</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &#123;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">required:</span> <span class="attr">true</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">message:</span> &#x27;<span class="attr">请输入ISBN号</span>！&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &#125;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          ]&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ProForm.Group</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ProForm.Group</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ProFormText</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;bookPublish&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">label</span>=<span class="string">&quot;出版社&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">rules</span>=<span class="string">&#123;[</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &#123;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">required:</span> <span class="attr">true</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">message:</span> &#x27;<span class="attr">请输入出版社名称</span>！&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &#125;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          ]&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ProFormText</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;bookAuthor&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">label</span>=<span class="string">&quot;作者&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">rules</span>=<span class="string">&#123;[</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &#123;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">required:</span> <span class="attr">true</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">message:</span> &#x27;<span class="attr">请输入作者名称</span>！&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &#125;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          ]&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ProForm.Group</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ProForm.Group</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ProFormText</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;bookPrice&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">label</span>=<span class="string">&quot;书籍价格&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ProFormText</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;bookType&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">label</span>=<span class="string">&quot;分类号&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ProForm.Group</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ProForm.Group</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ProFormDatePicker</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;bookBoutime&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">label</span>=<span class="string">&quot;购买时间&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">width</span>=<span class="string">&#123;200&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">initialValue</span>=<span class="string">&#123;moment(</span>&#x27;<span class="attr">2021-08-09</span>&#x27;)&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ProFormDatePicker</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;bookPubtime&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">label</span>=<span class="string">&quot;出版时间&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">width</span>=<span class="string">&#123;200&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">initialValue</span>=<span class="string">&#123;moment(</span>&#x27;<span class="attr">2021-08-09</span>&#x27;)&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ProForm.Group</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ModalForm</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>删除 search&#x3D;false 实现多种模糊查询</p>
<h3 id="借阅日志"><a href="#借阅日志" class="headerlink" title="借阅日志"></a>借阅日志</h3><h4 id="借阅日志表"><a href="#借阅日志表" class="headerlink" title="借阅日志表"></a>借阅日志表</h4><p>借阅日志表 <em>book_log</em></p>
<table>
<thead>
<tr>
<th align="center">字段名称</th>
<th align="center">数据类型</th>
<th align="center">索引</th>
<th align="center">样例</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">id</td>
<td align="center">int(11)</td>
<td align="center">Primary Key</td>
<td align="center">1234</td>
<td align="center">自增id主键</td>
</tr>
<tr>
<td align="center">reader_name</td>
<td align="center">char(255)</td>
<td align="center"></td>
<td align="center">张三</td>
<td align="center">借阅人</td>
</tr>
<tr>
<td align="center">book_id</td>
<td align="center">int(11)</td>
<td align="center"></td>
<td align="center">23</td>
<td align="center">书籍ID</td>
</tr>
<tr>
<td align="center">book_name</td>
<td align="center">char(255)</td>
<td align="center"></td>
<td align="center">信号与系统</td>
<td align="center">书名</td>
</tr>
<tr>
<td align="center">book_isbn</td>
<td align="center">char(255)</td>
<td align="center"></td>
<td align="center">1234567891234</td>
<td align="center">书籍ISBN，必须为13位</td>
</tr>
<tr>
<td align="center">borrowed_time</td>
<td align="center">date</td>
<td align="center"></td>
<td align="center">2023-04-01</td>
<td align="center">借阅时间</td>
</tr>
<tr>
<td align="center">return_time</td>
<td align="center">date</td>
<td align="center"></td>
<td align="center">TX001</td>
<td align="center">还书时间，可以为NULL</td>
</tr>
</tbody></table>
<h4 id="接口设计"><a href="#接口设计" class="headerlink" title="接口设计"></a>接口设计</h4><h5 id="1-展示页面"><a href="#1-展示页面" class="headerlink" title="1.展示页面"></a>1.展示页面</h5><p><strong>接口地址</strong>：bookLog&#x2F;listBookLog</p>
<p><strong>请求方法</strong>: POST</p>
<p><strong>入参</strong></p>
<table>
<thead>
<tr>
<th align="left">参数名</th>
<th align="left">参数描述</th>
<th align="left">数据类型</th>
<th align="left">必填</th>
<th align="left">示例&#x2F;备注</th>
</tr>
</thead>
<tbody><tr>
<td align="left">current</td>
<td align="left">当前页面</td>
<td align="left">Integer</td>
<td align="left">M</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">pageSize</td>
<td align="left">页面大小</td>
<td align="left">Integer</td>
<td align="left">M</td>
<td align="left">1</td>
</tr>
</tbody></table>
<p><strong>出参：</strong></p>
<table>
<thead>
<tr>
<th>参数名</th>
<th>参数描述</th>
<th>数据类型</th>
<th>必填</th>
<th>示例&#x2F;备注</th>
</tr>
</thead>
<tbody><tr>
<td>data</td>
<td>返回数据</td>
<td>List  of Object</td>
<td>M</td>
<td></td>
</tr>
<tr>
<td>├─  current</td>
<td>当前页面</td>
<td>Integer</td>
<td>M</td>
<td>过滤条件</td>
</tr>
<tr>
<td>├─  list</td>
<td>返回列表</td>
<td>List  of Object</td>
<td>O</td>
<td></td>
</tr>
<tr>
<td>├──  bookId</td>
<td>书籍id</td>
<td>Integer</td>
<td>O</td>
<td></td>
</tr>
<tr>
<td>├── bookIsbn</td>
<td>书籍isbn</td>
<td>String</td>
<td>O</td>
<td></td>
</tr>
<tr>
<td>├── bookName</td>
<td>书名</td>
<td>String</td>
<td>O</td>
<td></td>
</tr>
<tr>
<td>├── borrowedTime</td>
<td>借阅时间</td>
<td>date</td>
<td>O</td>
<td></td>
</tr>
<tr>
<td>├── id</td>
<td>id</td>
<td>Integer</td>
<td>O</td>
<td>主键</td>
</tr>
<tr>
<td>├── readerName</td>
<td>借阅人姓名</td>
<td>String</td>
<td>O</td>
<td></td>
</tr>
<tr>
<td>├── returnTime</td>
<td>归还时间</td>
<td>date</td>
<td>O</td>
<td></td>
</tr>
<tr>
<td>├─  pageSize</td>
<td>页面大小</td>
<td>Integer</td>
<td>M</td>
<td>过滤条件</td>
</tr>
<tr>
<td>├─  total</td>
<td>总命中数</td>
<td>Integer</td>
<td>M</td>
<td></td>
</tr>
</tbody></table>
<p><strong>示例：</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;current&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;pageSize&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;total&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;list&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;isbn&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1234314234323&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;author&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;publisher&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="number">321</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;category&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;boughtTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2023-04-01&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;publishedTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2023-04-01&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;借出&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;classification&quot;</span><span class="punctuation">:</span> <span class="string">&quot;漫画&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;success&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>接口描述：</strong></p>
<p> 查询MySQL中book_log表数据。</p>
<h4 id="1-实现基础功能，分页，更新，删除、增加"><a href="#1-实现基础功能，分页，更新，删除、增加" class="headerlink" title="1.实现基础功能，分页，更新，删除、增加"></a>1.实现基础功能，分页，更新，删除、增加</h4><h5 id="后端-2"><a href="#后端-2" class="headerlink" title="后端"></a>后端</h5><p>BookLogServiceImpl.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> redlib.backend.service.impl;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeanUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.Assert;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.dao.BookLogMapper;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.dao.BookMapper;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.dto.BookDTO;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.dto.BookLogDTO;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.dto.query.BookLogQueryDTO;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.dto.query.BookQueryDTO;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.model.Book;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.model.BookLog;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.model.Page;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.service.AdminService;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.service.BookLogService;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.service.utils.BookLogUtils;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.service.utils.BookUtils;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.utils.FormatUtils;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.utils.PageUtils;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.vo.BookLogVO;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.vo.BookVO;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookLogServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">BookLogService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BookLogMapper bookLogMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AdminService adminService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">addBookLog</span><span class="params">(BookLogDTO bookLogDTO)</span>&#123;</span><br><span class="line">        <span class="comment">// 校验输入数据正确性</span></span><br><span class="line">        BookLogUtils.validateBookLog(bookLogDTO);</span><br><span class="line">        <span class="comment">// 创建实体对象，用以保存到数据库</span></span><br><span class="line">        <span class="type">BookLog</span> <span class="variable">bookLog</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BookLog</span>();</span><br><span class="line">        <span class="comment">// 将输入的字段全部复制到实体对象中</span></span><br><span class="line">        BeanUtils.copyProperties(bookLogDTO, bookLog);</span><br><span class="line">        <span class="comment">// 调用DAO方法保存到数据库表</span></span><br><span class="line">        bookLogMapper.insert(bookLog);</span><br><span class="line">        <span class="keyword">return</span> bookLog.getId();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">updateBookLog</span><span class="params">(BookLogDTO bookLogDTO)</span> &#123;</span><br><span class="line">        <span class="comment">// 校验输入数据正确性</span></span><br><span class="line">        BookLogUtils.validateBookLog(bookLogDTO);</span><br><span class="line">        Assert.notNull(bookLogDTO.getBookId(), <span class="string">&quot;书籍id不能为空&quot;</span>);</span><br><span class="line">        <span class="type">BookLog</span> <span class="variable">bookLog</span> <span class="operator">=</span> bookLogMapper.selectByPrimaryKey(bookLogDTO.getBookId());</span><br><span class="line">        Assert.notNull(bookLog, <span class="string">&quot;没有找到书籍，Id为：&quot;</span> + bookLogDTO.getBookId());</span><br><span class="line"></span><br><span class="line">        BeanUtils.copyProperties(bookLogDTO, bookLog);</span><br><span class="line">        bookLogMapper.updateByPrimaryKey(bookLog);</span><br><span class="line">        <span class="keyword">return</span> bookLog.getId();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Page&lt;BookLogVO&gt; <span class="title function_">listByPage</span><span class="params">(BookLogQueryDTO queryDTO)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (queryDTO == <span class="literal">null</span>) &#123;</span><br><span class="line">            queryDTO = <span class="keyword">new</span> <span class="title class_">BookLogQueryDTO</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//模糊查询</span></span><br><span class="line">        queryDTO.setBookName(FormatUtils.makeFuzzySearchTerm(queryDTO.getBookName()));</span><br><span class="line">        queryDTO.setOrderBy(FormatUtils.formatOrderBy(queryDTO.getOrderBy()));</span><br><span class="line">        <span class="comment">//将查询条件发送给dao接口，先查询命中个数</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">size</span> <span class="operator">=</span> bookLogMapper.count(queryDTO);</span><br><span class="line">        <span class="type">PageUtils</span> <span class="variable">pageUtils</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PageUtils</span>(queryDTO.getCurrent(), queryDTO.getPageSize(), size);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (size == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// 没有命中，则返回空数据。</span></span><br><span class="line">            <span class="keyword">return</span> pageUtils.getNullPage();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        List&lt;BookLog&gt; list = bookLogMapper.list(queryDTO, pageUtils.getOffset(), pageUtils.getLimit());</span><br><span class="line"></span><br><span class="line">        List&lt;BookLogVO&gt; voList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (BookLog bookLog : list) &#123;</span><br><span class="line">            <span class="type">BookLogVO</span> <span class="variable">vo</span> <span class="operator">=</span> BookLogUtils.convertToVO(bookLog);</span><br><span class="line">            voList.add(vo);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(pageUtils.getCurrent(), pageUtils.getPageSize(), pageUtils.getTotal(), voList);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteByCodes</span><span class="params">(List&lt;Integer&gt; ids)</span> &#123;</span><br><span class="line">        Assert.notEmpty(ids, <span class="string">&quot;书籍id列表不能为空&quot;</span>);</span><br><span class="line">        bookLogMapper.deleteByCodes(ids);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>BookLogService.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> redlib.backend.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> redlib.backend.dto.BookLogDTO;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.dto.query.BookLogQueryDTO;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.model.Page;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.vo.BookLogVO;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BookLogService</span> &#123;</span><br><span class="line">    Integer <span class="title function_">addBookLog</span><span class="params">(BookLogDTO bookLogDTO)</span>;</span><br><span class="line"></span><br><span class="line">    Page&lt;BookLogVO&gt; <span class="title function_">listByPage</span><span class="params">(BookLogQueryDTO queryDTO)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新部门数据</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bookLogDTO 部门输入对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 部门编码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Integer <span class="title function_">updateBookLog</span><span class="params">(BookLogDTO bookLogDTO)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据编码列表，批量删除书籍</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ids 编码列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">deleteByCodes</span><span class="params">(List&lt;Integer&gt; ids)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>BookLogMapper.xml添加</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;!-- 获取名字个数(分页) --&gt;</span><br><span class="line">&lt;select id=&quot;count&quot; resultType=&quot;integer&quot;&gt;</span><br><span class="line">  select count(*)</span><br><span class="line">  from book_log</span><br><span class="line">  &lt;where&gt;</span><br><span class="line">    &lt;if test=&quot;bookName != null&quot;&gt;</span><br><span class="line">      book_name like #&#123;bookName&#125;</span><br><span class="line">    &lt;/if&gt;</span><br><span class="line">  &lt;/where&gt;</span><br><span class="line">&lt;/select&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 获取书籍(分页) --&gt;</span><br><span class="line">&lt;select id=&quot;list&quot; resultMap=&quot;BaseResultMap&quot;&gt;</span><br><span class="line">  select</span><br><span class="line">  &lt;include refid=&quot;Base_Column_List&quot;/&gt;</span><br><span class="line">  from book_log</span><br><span class="line">  &lt;where&gt;</span><br><span class="line">    &lt;if test=&quot;queryDTO.readerName != null&quot;&gt;</span><br><span class="line">      and reader_name like #&#123;queryDTO.readerName&#125;</span><br><span class="line">    &lt;/if&gt;</span><br><span class="line">    &lt;if test=&quot;queryDTO.bookIsbn != null&quot;&gt;</span><br><span class="line">      and book_isbn like #&#123;queryDTO.bookIsbn&#125;</span><br><span class="line">    &lt;/if&gt;</span><br><span class="line">    &lt;if test=&quot;queryDTO.bookId != null&quot;&gt;</span><br><span class="line">      and book_id like #&#123;queryDTO.bookId&#125;</span><br><span class="line">    &lt;/if&gt;</span><br><span class="line">    &lt;if test=&quot;queryDTO.bookName != null&quot;&gt;</span><br><span class="line">      and book_name like #&#123;queryDTO.bookName&#125;</span><br><span class="line">    &lt;/if&gt;</span><br><span class="line">  &lt;/where&gt;</span><br><span class="line">  &lt;if test=&quot;queryDTO.orderBy != null&quot;&gt;</span><br><span class="line">    order by $&#123;queryDTO.orderBy&#125;</span><br><span class="line">  &lt;/if&gt;</span><br><span class="line">  &lt;if test=&quot;queryDTO.orderBy == null&quot;&gt;</span><br><span class="line">    order by id desc</span><br><span class="line">  &lt;/if&gt;</span><br><span class="line">  limit #&#123;offset&#125;, #&#123;limit&#125;</span><br><span class="line">&lt;/select&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 批量删除 --&gt;</span><br><span class="line">&lt;update id=&quot;deleteByCodes&quot;&gt;</span><br><span class="line">  delete from book_log</span><br><span class="line">  where id in</span><br><span class="line">  &lt;foreach item=&quot;item&quot; index=&quot;index&quot; collection=&quot;codeList&quot; open=&quot;(&quot; separator=&quot;,&quot; close=&quot;)&quot;&gt;</span><br><span class="line">    #&#123;item&#125;</span><br><span class="line">  &lt;/foreach&gt;</span><br><span class="line">&lt;/update&gt;</span><br></pre></td></tr></table></figure>

<p>BookLogMapper.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> redlib.backend.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Param;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.dto.query.BookLogQueryDTO;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.model.BookLog;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BookLogMapper</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">deleteByPrimaryKey</span><span class="params">(Integer id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">insert</span><span class="params">(BookLog record)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">insertSelective</span><span class="params">(BookLog record)</span>;</span><br><span class="line"></span><br><span class="line">    BookLog <span class="title function_">selectByPrimaryKey</span><span class="params">(Integer id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">updateByPrimaryKeySelective</span><span class="params">(BookLog record)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">updateByPrimaryKey</span><span class="params">(BookLog record)</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    List&lt;BookLog&gt; <span class="title function_">list</span><span class="params">(<span class="meta">@Param(&quot;queryDTO&quot;)</span> BookLogQueryDTO queryDTO,</span></span><br><span class="line"><span class="params">                       <span class="meta">@Param(&quot;offset&quot;)</span> Integer offset,</span></span><br><span class="line"><span class="params">                       <span class="meta">@Param(&quot;limit&quot;)</span> Integer limit)</span>;</span><br><span class="line"></span><br><span class="line">    Integer <span class="title function_">count</span><span class="params">(BookLogQueryDTO queryDTO)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据代码列表批量删除书籍</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> codeList id列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">deleteByCodes</span><span class="params">(<span class="meta">@Param(&quot;codeList&quot;)</span> List&lt;Integer&gt; codeList)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>BookLogController.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> redlib.backend.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.annotation.BackendModule;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.annotation.NeedNoPrivilege;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.annotation.Privilege;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.dto.BookDTO;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.dto.BookLogDTO;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.dto.query.BookLogQueryDTO;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.dto.query.BookQueryDTO;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.model.Page;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.service.BookLogService;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.service.BookService;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.vo.BookLogVO;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.vo.BookVO;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/bookLog&quot;)</span></span><br><span class="line"><span class="meta">@BackendModule(&#123;&quot;page:页面&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookLogController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BookLogService bookLogService;</span><br><span class="line">    <span class="meta">@PostMapping(&quot;addBookLog&quot;)</span></span><br><span class="line">    <span class="meta">@NeedNoPrivilege</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addBookLog</span><span class="params">(<span class="meta">@RequestBody</span> BookLogDTO bookLogDTO)</span>&#123;</span><br><span class="line">        bookLogService.addBookLog(bookLogDTO);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;listBookLog&quot;)</span></span><br><span class="line"><span class="comment">//    @Privilege(&quot;page&quot;)</span></span><br><span class="line">    <span class="meta">@NeedNoPrivilege</span></span><br><span class="line">    <span class="keyword">public</span> Page&lt;BookLogVO&gt; <span class="title function_">listBookLog</span><span class="params">(<span class="meta">@RequestBody</span> BookLogQueryDTO queryDTO)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> bookLogService.listByPage(queryDTO);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;updateBookLog&quot;)</span></span><br><span class="line">    <span class="meta">@Privilege(&quot;update&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">updateBookLog</span><span class="params">(<span class="meta">@RequestBody</span> BookLogDTO bookLogDTO)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> bookLogService.updateBookLog(bookLogDTO);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;deleteBookLog&quot;)</span></span><br><span class="line">    <span class="meta">@Privilege(&quot;delete&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteBookLog</span><span class="params">(<span class="meta">@RequestBody</span> List&lt;Integer&gt; ids)</span> &#123;</span><br><span class="line">        bookLogService.deleteByCodes(ids);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>BookLogQueryDTO.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> redlib.backend.dto.query;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> bsgbs</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookLogQueryDTO</span> <span class="keyword">extends</span> <span class="title class_">PageQueryDTO</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer readerId;</span><br><span class="line">    <span class="keyword">private</span> String readerName;</span><br><span class="line">    <span class="keyword">private</span> Integer bookId;</span><br><span class="line">    <span class="keyword">private</span> String bookIsbn;</span><br><span class="line">    <span class="keyword">private</span> String bookName;</span><br><span class="line">    <span class="keyword">private</span> String orderBy;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>BookLogDTO.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> redlib.backend.dto;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonFormat;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookLogDTO</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String readerName;</span><br><span class="line">    <span class="keyword">private</span> Integer bookId;</span><br><span class="line">    <span class="keyword">private</span> String bookName;</span><br><span class="line">    <span class="keyword">private</span> String bookIsbn;</span><br><span class="line">    <span class="meta">@JsonFormat(pattern = &quot;yyyy-MM-dd&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date borrowedTime;</span><br><span class="line">    <span class="meta">@JsonFormat(pattern = &quot;yyyy-MM-dd&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date returnTime;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>BookLogVO.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> redlib.backend.vo;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> redlib.backend.model.BookLog;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> bsgbs</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookLogVO</span> <span class="keyword">extends</span> <span class="title class_">BookLog</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="前端-2"><a href="#前端-2" class="headerlink" title="前端"></a>前端</h5><h6 id="index主页面"><a href="#index主页面" class="headerlink" title="index主页面"></a>index主页面</h6><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;  deleteBookLog,listBookLog &#125; <span class="keyword">from</span> <span class="string">&#x27;@/services/api/bookLog&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; convertPageData,orderBy &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; openConfirm &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/ui&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">PlusOutlined</span>, <span class="title class_">DeleteOutlined</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@ant-design/icons&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ActionType</span>, <span class="title class_">PageContainer</span>, <span class="title class_">ProColumns</span>, <span class="title class_">ProTable</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@ant-design/pro-components&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Button</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useRef, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">InputDialog</span> <span class="keyword">from</span> <span class="string">&#x27;./InputDialog&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> refAction = useRef&lt;<span class="title class_">ActionType</span>&gt;(<span class="literal">null</span>);</span><br><span class="line">  <span class="comment">//声明两个常量，变量名为selectedRowKeys，改变变量值的方法为selectRow</span></span><br><span class="line">  <span class="keyword">const</span> [selectedRowKeys, selectRow] = useState&lt;<span class="built_in">number</span>[]&gt;([]);</span><br><span class="line">  <span class="comment">//声明页面级状态变量，将变量传递给对话框，&lt;&gt;内表示是什么类型的数据，()为空表示不对其初始化</span></span><br><span class="line">  <span class="keyword">const</span> [book, setBook] = useState&lt;<span class="variable constant_">API</span>.<span class="property">BookLogVO</span>&gt;();</span><br><span class="line">  <span class="keyword">const</span> [visible, setVisible] = <span class="title function_">useState</span>(<span class="literal">false</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> <span class="attr">columns</span>: <span class="title class_">ProColumns</span>&lt;<span class="variable constant_">API</span>.<span class="property">BookLogVO</span>&gt;[] = [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;书籍ID&#x27;</span>,</span><br><span class="line">      <span class="attr">dataIndex</span>: <span class="string">&#x27;bookId&#x27;</span>,</span><br><span class="line">      <span class="attr">sorter</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">fixed</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">width</span>: <span class="number">50</span>,</span><br><span class="line">      <span class="attr">search</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;书名&#x27;</span>,</span><br><span class="line">      <span class="attr">dataIndex</span>: <span class="string">&#x27;bookName&#x27;</span>,</span><br><span class="line">      <span class="attr">width</span>: <span class="number">100</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;借阅人&#x27;</span>,</span><br><span class="line">      <span class="attr">dataIndex</span>: <span class="string">&#x27;readerName&#x27;</span>,</span><br><span class="line">      <span class="attr">fixed</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">width</span>: <span class="number">100</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;ISBN&#x27;</span>,</span><br><span class="line">      <span class="attr">dataIndex</span>: <span class="string">&#x27;bookIsbn&#x27;</span>,</span><br><span class="line">      <span class="attr">width</span>: <span class="number">100</span>,</span><br><span class="line">      <span class="attr">search</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;借阅日期&#x27;</span>,</span><br><span class="line">      <span class="attr">width</span>: <span class="number">100</span>,</span><br><span class="line">      <span class="attr">sorter</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">dataIndex</span>: <span class="string">&#x27;borrowedTime&#x27;</span>,</span><br><span class="line">      <span class="attr">valueType</span>: <span class="string">&#x27;date&#x27;</span>,</span><br><span class="line">      <span class="attr">search</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;还书日期&#x27;</span>,</span><br><span class="line">      <span class="attr">dataIndex</span>: <span class="string">&#x27;returnTime&#x27;</span>,</span><br><span class="line">      <span class="attr">key</span>: <span class="string">&#x27;returnTime&#x27;</span>,</span><br><span class="line">      <span class="attr">valueType</span>: <span class="string">&#x27;date&#x27;</span>,</span><br><span class="line">      <span class="attr">width</span>: <span class="number">100</span>,</span><br><span class="line">      <span class="attr">search</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  ];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">PageContainer</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &lt;ProTable<span class="tag">&lt;<span class="name">API.BookLogVO</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        actionRef=&#123;refAction&#125;</span></span><br><span class="line"><span class="language-xml">        rowKey=&quot;id&quot;</span></span><br><span class="line"><span class="language-xml">        pagination=&#123;&#123;</span></span><br><span class="line"><span class="language-xml">          defaultPageSize: 10,</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;</span></span><br><span class="line"><span class="language-xml">        search=&#123;&#123;</span></span><br><span class="line"><span class="language-xml">          labelWidth: 120,</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;</span></span><br><span class="line"><span class="language-xml">        scroll=&#123;&#123; x: 100 &#125;&#125;</span></span><br><span class="line"><span class="language-xml">        request=&#123;async (params = &#123;&#125;, sort) =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">          console.log(sort);</span></span><br><span class="line"><span class="language-xml">          return convertPageData(await listBookLog(&#123; ...params, orderBy: orderBy(sort) &#125;));</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;</span></span><br><span class="line"><span class="language-xml">        columns=&#123;columns&#125;</span></span><br><span class="line"><span class="language-xml">      /&gt;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">PageContainer</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  );</span></span><br><span class="line"><span class="language-xml">&#125;;</span></span><br></pre></td></tr></table></figure>

<h6 id="inputdialog页面"><a href="#inputdialog页面" class="headerlink" title="inputdialog页面"></a>inputdialog页面</h6><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ModalForm</span>, <span class="title class_">ProForm</span>, <span class="title class_">ProFormInstance</span>, <span class="title class_">ProFormSelect</span>, <span class="title class_">ProFormText</span>, <span class="title class_">ProFormDatePicker</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@ant-design/pro-components&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; message, <span class="title class_">Switch</span>, <span class="title class_">Tooltip</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useEffect, useRef, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; waitTime &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; addBook, updateBook &#125; <span class="keyword">from</span> <span class="string">&#x27;@/services/api/book&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> moment <span class="keyword">from</span> <span class="string">&#x27;dayjs&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">InputDialogProps</span> &#123;</span><br><span class="line">  detailData?: <span class="variable constant_">API</span>.<span class="property">BookDTO</span>;</span><br><span class="line">  <span class="attr">visible</span>: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">onClose</span>: <span class="function">(<span class="params">result: <span class="built_in">boolean</span></span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">InputDialog</span>(<span class="params">props: InputDialogProps</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> form = useRef&lt;<span class="title class_">ProFormInstance</span>&gt;(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> [<span class="keyword">readonly</span>, setReadonly] = <span class="title function_">useState</span>(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">waitTime</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (props.<span class="property">detailData</span>) &#123;</span><br><span class="line">        form?.<span class="property">current</span>?.<span class="title function_">setFieldsValue</span>(props.<span class="property">detailData</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        form?.<span class="property">current</span>?.<span class="title function_">resetFields</span>();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;, [props.<span class="property">detailData</span>, props.<span class="property">visible</span>]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">onFinish</span> = <span class="keyword">async</span> (<span class="params">values: <span class="built_in">any</span></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; name, isbn, author, publisher, price, category, boughtTime, publishedTime, status &#125; = values;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">data</span>: <span class="variable constant_">API</span>.<span class="property">BookDTO</span> = &#123;</span><br><span class="line">      <span class="attr">id</span>: props.<span class="property">detailData</span>?.<span class="property">id</span>,</span><br><span class="line">      name,</span><br><span class="line">      isbn,</span><br><span class="line">      author,</span><br><span class="line">      publisher,</span><br><span class="line">      price,</span><br><span class="line">      category,</span><br><span class="line">      boughtTime,</span><br><span class="line">      publishedTime,</span><br><span class="line">      status,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (props.<span class="property">detailData</span>) &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="title function_">updateBook</span>(data);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="title function_">addBook</span>(data);</span><br><span class="line">    &#125;</span><br><span class="line">    message.<span class="title function_">success</span>(<span class="string">&#x27;保存成功&#x27;</span>);</span><br><span class="line">    props.<span class="title function_">onClose</span>(<span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="comment">//返回一个模态对话框</span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">ModalForm</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">width</span>=<span class="string">&#123;600&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">onFinish</span>=<span class="string">&#123;onFinish&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">formRef</span>=<span class="string">&#123;form&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">modalProps</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">destroyOnClose:</span> <span class="attr">true</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onCancel:</span> () =&gt;</span> props.onClose(false),</span></span><br><span class="line"><span class="language-xml">      &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      title=&#123;props.detailData ? &#x27;修改书籍&#x27; : &#x27;新增书籍&#x27;&#125;</span></span><br><span class="line"><span class="language-xml">      open=&#123;props.visible&#125;</span></span><br><span class="line"><span class="language-xml">    &gt;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ProForm.Group</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ProFormText</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;name&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">label</span>=<span class="string">&quot;书籍名称&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">rules</span>=<span class="string">&#123;[</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &#123;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">required:</span> <span class="attr">true</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">message:</span> &#x27;<span class="attr">请输入书籍名称</span>！&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &#125;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          ]&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ProFormText</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;isbn&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">label</span>=<span class="string">&quot;ISBN&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">tooltip</span>=<span class="string">&quot;输入必须为13位&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">rules</span>=<span class="string">&#123;[</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &#123;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">required:</span> <span class="attr">true</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">message:</span> &#x27;<span class="attr">请输入ISBN号</span>！&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &#125;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &#123;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              // <span class="attr">此处设为false可以解决填写后退格导致两种报错的问题</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">required:</span> <span class="attr">false</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">message:</span> &#x27;<span class="attr">ISBN格式不符合要求</span>！&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">max:</span> <span class="attr">13</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">min:</span> <span class="attr">13</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &#125;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          ]&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ProForm.Group</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ProForm.Group</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ProFormText</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;publisher&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">label</span>=<span class="string">&quot;出版社&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">rules</span>=<span class="string">&#123;[</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &#123;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">required:</span> <span class="attr">true</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">message:</span> &#x27;<span class="attr">请输入出版社名称</span>！&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &#125;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          ]&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ProFormText</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;author&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">label</span>=<span class="string">&quot;作者&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">rules</span>=<span class="string">&#123;[</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &#123;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">required:</span> <span class="attr">true</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">message:</span> &#x27;<span class="attr">请输入作者名称</span>！&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &#125;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          ]&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ProForm.Group</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ProForm.Group</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ProFormText</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;price&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">label</span>=<span class="string">&quot;书籍价格&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ProFormText</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;category&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">label</span>=<span class="string">&quot;分类号&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ProForm.Group</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ProForm.Group</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ProFormDatePicker</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;boughtTime&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">label</span>=<span class="string">&quot;购买时间&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">initialValue</span>=<span class="string">&#123;moment()&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ProFormDatePicker</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;publishedTime&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">label</span>=<span class="string">&quot;出版时间&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">initialValue</span>=<span class="string">&#123;moment()&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ProFormSelect</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;status&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">label</span>=<span class="string">&quot;状态&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">options</span>=<span class="string">&#123;[</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &#123; <span class="attr">label:</span> &#x27;<span class="attr">在架</span>&#x27;, <span class="attr">value:</span> &#x27;<span class="attr">在架</span>&#x27; &#125;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &#123; <span class="attr">label:</span> &#x27;<span class="attr">借出</span>&#x27;, <span class="attr">value:</span> &#x27;<span class="attr">借出</span>&#x27; &#125;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          ]&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ProForm.Group</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    &lt;/ModalForm &gt;</span></span><br><span class="line"><span class="language-xml">  );</span></span><br><span class="line"><span class="language-xml">&#125;</span></span><br></pre></td></tr></table></figure>



<h4 id="2-序号及借阅日期排序"><a href="#2-序号及借阅日期排序" class="headerlink" title="2.序号及借阅日期排序"></a>2.序号及借阅日期排序</h4><h5 id="前端-3"><a href="#前端-3" class="headerlink" title="前端"></a>前端</h5><p>return中添加</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">ProTable</span>&lt;<span class="variable constant_">API</span>.<span class="property">BookLogVO</span>&gt;</span><br><span class="line">        actionRef=&#123;refAction&#125;</span><br><span class="line">        rowKey=<span class="string">&quot;id&quot;</span></span><br><span class="line">        pagination=&#123;&#123;</span><br><span class="line">          <span class="attr">defaultPageSize</span>: <span class="number">10</span>,</span><br><span class="line">        &#125;&#125;</span><br><span class="line">        search=&#123;&#123;</span><br><span class="line">          <span class="attr">labelWidth</span>: <span class="number">120</span>,</span><br><span class="line">        &#125;&#125;</span><br><span class="line">        scroll=&#123;&#123; <span class="attr">x</span>: <span class="number">100</span> &#125;&#125;</span><br><span class="line">        request=&#123;<span class="keyword">async</span> (params = &#123;&#125;, sort) =&gt; &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(sort);</span><br><span class="line">          <span class="keyword">return</span> <span class="title function_">convertPageData</span>(<span class="keyword">await</span> <span class="title function_">listBookLog</span>(&#123; ...params, <span class="attr">orderBy</span>: <span class="title function_">orderBy</span>(sort) &#125;));</span><br><span class="line">        &#125;&#125;</span><br><span class="line">        columns=&#123;columns&#125;</span><br><span class="line">      /&gt;</span><br></pre></td></tr></table></figure>

<h5 id="后端-3"><a href="#后端-3" class="headerlink" title="后端"></a>后端</h5><p>BookLogServiceImpl.java中添加</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">queryDTO.setOrderBy(FormatUtils.formatOrderBy(queryDTO.getOrderBy()));</span><br></pre></td></tr></table></figure>

<p>BookLogQueryDTO.java中添加</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> String orderBy;</span><br></pre></td></tr></table></figure>

<p>xml中</where>后添加</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;if test=&quot;queryDTO.orderBy != null&quot;&gt;</span><br><span class="line">      order by $&#123;queryDTO.orderBy&#125;</span><br><span class="line">    &lt;/if&gt;</span><br><span class="line">    &lt;if test=&quot;queryDTO.orderBy == null&quot;&gt;</span><br><span class="line">      order by id desc</span><br><span class="line">    &lt;/if&gt;</span><br></pre></td></tr></table></figure>

<h5 id="测试-3"><a href="#测试-3" class="headerlink" title="测试"></a>测试</h5><p>点击书籍ID排序如下</p>
<p><img src="E:\Files\Projects\CXCollege\software\Image\19.png" alt="19"></p>
<p><img src="E:\Files\Projects\CXCollege\software\Image\20.png" alt="20"></p>
<h3 id="借书"><a href="#借书" class="headerlink" title="借书"></a>借书</h3><h4 id="接口设计-1"><a href="#接口设计-1" class="headerlink" title="接口设计"></a>接口设计</h4><h5 id="借书-1"><a href="#借书-1" class="headerlink" title="借书"></a>借书</h5><p><strong>接口地址</strong>：book&#x2F;lendBook</p>
<p><strong>请求方法</strong>: POST</p>
<p><strong>入参</strong></p>
<table>
<thead>
<tr>
<th>参数名</th>
<th>参数描述</th>
<th>数据类型</th>
<th>必填</th>
<th>示例&#x2F;备注</th>
</tr>
</thead>
<tbody><tr>
<td>bookDTO</td>
<td>BookDTO数据</td>
<td>List  of Object</td>
<td>M</td>
<td></td>
</tr>
<tr>
<td>├─ id</td>
<td>书籍id</td>
<td>Integer</td>
<td>M</td>
<td>主键</td>
</tr>
<tr>
<td>├─ name</td>
<td>书名</td>
<td>List  of Object</td>
<td>O</td>
<td></td>
</tr>
<tr>
<td>├─ isbn</td>
<td>书籍isbn</td>
<td>String</td>
<td>O</td>
<td></td>
</tr>
<tr>
<td>├─ author</td>
<td>书籍作者</td>
<td>String</td>
<td>O</td>
<td></td>
</tr>
<tr>
<td>├─ publisher</td>
<td>出版社</td>
<td>String</td>
<td>O</td>
<td></td>
</tr>
<tr>
<td>├─ price</td>
<td>书籍价格</td>
<td>Double</td>
<td>O</td>
<td></td>
</tr>
<tr>
<td>├─ category</td>
<td>书籍分类号</td>
<td>Integer</td>
<td>O</td>
<td></td>
</tr>
<tr>
<td>├─ boughtTime</td>
<td>书籍购买时间</td>
<td>date</td>
<td>O</td>
<td></td>
</tr>
<tr>
<td>├─ publishedTime</td>
<td>书籍出版时间</td>
<td>date</td>
<td>O</td>
<td></td>
</tr>
<tr>
<td>├─  status</td>
<td>书籍状态</td>
<td>String</td>
<td>O</td>
<td>过滤条件</td>
</tr>
<tr>
<td>├─  classification</td>
<td>书籍分类</td>
<td>String</td>
<td>O</td>
<td></td>
</tr>
<tr>
<td>bookLogDTO</td>
<td>LogDTO数据</td>
<td>List  of Object</td>
<td>M</td>
<td></td>
</tr>
<tr>
<td>├─ readerName</td>
<td>当前页面</td>
<td>String</td>
<td>M</td>
<td></td>
</tr>
<tr>
<td>├─ borrowedTime</td>
<td>返回列表</td>
<td>date</td>
<td>O</td>
<td></td>
</tr>
</tbody></table>
<p><strong>出参：</strong>无</p>
<p><strong>示例：</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span><span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;message&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;success&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>接口描述：</strong></p>
<p>1.前端向后端发送选中书籍信息和借阅信息，后端将借阅日志所需的信息从书籍信息中复制进来。</p>
<p>2.后端根据书籍id检索，自动更新书籍状态为“借出”，并且增加一条借阅日志。</p>
<h4 id="1-实现借书功能"><a href="#1-实现借书功能" class="headerlink" title="1.实现借书功能"></a>1.实现借书功能</h4><h5 id="后端-4"><a href="#后端-4" class="headerlink" title="后端"></a>后端</h5><p>参考Department的写法，之前在添加部门中使用insert函数添加，理论上只要添加适当的函数即可在借还书籍时同时为log中添加记录</p>
<p><img src="E:\Files\Projects\CXCollege\software\Image\16.png" alt="16"></p>
<p>添加BookAndLogDTO类用于接收前端传递的参数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookAndLogDTO</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> BookDTO bookDTO;</span><br><span class="line">    <span class="keyword">private</span> BookLogDTO bookLogDTO;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>BookService.java添加接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Integer <span class="title function_">lendBook</span><span class="params">(BookAndLogDTO bookAndLogDTO)</span>;</span><br></pre></td></tr></table></figure>

<p>Impl.java中完善</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Integer <span class="title function_">lendBook</span><span class="params">(BookAndLogDTO bookAndLogDTO)</span>&#123;</span><br><span class="line">    <span class="comment">// 校验输入数据正确性</span></span><br><span class="line">    BookLogUtils.validateBookLog(bookAndLogDTO.getBookLogDTO());</span><br><span class="line">    BookUtils.validateBook(bookAndLogDTO.getBookDTO());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建实体对象，用以保存到数据库</span></span><br><span class="line">    <span class="type">BookLog</span> <span class="variable">log</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BookLog</span>();</span><br><span class="line">    <span class="type">Book</span> <span class="variable">book</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Book</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//修改书籍状态为借出</span></span><br><span class="line">    bookAndLogDTO.getBookDTO().setStatus(<span class="string">&quot;借出&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将输入的字段全部复制到实体对象中</span></span><br><span class="line">    <span class="comment">//将两个DTO中的数据传递到log中，便于使用bookLogMapper中的insert函数</span></span><br><span class="line">    BeanUtils.copyProperties(BookLogUtils.convertToDTO(bookAndLogDTO),log);</span><br><span class="line">    <span class="comment">//将bookAndLogDTO类中的BookDTO()数据传入book中用于更新状态为借出</span></span><br><span class="line">    BeanUtils.copyProperties(bookAndLogDTO.getBookDTO(), book);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 调用DAO方法保存到数据库表</span></span><br><span class="line">    bookLogMapper.insert(log);</span><br><span class="line">    <span class="comment">// 更新书籍状态</span></span><br><span class="line">    bookMapper.updateByPrimaryKey(book);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> log.getId();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>BookController.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;lendBook&quot;)</span></span><br><span class="line"><span class="meta">@Privilege(&quot;lend&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Integer <span class="title function_">lendBook</span><span class="params">(<span class="meta">@RequestBody</span> BookAndLogDTO bookAndLogDTO)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> bookService.lendBook(bookAndLogDTO);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>BookLogUtils.java中添加格式转换函数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    将两个DTO中的数据传递到log中，便于使用bookLogMapper中的insert函数</span></span><br><span class="line"><span class="comment">    接收BookAndLogDTO类型，复制内容并输出为bookLogDTO类型</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> BookLogDTO <span class="title function_">convertToDTO</span><span class="params">(BookAndLogDTO bookAndLogDTO)</span> &#123;</span><br><span class="line">    <span class="type">BookLogDTO</span> <span class="variable">bookLogDTO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BookLogDTO</span>();</span><br><span class="line">    <span class="comment">//此处无法直接Copy，因为需要把两个不同的DTO中的数据传递到bookLogDTO中</span></span><br><span class="line">    bookLogDTO.setBookId(bookAndLogDTO.getBookDTO().getId());</span><br><span class="line">    bookLogDTO.setBookName(bookAndLogDTO.getBookDTO().getName());</span><br><span class="line">    bookLogDTO.setBookIsbn(bookAndLogDTO.getBookDTO().getIsbn());</span><br><span class="line"></span><br><span class="line">    bookLogDTO.setBorrowedTime(bookAndLogDTO.getBookLogDTO().getBorrowedTime());</span><br><span class="line">    bookLogDTO.setReturnTime(bookAndLogDTO.getBookLogDTO().getReturnTime());</span><br><span class="line">    bookLogDTO.setReaderName(bookAndLogDTO.getBookLogDTO().getReaderName());</span><br><span class="line">    <span class="keyword">return</span> bookLogDTO;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="前端-4"><a href="#前端-4" class="headerlink" title="前端"></a>前端</h5><h6 id="主页面添加借书对话框"><a href="#主页面添加借书对话框" class="headerlink" title="主页面添加借书对话框"></a>主页面添加借书对话框</h6><p>导入对话框组件</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">InputDialog2</span> <span class="keyword">from</span> <span class="string">&#x27;./InputDialog2&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>定义变量</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [bookLog, setBookLog] = useState&lt;<span class="variable constant_">API</span>.<span class="property">BookVO</span>&gt;();</span><br><span class="line"><span class="keyword">const</span> [lendVisible, setLendVisible] = <span class="title function_">useState</span>(<span class="literal">false</span>);</span><br></pre></td></tr></table></figure>

<p>实现对话框交互</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">InputDialog2</span></span><br><span class="line">detailData=&#123;bookLog&#125;</span><br><span class="line">onClose=&#123;<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">setLendVisible</span>(<span class="literal">false</span>);</span><br><span class="line">    result &amp;&amp; refAction.<span class="property">current</span>?.<span class="title function_">reload</span>();</span><br><span class="line">&#125;&#125;</span><br><span class="line">visible=&#123;lendVisible&#125;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>

<p>对话框实现按钮</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">Button</span></span><br><span class="line"><span class="keyword">type</span>=<span class="string">&quot;primary&quot;</span></span><br><span class="line">key=<span class="string">&quot;primary&quot;</span></span><br><span class="line">onClick=&#123;<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">setLendVisible</span>(<span class="literal">true</span>);</span><br><span class="line">&#125;&#125;</span><br><span class="line">disabled=&#123;!selectedRowKeys?.<span class="property">length</span>&#125;</span><br><span class="line">&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">LogoutOutlined</span> /&gt;</span></span> 借出</span><br><span class="line">&lt;/<span class="title class_">Button</span>&gt;,</span><br></pre></td></tr></table></figure>

<h6 id="借书思路"><a href="#借书思路" class="headerlink" title="借书思路"></a><strong>借书思路</strong></h6><blockquote>
<ul>
<li>选择某一行，可以点击“借阅”按钮，实现借书</li>
<li>点击借书，对话框内显示书籍资料，手动填入借阅人信息</li>
<li>后续考虑扩展为选择多行书籍，同时借阅</li>
</ul>
</blockquote>
<p>通过查询选择行的代码，发现**onChange()**函数，可以自带两个参数</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">onChange?: <span class="function">(<span class="params">selectedRowKeys: Key[], selectedRows: T[], info: &#123;</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">type</span>: RowSelectMethod;</span></span></span><br><span class="line"><span class="params"><span class="function">&#125;</span>) =&gt;</span> <span class="built_in">void</span>;</span><br></pre></td></tr></table></figure>

<p>其中第一个参数为选择行的主键（即ID），第二个参数为选择行的列表<strong>（此特性也为后续选择多行同时借阅提供可能）</strong></p>
<p>因此，实现借出一本书只需要传递records[0]到对话框即可，代码如下</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">rowSelection=&#123;&#123;</span><br><span class="line">    <span class="attr">onChange</span>: <span class="function">(<span class="params">rowKeys, records</span>) =&gt;</span> &#123;</span><br><span class="line">		<span class="title function_">selectRow</span>(rowKeys <span class="keyword">as</span> <span class="built_in">number</span>[]);</span><br><span class="line">   	 	<span class="title function_">setBookLog</span>(records[<span class="number">0</span>]);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;&#125;</span><br></pre></td></tr></table></figure>

<h6 id="inputdialog对话框"><a href="#inputdialog对话框" class="headerlink" title="inputdialog对话框"></a>inputdialog对话框</h6><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ModalForm</span>, <span class="title class_">ProForm</span>, <span class="title class_">ProFormInstance</span>, <span class="title class_">ProFormSelect</span>, <span class="title class_">ProFormText</span>, <span class="title class_">ProFormDatePicker</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@ant-design/pro-components&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; message, <span class="title class_">Switch</span>, <span class="title class_">Tooltip</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useEffect, useRef, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; waitTime &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; addBook, updateBook, lendBook &#125; <span class="keyword">from</span> <span class="string">&#x27;@/services/api/book&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> moment <span class="keyword">from</span> <span class="string">&#x27;dayjs&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; addBookLog, updateBookLog &#125; <span class="keyword">from</span> <span class="string">&#x27;@/services/api/bookLog&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">InputDialogProps</span> &#123;</span><br><span class="line">  detailData?: <span class="variable constant_">API</span>.<span class="property">BookDTO</span>;</span><br><span class="line">  <span class="attr">visible</span>: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">onClose</span>: <span class="function">(<span class="params">result: <span class="built_in">boolean</span></span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">InputDialog</span>(<span class="params">props: InputDialogProps</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> form = useRef&lt;<span class="title class_">ProFormInstance</span>&gt;(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> [<span class="keyword">readonly</span>, setReadonly] = <span class="title function_">useState</span>(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">waitTime</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (props.<span class="property">detailData</span>) &#123;</span><br><span class="line">        form?.<span class="property">current</span>?.<span class="title function_">setFieldsValue</span>(props.<span class="property">detailData</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        form?.<span class="property">current</span>?.<span class="title function_">resetFields</span>();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;, [props.<span class="property">detailData</span>, props.<span class="property">visible</span>]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">onFinish</span> = <span class="keyword">async</span> (<span class="params">values: <span class="built_in">any</span></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; name, isbn, author, publisher, price, category, boughtTime, publishedTime, status, classification,</span><br><span class="line">      readerName, bookId, bookName, bookIsbn, borrowedTime, returnTime &#125; = values;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">data</span>: <span class="variable constant_">API</span>.<span class="property">BookAndLogDTO</span> = &#123;</span><br><span class="line">      <span class="attr">bookDTO</span>: &#123;</span><br><span class="line">        <span class="attr">id</span>: props.<span class="property">detailData</span>?.<span class="property">id</span>,</span><br><span class="line">        name,</span><br><span class="line">        isbn,</span><br><span class="line">        author,</span><br><span class="line">        publisher,</span><br><span class="line">        price,</span><br><span class="line">        category,</span><br><span class="line">        boughtTime,</span><br><span class="line">        publishedTime,</span><br><span class="line">        status,</span><br><span class="line">        classification</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">bookLogDTO</span>: &#123;</span><br><span class="line">        readerName,</span><br><span class="line">        bookId,</span><br><span class="line">        bookName,</span><br><span class="line">        bookIsbn,</span><br><span class="line">        borrowedTime,</span><br><span class="line">        returnTime</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (props.<span class="property">detailData</span>) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">lendBook</span>(data);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        message.<span class="title function_">success</span>(<span class="string">&#x27;借出成功&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    props.<span class="title function_">onClose</span>(<span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="comment">//返回一个模态对话框</span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">ModalForm</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">width</span>=<span class="string">&#123;600&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">onFinish</span>=<span class="string">&#123;onFinish&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">formRef</span>=<span class="string">&#123;form&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">modalProps</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">destroyOnClose:</span> <span class="attr">true</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onCancel:</span> () =&gt;</span> props.onClose(false),</span></span><br><span class="line"><span class="language-xml">      &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      title=&#123;props.detailData ? &#x27;借出&#x27; : &#x27;借出&#x27;&#125;</span></span><br><span class="line"><span class="language-xml">      open=&#123;props.visible&#125;</span></span><br><span class="line"><span class="language-xml">    &gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ProFormText</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">name</span>=<span class="string">&quot;category&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">label</span>=<span class="string">&quot;category&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">hidden</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ProFormText</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">name</span>=<span class="string">&quot;boughtTime&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">label</span>=<span class="string">&quot;boughtTime&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">hidden</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ProFormText</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">name</span>=<span class="string">&quot;publishedTime&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">label</span>=<span class="string">&quot;publishedTime&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">hidden</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ProFormText</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">name</span>=<span class="string">&quot;classification&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">label</span>=<span class="string">&quot;classification&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">hidden</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      /&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ProForm.Group</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ProFormText</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;name&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">label</span>=<span class="string">&quot;书名&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ProFormText</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;isbn&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">label</span>=<span class="string">&quot;ISBN&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ProForm.Group</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ProForm.Group</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ProFormText</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;publisher&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">label</span>=<span class="string">&quot;出版社&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ProFormText</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;author&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">label</span>=<span class="string">&quot;作者&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ProForm.Group</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ProForm.Group</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ProFormText</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;price&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">label</span>=<span class="string">&quot;书籍价格&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ProFormText</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;category&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">label</span>=<span class="string">&quot;分类号&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ProForm.Group</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ProForm.Group</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ProFormSelect</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;status&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">label</span>=<span class="string">&quot;状态&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">options</span>=<span class="string">&#123;[</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &#123; <span class="attr">label:</span> &#x27;<span class="attr">在架</span>&#x27;, <span class="attr">value:</span> &#x27;<span class="attr">在架</span>&#x27; &#125;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &#123; <span class="attr">label:</span> &#x27;<span class="attr">借出</span>&#x27;, <span class="attr">value:</span> &#x27;<span class="attr">借出</span>&#x27; &#125;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          ]&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ProForm.Group</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ProForm.Group</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ProFormText</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;readerName&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">label</span>=<span class="string">&quot;借阅人&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ProFormDatePicker</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;borrowedTime&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">label</span>=<span class="string">&quot;借出日期&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">initialValue</span>=<span class="string">&#123;moment()&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ProForm.Group</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    &lt;/ModalForm &gt;</span></span><br><span class="line"><span class="language-xml">  );</span></span><br><span class="line"><span class="language-xml">&#125;</span></span><br></pre></td></tr></table></figure>

<h6 id="测试-4"><a href="#测试-4" class="headerlink" title="测试"></a>测试</h6><p>id为1的书籍目前在架</p>
<p><img src="E:\Files\Projects\CXCollege\software\Image\21.png" alt="21"></p>
<p>选择借出，并添加借阅人</p>
<p><img src="E:\Files\Projects\CXCollege\software\Image\22.png" alt="22"></p>
<p>书籍状态变为借出，并且借阅记录表格中新增一条记录</p>
<p><img src="E:\Files\Projects\CXCollege\software\Image\23.png" alt="23"></p>
<p><img src="E:\Files\Projects\CXCollege\software\Image\24.png" alt="24"></p>
<h4 id="2-判断借书不合理的操作"><a href="#2-判断借书不合理的操作" class="headerlink" title="2.判断借书不合理的操作"></a>2.判断借书不合理的操作</h4><h5 id="后端-5"><a href="#后端-5" class="headerlink" title="后端"></a>后端</h5><p>BookServiceImpl.java中的LendBook()函数开头添加</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 校验输入数据正确性</span></span><br><span class="line">BookLogUtils.validateBookLog(bookAndLogDTO.getBookLogDTO());</span><br><span class="line"><span class="comment">//书籍状态不是“在架”，则不能借出此书</span></span><br><span class="line">Assert.isTrue(bookAndLogDTO.getBookDTO().getStatus()!=<span class="string">&quot;在架&quot;</span>, <span class="string">&quot;书籍不在架&quot;</span>);</span><br><span class="line">BookUtils.validateBook(bookAndLogDTO.getBookDTO());</span><br></pre></td></tr></table></figure>

<p>BookLogUtils.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">validateBookLog</span><span class="params">(BookLogDTO bookLogDTO)</span> &#123;</span><br><span class="line">    FormatUtils.trimFieldToNull(bookLogDTO);</span><br><span class="line">    Assert.hasText(bookLogDTO.getReaderName(), <span class="string">&quot;借阅人不能为空&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="前端-5"><a href="#前端-5" class="headerlink" title="前端"></a>前端</h5><p>前端若不做处理，虽然后端会assert断言错误，但是前端仍然会显示“借出成功”。此时，需要将其做以下修改</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (props.<span class="property">detailData</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">lendBook</span>(data);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        message.<span class="title function_">success</span>(<span class="string">&#x27;借出成功&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="3-一次借多本书"><a href="#3-一次借多本书" class="headerlink" title="3.一次借多本书"></a>3.一次借多本书</h4><h5 id="前端-6"><a href="#前端-6" class="headerlink" title="前端"></a>前端</h5><p>主页面修改之前数组的第一个元素为所有数组</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setBookLog</span>(records);</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ModalForm</span>, <span class="title class_">ProForm</span>, <span class="title class_">ProFormInstance</span>, <span class="title class_">ProFormSelect</span>, <span class="title class_">ProFormText</span>, <span class="title class_">ProFormDatePicker</span>, <span class="title class_">ProTable</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@ant-design/pro-components&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; message, <span class="title class_">Switch</span>, <span class="title class_">Tooltip</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useEffect, useRef, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; waitTime &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; lendBooks &#125; <span class="keyword">from</span> <span class="string">&#x27;@/services/api/book&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> moment <span class="keyword">from</span> <span class="string">&#x27;dayjs&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">InputDialogProps</span> &#123;</span><br><span class="line">  detailData?: <span class="variable constant_">API</span>.<span class="property">BookDTO</span>[];</span><br><span class="line">  <span class="attr">visible</span>: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">onClose</span>: <span class="function">(<span class="params">result: <span class="built_in">boolean</span></span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">InputDialog</span>(<span class="params">props: InputDialogProps</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> form = useRef&lt;<span class="title class_">ProFormInstance</span>&gt;(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 222222222注意两dialog中有两种类型</span></span><br><span class="line">  <span class="comment">// 注意不同位置注释语法不同，不要被坑了</span></span><br><span class="line">  <span class="keyword">const</span> [formData, setFormData] = useState&lt;<span class="variable constant_">API</span>.<span class="property">BookDTO</span>[]&gt;([]);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;formData&quot;</span>)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(formData)</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">waitTime</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (props.<span class="property">detailData</span>) &#123;</span><br><span class="line">        form?.<span class="property">current</span>?.<span class="title function_">setFieldsValue</span>(props.<span class="property">detailData</span>);</span><br><span class="line">        <span class="title function_">setFormData</span>(props.<span class="property">detailData</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        form?.<span class="property">current</span>?.<span class="title function_">resetFields</span>();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;, [props.<span class="property">detailData</span>, props.<span class="property">visible</span>]);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">onFinish</span> = <span class="keyword">async</span> (<span class="params">values: <span class="built_in">any</span></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; readerName,borrowedTime,returnTime &#125; = values;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">bookDTOArray</span>: <span class="variable constant_">API</span>.<span class="property">BookDTO</span>[] = [];</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">bookLogDTOArray</span>: <span class="variable constant_">API</span>.<span class="property">BookLogDTO</span>[] = [];</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 使用forEach()方法遍历formData数组，将每个元素转换为一个包含书籍信息的DTO对象（bookDTO），</span></span><br><span class="line"><span class="comment">     * 并将其添加到bookDTOArray数组中。</span></span><br><span class="line"><span class="comment">     * 还将每个元素的借阅日志信息转换为一个包含借阅日志的DTO对象（bookLogDTO），</span></span><br><span class="line"><span class="comment">     * 并将其添加到bookLogDTOArray数组中。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    formData.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">//将一个包含书籍信息的DTO对象添加到bookDTOArray数组</span></span><br><span class="line">      bookDTOArray.<span class="title function_">push</span>(&#123;</span><br><span class="line">        <span class="attr">id</span>: item.<span class="property">id</span>,</span><br><span class="line">        <span class="attr">name</span>: item.<span class="property">name</span>,</span><br><span class="line">        <span class="attr">isbn</span>: item.<span class="property">isbn</span>,</span><br><span class="line">        <span class="attr">author</span>: item.<span class="property">author</span>,</span><br><span class="line">        <span class="attr">publisher</span>: item.<span class="property">publisher</span>,</span><br><span class="line">        <span class="attr">price</span>: item.<span class="property">price</span>,</span><br><span class="line">        <span class="attr">category</span>: item.<span class="property">category</span>,</span><br><span class="line">        <span class="attr">boughtTime</span>: item.<span class="property">boughtTime</span>,</span><br><span class="line">        <span class="attr">publishedTime</span>: item.<span class="property">publishedTime</span>,</span><br><span class="line">        <span class="attr">status</span>: item.<span class="property">status</span>,</span><br><span class="line">        <span class="attr">classification</span>: item.<span class="property">classification</span></span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      bookLogDTOArray.<span class="title function_">push</span>(&#123;</span><br><span class="line">        readerName,</span><br><span class="line">        <span class="attr">bookId</span>: item.<span class="property">id</span>,</span><br><span class="line">        <span class="attr">bookName</span>: item.<span class="property">name</span>,</span><br><span class="line">        <span class="attr">bookIsbn</span>: item.<span class="property">isbn</span>,</span><br><span class="line">        <span class="attr">borrowedTime</span>:borrowedTime,</span><br><span class="line">        <span class="attr">returnTime</span>: returnTime||<span class="literal">null</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * bookDTOArray和bookLogDTOArray数组中的元素一一对应，</span></span><br><span class="line"><span class="comment">     * 可以通过它们的索引值将它们组合成一个新的DTO对象（bookAndLogDTO）并返回给后端。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">const</span> <span class="attr">data</span>: <span class="variable constant_">API</span>.<span class="property">BookAndLogDTO</span>[] = bookDTOArray.<span class="title function_">map</span>(<span class="function">(<span class="params">item, index</span>) =&gt;</span> (&#123;</span><br><span class="line">      <span class="attr">bookDTO</span>: item,</span><br><span class="line">      <span class="attr">bookLogDTO</span>: bookLogDTOArray[index]</span><br><span class="line">    &#125;));</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;data&quot;</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data)</span><br><span class="line">    <span class="comment">// 1111111111setFormData(props.detailData);</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (props.<span class="property">detailData</span>) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">lendBooks</span>(data);</span><br><span class="line">        <span class="comment">// setFormData([]);</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        message.<span class="title function_">error</span>(<span class="string">&#x27;借出失败&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    props.<span class="title function_">onClose</span>(<span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">ModalForm</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">width</span>=<span class="string">&#123;700&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">onFinish</span>=<span class="string">&#123;onFinish&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">formRef</span>=<span class="string">&#123;form&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">modalProps</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">destroyOnClose:</span> <span class="attr">true</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onCancel:</span> () =&gt;</span> props.onClose(false),</span></span><br><span class="line"><span class="language-xml">      &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      title=&#123;props.detailData ? &#x27;借出&#x27; : &#x27;借出&#x27;&#125;</span></span><br><span class="line"><span class="language-xml">      open=&#123;props.visible&#125;</span></span><br><span class="line"><span class="language-xml">    &gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ProForm.Group</span> &gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ProFormText</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&#123;</span>`<span class="attr">readerName</span>`&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">label</span>=<span class="string">&quot;借阅人&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">rules</span>=<span class="string">&#123;[</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &#123;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">required:</span> <span class="attr">true</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">message:</span> &#x27;<span class="attr">请输入借阅人姓名</span>！&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &#125;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          ]&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ProFormDatePicker</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&#123;</span>`<span class="attr">borrowedTime</span>`&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">label</span>=<span class="string">&quot;借出日期&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">initialValue</span>=<span class="string">&#123;moment()&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ProForm.Group</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ProTable</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">dataSource</span>=<span class="string">&#123;formData&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">columns</span>=<span class="string">&#123;[</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          &#123; <span class="attr">title:</span> &#x27;<span class="attr">书名</span>&#x27;, <span class="attr">dataIndex:</span> &#x27;<span class="attr">name</span>&#x27; &#125;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          &#123; <span class="attr">title:</span> &#x27;<span class="attr">出版社</span>&#x27;, <span class="attr">dataIndex:</span> &#x27;<span class="attr">publisher</span>&#x27; &#125;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          &#123; <span class="attr">title:</span> &#x27;<span class="attr">作者</span>&#x27;, <span class="attr">dataIndex:</span> &#x27;<span class="attr">author</span>&#x27; &#125;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          &#123; <span class="attr">title:</span> &#x27;<span class="attr">ISBN</span>&#x27;, <span class="attr">dataIndex:</span> &#x27;<span class="attr">isbn</span>&#x27; &#125;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        ]&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">options</span>=<span class="string">&#123;false&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">search</span>=<span class="string">&#123;false&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">cardBordered</span>=<span class="string">&#123;false&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ModalForm</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="后端-6"><a href="#后端-6" class="headerlink" title="后端"></a>后端</h5><p>修改lendBooks传入参数为一个数组，通过for循环遍历一次还书</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">lendBooks</span><span class="params">(BookAndLogDTO[] bookAndLogDTO)</span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;bookAndLogDTO.length;i++)&#123;</span><br><span class="line">        <span class="type">BookAndLogDTO</span> <span class="variable">bookLogDTO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BookAndLogDTO</span>();</span><br><span class="line">        BeanUtils.copyProperties(bookAndLogDTO[i], bookLogDTO);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//书籍状态不是“在架”，报错</span></span><br><span class="line">        Assert.isTrue(bookLogDTO.getBookDTO().getStatus().equals(<span class="string">&quot;在架&quot;</span>),<span class="string">&quot;书籍不在架&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建实体对象，用以保存到数据库</span></span><br><span class="line">        <span class="type">BookLog</span> <span class="variable">log</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BookLog</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将输入的字段全部复制到实体对象中</span></span><br><span class="line">        <span class="comment">//将两个DTO中的数据传递到log中，便于使用bookLogMapper中的insert函数</span></span><br><span class="line">        BeanUtils.copyProperties(BookLogUtils.convertToDTO(bookLogDTO),log);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 调用DAO方法保存到数据库表</span></span><br><span class="line">        bookLogMapper.insert(log);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//修改书籍状态为借出</span></span><br><span class="line">        bookLogDTO.getBookDTO().setStatus(<span class="string">&quot;借出&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 更新书籍状态</span></span><br><span class="line">        updateBook(bookLogDTO.getBookDTO());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="还书"><a href="#还书" class="headerlink" title="还书"></a>还书</h3><p>实现了一次还多本书</p>
<h4 id="前端-7"><a href="#前端-7" class="headerlink" title="前端"></a>前端</h4><p>主页面index</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义一个一次还多本书的的回调函数</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">returnBooks</span> = <span class="keyword">async</span> (<span class="params">bookLog: <span class="built_in">any</span></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; bookLog.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="title function_">returnBook</span>(bookLog[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">selectRow</span>([]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义一个还书的回调函数</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">handleReturn</span> = <span class="keyword">async</span> (<span class="params">bookLog: <span class="built_in">any</span></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (!selectedRowKeys?.<span class="property">length</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="title function_">openConfirm</span>(<span class="string">`您确定归还<span class="subst">$&#123;selectedRowKeys.length&#125;</span>本书吗`</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">returnBooks</span>(bookLog);</span><br><span class="line">        refAction.<span class="property">current</span>?.<span class="title function_">reload</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">Button</span></span><br><span class="line"><span class="keyword">type</span>=<span class="string">&quot;primary&quot;</span></span><br><span class="line">key=<span class="string">&quot;primary&quot;</span></span><br><span class="line">onClick=&#123;<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">handleReturn</span>(bookLog);</span><br><span class="line">&#125;&#125;</span><br><span class="line">disabled=&#123;!selectedRowKeys?.<span class="property">length</span>&#125;</span><br><span class="line">&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">LoginOutlined</span> /&gt;</span></span>  还书</span><br><span class="line">&lt;/<span class="title class_">Button</span>&gt;,</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">rowSelection=&#123;&#123;</span><br><span class="line">              <span class="attr">onChange</span>: <span class="function">(<span class="params">rowKeys, records</span>) =&gt;</span> &#123;</span><br><span class="line">                  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;records&quot;</span>);</span><br><span class="line">                  <span class="variable language_">console</span>.<span class="title function_">log</span>(records);</span><br><span class="line">                  <span class="title function_">setBookLog</span>(records);</span><br><span class="line">                  <span class="title function_">selectRow</span>(rowKeys <span class="keyword">as</span> <span class="built_in">number</span>[]);</span><br><span class="line">              &#125;,</span><br><span class="line">&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>InputDialog.tsx修改为如下</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ModalForm</span>, <span class="title class_">ProForm</span>, <span class="title class_">ProFormInstance</span>, <span class="title class_">ProFormSelect</span>, <span class="title class_">ProFormText</span>, <span class="title class_">ProFormDatePicker</span>, <span class="title class_">ProTable</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@ant-design/pro-components&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; message, <span class="title class_">Switch</span>, <span class="title class_">Tooltip</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useEffect, useRef, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; waitTime &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; lendBook, lendBooks &#125; <span class="keyword">from</span> <span class="string">&#x27;@/services/api/book&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> moment <span class="keyword">from</span> <span class="string">&#x27;dayjs&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">InputDialogProps</span> &#123;</span><br><span class="line">  detailData?: <span class="variable constant_">API</span>.<span class="property">BookDTO</span>[];</span><br><span class="line">  <span class="attr">visible</span>: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="attr">onClose</span>: <span class="function">(<span class="params">result: <span class="built_in">boolean</span></span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">InputDialog</span>(<span class="params">props: InputDialogProps</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> form = useRef&lt;<span class="title class_">ProFormInstance</span>&gt;(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> [<span class="keyword">readonly</span>, setReadonly] = <span class="title function_">useState</span>(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 222222222注意两dialog中有两种类型</span></span><br><span class="line">  <span class="comment">// 注意不同位置注释语法不同，不要被坑了</span></span><br><span class="line">  <span class="keyword">const</span> [formData, setFormData] = useState&lt;<span class="variable constant_">API</span>.<span class="property">BookDTO</span>[]&gt;([]);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;formData&quot;</span>)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(formData)</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">waitTime</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (props.<span class="property">detailData</span>) &#123;</span><br><span class="line">        form?.<span class="property">current</span>?.<span class="title function_">setFieldsValue</span>(props.<span class="property">detailData</span>);</span><br><span class="line">        <span class="title function_">setFormData</span>(props.<span class="property">detailData</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        form?.<span class="property">current</span>?.<span class="title function_">resetFields</span>();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;, [props.<span class="property">detailData</span>, props.<span class="property">visible</span>]);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">onFinish</span> = <span class="keyword">async</span> (<span class="params">values: <span class="built_in">any</span></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; readerName,borrowedTime,returnTime &#125; = values;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">bookDTOArray</span>: <span class="variable constant_">API</span>.<span class="property">BookDTO</span>[] = [];</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">bookLogDTOArray</span>: <span class="variable constant_">API</span>.<span class="property">BookLogDTO</span>[] = [];</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 使用forEach()方法遍历formData数组，将每个元素转换为一个包含书籍信息的DTO对象（bookDTO），</span></span><br><span class="line"><span class="comment">     * 并将其添加到bookDTOArray数组中。</span></span><br><span class="line"><span class="comment">     * 还将每个元素的借阅日志信息转换为一个包含借阅日志的DTO对象（bookLogDTO），</span></span><br><span class="line"><span class="comment">     * 并将其添加到bookLogDTOArray数组中。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    formData.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">//将一个包含书籍信息的DTO对象添加到bookDTOArray数组</span></span><br><span class="line">      bookDTOArray.<span class="title function_">push</span>(&#123;</span><br><span class="line">        <span class="attr">id</span>: item.<span class="property">id</span>,</span><br><span class="line">        <span class="attr">name</span>: item.<span class="property">name</span>,</span><br><span class="line">        <span class="attr">isbn</span>: item.<span class="property">isbn</span>,</span><br><span class="line">        <span class="attr">author</span>: item.<span class="property">author</span>,</span><br><span class="line">        <span class="attr">publisher</span>: item.<span class="property">publisher</span>,</span><br><span class="line">        <span class="attr">price</span>: item.<span class="property">price</span>,</span><br><span class="line">        <span class="attr">category</span>: item.<span class="property">category</span>,</span><br><span class="line">        <span class="attr">boughtTime</span>: item.<span class="property">boughtTime</span>,</span><br><span class="line">        <span class="attr">publishedTime</span>: item.<span class="property">publishedTime</span>,</span><br><span class="line">        <span class="attr">status</span>: item.<span class="property">status</span>,</span><br><span class="line">        <span class="attr">classification</span>: item.<span class="property">classification</span></span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      bookLogDTOArray.<span class="title function_">push</span>(&#123;</span><br><span class="line">        readerName,</span><br><span class="line">        <span class="attr">bookId</span>: item.<span class="property">id</span>,</span><br><span class="line">        <span class="attr">bookName</span>: item.<span class="property">name</span>,</span><br><span class="line">        <span class="attr">bookIsbn</span>: item.<span class="property">isbn</span>,</span><br><span class="line">        <span class="attr">borrowedTime</span>:borrowedTime,</span><br><span class="line">        <span class="attr">returnTime</span>: returnTime||<span class="literal">null</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * bookDTOArray和bookLogDTOArray数组中的元素一一对应，</span></span><br><span class="line"><span class="comment">     * 可以通过它们的索引值将它们组合成一个新的DTO对象（bookAndLogDTO）并返回给后端。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">const</span> <span class="attr">data</span>: <span class="variable constant_">API</span>.<span class="property">BookAndLogDTO</span>[] = bookDTOArray.<span class="title function_">map</span>(<span class="function">(<span class="params">item, index</span>) =&gt;</span> (&#123;</span><br><span class="line">      <span class="attr">bookDTO</span>: item,</span><br><span class="line">      <span class="attr">bookLogDTO</span>: bookLogDTOArray[index]</span><br><span class="line">    &#125;));</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;data&quot;</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data)</span><br><span class="line">    <span class="comment">// 1111111111setFormData(props.detailData);</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (props.<span class="property">detailData</span>) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">lendBooks</span>(data);</span><br><span class="line">        <span class="comment">// setFormData([]);</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        message.<span class="title function_">error</span>(<span class="string">&#x27;借出失败&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    props.<span class="title function_">onClose</span>(<span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">ModalForm</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">width</span>=<span class="string">&#123;700&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">onFinish</span>=<span class="string">&#123;onFinish&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">formRef</span>=<span class="string">&#123;form&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">modalProps</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">destroyOnClose:</span> <span class="attr">true</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onCancel:</span> () =&gt;</span> props.onClose(false),</span></span><br><span class="line"><span class="language-xml">      &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      title=&#123;props.detailData ? &#x27;借出&#x27; : &#x27;借出&#x27;&#125;</span></span><br><span class="line"><span class="language-xml">      open=&#123;props.visible&#125;</span></span><br><span class="line"><span class="language-xml">    &gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ProForm.Group</span> &gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ProFormText</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&#123;</span>`<span class="attr">readerName</span>`&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">label</span>=<span class="string">&quot;借阅人&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">rules</span>=<span class="string">&#123;[</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &#123;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">required:</span> <span class="attr">true</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">message:</span> &#x27;<span class="attr">请输入借阅人姓名</span>！&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &#125;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          ]&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ProFormDatePicker</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&#123;</span>`<span class="attr">borrowedTime</span>`&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">label</span>=<span class="string">&quot;借出日期&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">initialValue</span>=<span class="string">&#123;moment()&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ProForm.Group</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ProTable</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">dataSource</span>=<span class="string">&#123;formData&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">columns</span>=<span class="string">&#123;[</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          &#123; <span class="attr">title:</span> &#x27;<span class="attr">书名</span>&#x27;, <span class="attr">dataIndex:</span> &#x27;<span class="attr">name</span>&#x27; &#125;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          &#123; <span class="attr">title:</span> &#x27;<span class="attr">出版社</span>&#x27;, <span class="attr">dataIndex:</span> &#x27;<span class="attr">publisher</span>&#x27; &#125;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          &#123; <span class="attr">title:</span> &#x27;<span class="attr">作者</span>&#x27;, <span class="attr">dataIndex:</span> &#x27;<span class="attr">author</span>&#x27; &#125;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          &#123; <span class="attr">title:</span> &#x27;<span class="attr">ISBN</span>&#x27;, <span class="attr">dataIndex:</span> &#x27;<span class="attr">isbn</span>&#x27; &#125;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        ]&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">options</span>=<span class="string">&#123;false&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">search</span>=<span class="string">&#123;false&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">cardBordered</span>=<span class="string">&#123;false&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ModalForm</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h4 id="后端-7"><a href="#后端-7" class="headerlink" title="后端"></a>后端</h4><p>BookService.java添加</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">lendBook</span><span class="params">(BookAndLogDTO bookAndLogDTO)</span>;</span><br></pre></td></tr></table></figure>

<p>Impl.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">returnBook</span><span class="params">(BookDTO bookDTO)</span>&#123;</span><br><span class="line">    <span class="comment">//只有书籍状态不是“借出”，则报错</span></span><br><span class="line">    Assert.isTrue(bookDTO.getStatus().equals(<span class="string">&quot;借出&quot;</span>), <span class="string">&quot;书籍未借出&quot;</span>);</span><br><span class="line">    <span class="comment">//修改书籍状态为借出</span></span><br><span class="line">    bookDTO.setStatus(<span class="string">&quot;在架&quot;</span>);</span><br><span class="line">    <span class="comment">//更新书籍状态</span></span><br><span class="line">    updateBook(bookDTO);</span><br><span class="line">    <span class="comment">//补充对应借阅日志的还书日期</span></span><br><span class="line">    bookLogMapper.insertTime(bookDTO);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>BookController.java添加</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;returnBook&quot;)</span></span><br><span class="line"><span class="meta">@Privilege(&quot;return&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">returnBook</span><span class="params">(<span class="meta">@RequestBody</span> BookDTO bookDTO)</span> &#123;</span><br><span class="line">    bookService.returnBook(bookDTO);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>BookLogMapper.xml中添加对应语句，实现自动为匹配的最新的对应书籍添加还书日期</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 获取对应借出书籍的日志记录 --&gt;</span><br><span class="line">&lt;update id=&quot;insertTime&quot; parameterType=&quot;java.lang.Integer&quot;&gt;</span><br><span class="line">  update book_log</span><br><span class="line">  set return_time = now()</span><br><span class="line">  where book_id = #&#123;id,jdbcType=INTEGER&#125;</span><br><span class="line">  order by id desc</span><br><span class="line">  limit 1</span><br><span class="line">&lt;/update&gt;</span><br></pre></td></tr></table></figure>

<p>BookLogMapper.java中添加</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新部门数据</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bookDTO 部门输入对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 部门编码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">Integer <span class="title function_">insertTime</span><span class="params">(BookDTO bookDTO)</span>;</span><br></pre></td></tr></table></figure>





<h3 id="图表展示"><a href="#图表展示" class="headerlink" title="图表展示"></a>图表展示</h3><p>ts直接连接mysql表格</p>
<h2 id="5-问题"><a href="#5-问题" class="headerlink" title="5.问题"></a>5.问题</h2><h3 id="1-分页查询后端xml修改错误"><a href="#1-分页查询后端xml修改错误" class="headerlink" title="1.分页查询后端xml修改错误"></a>1.<del>分页查询后端xml修改错误</del></h3><p>照着课程视频跑分页查询的时候出现了如图报错，后端刚开始就会停止执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 获取名字 --&gt;</span><br><span class="line">    &lt;select id=&quot;getByName&quot; resultType=&quot;BaseResultMap&quot;&gt;</span><br><span class="line">        select  *</span><br><span class="line">        from department</span><br><span class="line">        where department_name = *&#123;name&#125;</span><br><span class="line">    &lt;/select&gt;</span><br></pre></td></tr></table></figure>

<p><img src="E:\Files\Projects\CXCollege\software\Image\8.png" alt="8"></p>
<h4 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h4><ul>
<li><h5 id="使用reultMap-时可以用-“BaseResultMap”"><a href="#使用reultMap-时可以用-“BaseResultMap”" class="headerlink" title="使用reultMap 时可以用 “BaseResultMap”"></a>使用reultMap 时可以用 “BaseResultMap”</h5></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reultMap =&quot;BaseResultMap&quot;</span><br></pre></td></tr></table></figure>

<ul>
<li><h5 id="或使用-resultType-要写类的全名（包含包名）"><a href="#或使用-resultType-要写类的全名（包含包名）" class="headerlink" title="或使用 resultType 要写类的全名（包含包名）"></a>或使用 resultType 要写类的全名（包含包名）</h5></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">resultType=&quot;redlib.backend.model.Book&quot;</span><br></pre></td></tr></table></figure>




<h3 id="2-时间格式不正确"><a href="#2-时间格式不正确" class="headerlink" title="2.时间格式不正确"></a>2.<del>时间格式不正确</del></h3><p>使用以下方法添加注解的时候，Swagger中会出现多条时间的json信息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@JsonFormat(pattern = &quot;yyyy-MM-dd&quot;)</span></span><br><span class="line"><span class="keyword">private</span> Date BookBoutime;</span><br></pre></td></tr></table></figure>

<img src="E:\Files\Projects\CXCollege\software\Image\4.png" alt="4" style="zoom:125%;" />

<p>此外，在前端生成DTO类时也发现会生成多条时间</p>
<img src="E:\Files\Projects\CXCollege\software\Image\7.png" alt="7"  />

<h4 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h4><p>后端DTO命名不规范</p>
<h4 id="解决方案-1"><a href="#解决方案-1" class="headerlink" title="解决方案"></a>解决方案</h4><p>将变量命名使用驼峰结构，与Book.java同步之后解决问题（以上所有代码适当微调）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> redlib.backend.dto;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonFormat;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.math.BigDecimal;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookDTO</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String isbn;</span><br><span class="line">    <span class="keyword">private</span> String author;</span><br><span class="line">    <span class="keyword">private</span> String publisher;</span><br><span class="line">    <span class="keyword">private</span> Double price;</span><br><span class="line">    <span class="keyword">private</span> String category;</span><br><span class="line">    <span class="meta">@JsonFormat(pattern = &quot;yyyy-MM-dd&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date boughtTime;</span><br><span class="line">    <span class="meta">@JsonFormat(pattern = &quot;yyyy-MM-dd&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date publishedTime;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="3-selectedRowKeys删除问题"><a href="#3-selectedRowKeys删除问题" class="headerlink" title="3.selectedRowKeys删除问题"></a>3.<del>selectedRowKeys删除问题</del></h3><p>测试前端时发现删除某一行时会选中所有图书</p>
<h4 id="原因-1"><a href="#原因-1" class="headerlink" title="原因"></a>原因</h4><p>由于在 InputDialog\index.tsx 中修改为</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">data</span>: <span class="variable constant_">API</span>.<span class="property">BookDTO</span> = &#123;</span><br><span class="line">    <span class="attr">bookId</span>: props.<span class="property">detailData</span>?.<span class="property">bookId</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="解决方案-2"><a href="#解决方案-2" class="headerlink" title="解决方案"></a>解决方案</h4><p>需要修改 rowKey 如下</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">actionRef=&#123;refAction&#125;</span><br><span class="line">rowKey=<span class="string">&quot;bookId&quot;</span></span><br></pre></td></tr></table></figure>



<h3 id="4-价格使用Decimal无法显示"><a href="#4-价格使用Decimal无法显示" class="headerlink" title="4.价格使用Decimal无法显示"></a>4.<del>价格使用Decimal无法显示</del></h3><p>书籍价格使用Decimal类型的时候，前端新增正常，但是对某一本书修改参数时，无法显示价格</p>
<h4 id="解决方案-3"><a href="#解决方案-3" class="headerlink" title="解决方案"></a>解决方案</h4><p>原因未知，有两种修改方法</p>
<p>1.MySQL，前后端同时修改为Integer，尝试设置小数位数为2，可以解决显示问题，但无法显示小数。</p>
<p>2.MySQL，前后端同时修改为Double，同时设置小数位数为2，测试发现可以解决显示问题，并解决价格无法显示小数问题。</p>
<h3 id="5-Mysql设置主键自增，删除数据后，主键id依然从删除位置增加"><a href="#5-Mysql设置主键自增，删除数据后，主键id依然从删除位置增加" class="headerlink" title="5.Mysql设置主键自增，删除数据后，主键id依然从删除位置增加"></a>5.<del>Mysql设置主键自增，删除数据后，主键id依然从删除位置增加</del></h3><h4 id="不是问题，无需解决"><a href="#不是问题，无需解决" class="headerlink" title="不是问题，无需解决"></a>不是问题，无需解决</h4><h3 id="6-前端无法实现查询书籍"><a href="#6-前端无法实现查询书籍" class="headerlink" title="6.前端无法实现查询书籍"></a>6.<del>前端无法实现查询书籍</del></h3><h4 id="原因-2"><a href="#原因-2" class="headerlink" title="原因"></a>原因</h4><p>修改MySQL表格时，xml文件忘记同步更改，修改后成功实现查询</p>
<h4 id="解决方案-4"><a href="#解决方案-4" class="headerlink" title="解决方案"></a>解决方案</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 获取名字个数(分页) --&gt;</span><br><span class="line"> &lt;select id=&quot;count&quot; resultType=&quot;integer&quot;&gt;</span><br><span class="line">   select count(*)</span><br><span class="line">   from book</span><br><span class="line">   &lt;where&gt;</span><br><span class="line">     &lt;if test=&quot;name != null&quot;&gt;</span><br><span class="line">       name like #&#123;name&#125;</span><br><span class="line">     &lt;/if&gt;</span><br><span class="line">   &lt;/where&gt;</span><br><span class="line"> &lt;/select&gt;</span><br><span class="line"></span><br><span class="line"> &lt;!-- 获取书籍(分页) --&gt;</span><br><span class="line"> &lt;select id=&quot;list&quot; resultMap=&quot;BaseResultMap&quot;&gt;</span><br><span class="line">   select</span><br><span class="line">   &lt;include refid=&quot;Base_Column_List&quot;/&gt;</span><br><span class="line">   from book</span><br><span class="line">   &lt;where&gt;</span><br><span class="line">     &lt;if test=&quot;queryDTO.name != null&quot;&gt;</span><br><span class="line">       name like #&#123;queryDTO.name&#125;</span><br><span class="line">     &lt;/if&gt;</span><br><span class="line">   &lt;/where&gt;</span><br><span class="line">   limit #&#123;offset&#125;, #&#123;limit&#125;</span><br><span class="line"> &lt;/select&gt;</span><br></pre></td></tr></table></figure>



<h3 id="7-BookLog中list方法执行时报错"><a href="#7-BookLog中list方法执行时报错" class="headerlink" title="7.BookLog中list方法执行时报错"></a>7.<del>BookLog中list方法执行时报错</del></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">There is no getter <span class="keyword">for</span> property named <span class="string">&#x27;book_id&#x27;</span> in <span class="string">&#x27;class redlib.backend.dto.query.BookLogQueryDTO</span></span><br></pre></td></tr></table></figure>

<h4 id="原因-3"><a href="#原因-3" class="headerlink" title="原因"></a>原因</h4><p>MySQL中分页查询参数设置错误</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 获取名字个数(分页) --&gt;</span><br><span class="line">&lt;select id=&quot;count&quot; resultType=&quot;integer&quot;&gt;</span><br><span class="line">  select count(*)</span><br><span class="line">  from book_log</span><br><span class="line">  &lt;where&gt;</span><br><span class="line">    &lt;if test=&quot;id != null&quot;&gt;</span><br><span class="line">      id like #&#123;id&#125;</span><br><span class="line">    &lt;/if&gt;</span><br><span class="line">  &lt;/where&gt;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>

<h4 id="解决方案-5"><a href="#解决方案-5" class="headerlink" title="解决方案"></a>解决方案</h4><p>修改为book_log列表中的id改为bookName字段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 获取名字个数(分页) --&gt;</span><br><span class="line">&lt;select id=&quot;count&quot; resultType=&quot;integer&quot;&gt;</span><br><span class="line">  select count(*)</span><br><span class="line">  from book_log</span><br><span class="line">  &lt;where&gt;</span><br><span class="line">    &lt;if test=&quot;bookName != null&quot;&gt;</span><br><span class="line">      book_name like #&#123;bookName&#125;</span><br><span class="line">    &lt;/if&gt;</span><br><span class="line">  &lt;/where&gt;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>



<h3 id="8-swagger中测试删除booklog时报错"><a href="#8-swagger中测试删除booklog时报错" class="headerlink" title="8.swagger中测试删除booklog时报错"></a>8.<del>swagger中测试删除booklog时报错</del></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Invalid bound <span class="title function_">statement</span> <span class="params">(not found)</span>: redlib.backend.dao.BookLogMapper.deleteByCodes</span><br></pre></td></tr></table></figure>

<h4 id="原因-4"><a href="#原因-4" class="headerlink" title="原因"></a>原因</h4><p>xml文件中忘记添加MySQL语句</p>
<h4 id="解决方案-6"><a href="#解决方案-6" class="headerlink" title="解决方案"></a>解决方案</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 批量删除 --&gt;</span><br><span class="line">&lt;update id=&quot;deleteByCodes&quot;&gt;</span><br><span class="line">  delete from book</span><br><span class="line">  where id in</span><br><span class="line">  &lt;foreach item=&quot;item&quot; index=&quot;index&quot; collection=&quot;codeList&quot; open=&quot;(&quot; separator=&quot;,&quot; close=&quot;)&quot;&gt;</span><br><span class="line">    #&#123;item&#125;</span><br><span class="line">  &lt;/foreach&gt;</span><br><span class="line">&lt;/update&gt;</span><br></pre></td></tr></table></figure>

<h4 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h4><p>此函数在日志记录中不太需要，后续考虑删除</p>
<h3 id="9-分页查询，多种条件同时查找时没找到对象会报错"><a href="#9-分页查询，多种条件同时查找时没找到对象会报错" class="headerlink" title="9.分页查询，多种条件同时查找时没找到对象会报错"></a>9.<del>分页查询，多种条件同时查找时没找到对象会报错</del></h3><h4 id="原因-5"><a href="#原因-5" class="headerlink" title="原因"></a>原因</h4><p>sql语句中，当两个if 都不等于null的时候，两个sql语句由于没有东西连接起来，会产生报错</p>
<h4 id="解决方案-7"><a href="#解决方案-7" class="headerlink" title="解决方案"></a>解决方案</h4><p>在每个检索的 sql 语句前添加使用 and 连接</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=&quot;list&quot; resultMap=&quot;BaseResultMap&quot;&gt;</span><br><span class="line">  select</span><br><span class="line">  &lt;include refid=&quot;Base_Column_List&quot;/&gt;</span><br><span class="line">  from book_log</span><br><span class="line">  &lt;where&gt;</span><br><span class="line">    &lt;if test=&quot;queryDTO.readerName != null&quot;&gt;</span><br><span class="line">      and reader_name like #&#123;queryDTO.readerName&#125;</span><br><span class="line">    &lt;/if&gt;</span><br><span class="line">    &lt;if test=&quot;queryDTO.bookIsbn != null&quot;&gt;</span><br><span class="line">      and book_isbn like #&#123;queryDTO.bookIsbn&#125;</span><br><span class="line">    &lt;/if&gt;</span><br><span class="line">    &lt;if test=&quot;queryDTO.bookId != null&quot;&gt;</span><br><span class="line">      and book_id like #&#123;queryDTO.bookId&#125;</span><br><span class="line">    &lt;/if&gt;</span><br><span class="line">    &lt;if test=&quot;queryDTO.bookName != null&quot;&gt;</span><br><span class="line">      and book_name like #&#123;queryDTO.bookName&#125;</span><br><span class="line">    &lt;/if&gt;</span><br><span class="line">  &lt;/where&gt;</span><br><span class="line">  &lt;if test=&quot;queryDTO.orderBy != null&quot;&gt;</span><br><span class="line">    order by $&#123;queryDTO.orderBy&#125;</span><br><span class="line">  &lt;/if&gt;</span><br><span class="line">  &lt;if test=&quot;queryDTO.orderBy == null&quot;&gt;</span><br><span class="line">    order by id desc</span><br><span class="line">  &lt;/if&gt;</span><br><span class="line">  limit #&#123;offset&#125;, #&#123;limit&#125;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>



<h3 id="10-书籍点借阅之后确定，发现两个表格中都会有字段丢失"><a href="#10-书籍点借阅之后确定，发现两个表格中都会有字段丢失" class="headerlink" title="10.书籍点借阅之后确定，发现两个表格中都会有字段丢失"></a>10.<del>书籍点借阅之后确定，发现两个表格中都会有字段丢失</del></h3><h4 id="原因-6"><a href="#原因-6" class="headerlink" title="原因"></a>原因</h4><p>前端代码底层为将选中行中的数据传递给对话框，然后对话框再传递给后端进行更新</p>
<h4 id="解决方案-8"><a href="#解决方案-8" class="headerlink" title="解决方案"></a>解决方案</h4><p>主页面向对话框中传递数据时传递全部数据，后端使用hidden属性，隐藏不需要的表格，即可实现传递数据又不显示</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">ProFormText</span></span><br><span class="line">name=<span class="string">&quot;classification&quot;</span></span><br><span class="line">label=<span class="string">&quot;classification&quot;</span></span><br><span class="line">hidden</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>



<h3 id="11-借书时无法向对话框传递参数"><a href="#11-借书时无法向对话框传递参数" class="headerlink" title="11.借书时无法向对话框传递参数"></a>11.<del>借书时无法向对话框传递参数</del></h3><h4 id="原因-7"><a href="#原因-7" class="headerlink" title="原因"></a>原因</h4><p>一开始将typescripts列表的起始下标与MySQL记混，以为也是从1开始，代码如下</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setBookLog</span>(records[<span class="number">1</span>]);</span><br></pre></td></tr></table></figure>

<h4 id="解决方案-9"><a href="#解决方案-9" class="headerlink" title="解决方案"></a>解决方案</h4><p>typescripts列表的起始下标从0开始，修改records下标为0（首个元素）</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setBookLog</span>(records[<span class="number">0</span>]);</span><br></pre></td></tr></table></figure>



<h3 id="12-多余接口删除（暂未解决，后需考虑）"><a href="#12-多余接口删除（暂未解决，后需考虑）" class="headerlink" title="12.多余接口删除（暂未解决，后需考虑）"></a>12.<del>多余接口删除（暂未解决，后需考虑）</del></h3><p>由于BookLog后端框架为Book复制修改，许多没必要存在的接口后续考虑删除（此处就暂时未写接口文档）</p>
<h3 id="13-lendBook函数报错"><a href="#13-lendBook函数报错" class="headerlink" title="13.lendBook函数报错"></a>13.<del>lendBook函数报错</del></h3><p>报错如下</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.validation.BeanPropertyBindingResult<span class="punctuation">:</span> <span class="number">2</span> errors Field error in object &#x27;bookDTO&#x27; on field &#x27;boughtTime&#x27;<span class="punctuation">:</span> rejected value <span class="punctuation">[</span><span class="number">2023</span><span class="number">-04</span><span class="number">-01</span><span class="punctuation">]</span>; codes <span class="punctuation">[</span>typeMismatch.bookDTO.boughtTime<span class="punctuation">,</span>typeMismatch.boughtTime<span class="punctuation">,</span>typeMismatch.java.util.Date<span class="punctuation">,</span>typeMismatch<span class="punctuation">]</span>; arguments <span class="punctuation">[</span>org.springframework.context.support.DefaultMessageSourceResolvable<span class="punctuation">:</span> codes <span class="punctuation">[</span>bookDTO.boughtTime<span class="punctuation">,</span>boughtTime<span class="punctuation">]</span>; arguments <span class="punctuation">[</span><span class="punctuation">]</span>; default message <span class="punctuation">[</span>boughtTime<span class="punctuation">]</span><span class="punctuation">]</span>; default message <span class="punctuation">[</span>Failed to convert property value of type &#x27;java.lang.String&#x27; to required type &#x27;java.util.Date&#x27; for property &#x27;boughtTime&#x27;; Failed to convert from type <span class="punctuation">[</span>java.lang.String<span class="punctuation">]</span> to type <span class="punctuation">[</span>@com.fasterxml.jackson.annotation.JsonFormat java.util.Date<span class="punctuation">]</span> for value &#x27;<span class="number">2023</span><span class="number">-04</span><span class="number">-01</span>&#x27;<span class="punctuation">]</span> Field error in object &#x27;bookDTO&#x27; on field &#x27;publishedTime&#x27;<span class="punctuation">:</span> rejected value <span class="punctuation">[</span><span class="number">2023</span><span class="number">-04</span><span class="number">-01</span><span class="punctuation">]</span>; codes <span class="punctuation">[</span>typeMismatch.bookDTO.publishedTime<span class="punctuation">,</span>typeMismatch.publishedTime<span class="punctuation">,</span>typeMismatch.java.util.Date<span class="punctuation">,</span>typeMismatch<span class="punctuation">]</span>; arguments <span class="punctuation">[</span>org.springframework.context.support.DefaultMessageSourceResolvable<span class="punctuation">:</span> codes <span class="punctuation">[</span>bookDTO.publishedTime<span class="punctuation">,</span>publishedTime<span class="punctuation">]</span>; arguments <span class="punctuation">[</span><span class="punctuation">]</span>; default message <span class="punctuation">[</span>publishedTime<span class="punctuation">]</span><span class="punctuation">]</span>; default message <span class="punctuation">[</span>Failed to convert property value of type &#x27;java.lang.String&#x27; to required type &#x27;java.util.Date&#x27; for property &#x27;publishedTime&#x27;; Failed to convert from type <span class="punctuation">[</span>java.lang.String<span class="punctuation">]</span> to type <span class="punctuation">[</span>@com.fasterxml.jackson.annotation.JsonFormat java.util.Date<span class="punctuation">]</span> for value &#x27;<span class="number">2023</span><span class="number">-04</span><span class="number">-01</span>&#x27;<span class="punctuation">]</span></span><br></pre></td></tr></table></figure>

<h4 id="原因-8"><a href="#原因-8" class="headerlink" title="原因"></a>原因</h4><p>controller对应函数中忘记添加注解@RequestBody </p>
<h4 id="解决方案-10"><a href="#解决方案-10" class="headerlink" title="解决方案"></a>解决方案</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">returnBook</span><span class="params">(<span class="meta">@RequestBody</span> BookDTO bookDTO)</span> &#123;</span><br><span class="line">    bookService.returnBook(bookDTO);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="14-借出、归还Assert仍然不符合逻辑"><a href="#14-借出、归还Assert仍然不符合逻辑" class="headerlink" title="14.借出、归还Assert仍然不符合逻辑"></a>14.<del>借出、归还Assert仍然不符合逻辑</del></h3><p>借出的书本，仍然可以借出。在在架的书本，仍然可以归还。</p>
<blockquote>
<p>点还书按钮的时候，前端把书籍信息传递给后端，后端接收后首先用Assert判断书籍状态是否符合逻辑，然后修改为书籍状态为“在架”。但是我尝试发现不管怎么修改Assert语法（尝试过&#x3D;&#x3D;和！&#x3D;等），但发现都达不到想要的效果</p>
</blockquote>
<h4 id="原因-9"><a href="#原因-9" class="headerlink" title="原因"></a>原因</h4><p>java比较字符串相等，不能用&#x3D;&#x3D;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Assert.isTrue(bookDTO.getStatus()!=<span class="string">&quot;借出&quot;</span>, <span class="string">&quot;书籍在架！&quot;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="解决方案-11"><a href="#解决方案-11" class="headerlink" title="解决方案"></a>解决方案</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//只有书籍状态不是“借出”，则报错</span></span><br><span class="line"><span class="comment">//即，前表达式不成立时报错</span></span><br><span class="line">Assert.isTrue(bookDTO.getStatus().equals(<span class="string">&quot;借出&quot;</span>), <span class="string">&quot;书籍在架&quot;</span>);</span><br></pre></td></tr></table></figure>



<h3 id="15-借出成功后没有提示"><a href="#15-借出成功后没有提示" class="headerlink" title="15.借出成功后没有提示"></a>15.<del>借出成功后没有提示</del></h3><h4 id="原因-10"><a href="#原因-10" class="headerlink" title="原因"></a>原因</h4><p>由于后端返回值为void，await lendBooks(data)的返回值可能一直为undefined，导致无法判断</p>
<p>可能原因</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">根据提供的代码，似乎 try-catch 块只捕获在 await lendBooks(data) 调用期间发生的错误。任何在后端代码中发生的错误，例如 Assert 错误，都不会被这个 try-catch 块捕获。</span><br><span class="line"></span><br><span class="line">如果后端代码发生错误导致请求失败，那么 await lendBooks(data) 调用可能会拒绝并抛出一个错误，导致 catch 块执行并显示 &#x27;借出失败&#x27; 消息。但是，如果后端代码返回成功的响应，但是包含一个错误消息表示操作失败，那么 await lendBooks(data) 调用仍可能成功解析，并显示 &#x27;借出成功&#x27; 消息。</span><br><span class="line"></span><br><span class="line">为确保后端代码中的错误得到正确处理，重要的是在后端代码中也包括错误处理，并确保它返回适当的响应以指示成功或失败。此外，前端代码应更新以正确处理这些响应，并向用户显示适当的消息。</span><br></pre></td></tr></table></figure>

<p>后端使用assert即使success为false前端也会显示正确，即无论如何都会执行到，都会弹出此框</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">lendBooks</span>(data);</span><br><span class="line">    message.<span class="title function_">success</span>(<span class="string">&#x27;借出成功&#x27;</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    message.<span class="title function_">error</span>(<span class="string">&#x27;借出失败&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="解决方案-12"><a href="#解决方案-12" class="headerlink" title="解决方案"></a>解决方案</h4><h5 id="1-第一种解决方案（实际采用此种方案实现显示的效果，但不规范）"><a href="#1-第一种解决方案（实际采用此种方案实现显示的效果，但不规范）" class="headerlink" title="1.第一种解决方案（实际采用此种方案实现显示的效果，但不规范）"></a>1.第一种解决方案（实际采用此种方案实现显示的效果，但不规范）</h5><p>前端通过遍历借还多本书，并且判断书籍状态（即通过前端模拟后端Assert功能）</p>
<p>借书</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (props.<span class="property">detailData</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; data.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(data[i].<span class="property">bookDTO</span>?.<span class="property">status</span>===<span class="string">&quot;在架&quot;</span>)&#123;</span><br><span class="line">            <span class="keyword">await</span> <span class="title function_">lendBooks</span>(data[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            sum = sum+<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(sum!==<span class="number">0</span>)&#123;</span><br><span class="line">        message.<span class="title function_">error</span>(<span class="string">`共<span class="subst">$&#123;sum&#125;</span>本书借出失败`</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        message.<span class="title function_">success</span>(<span class="string">`借出成功`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>还书</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义一个一次还多本书的的回调函数</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">returnBooks</span> = <span class="keyword">async</span> (<span class="params">bookLog: <span class="built_in">any</span></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> sum = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; bookLog.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span>(bookLog[i].<span class="property">status</span> ===<span class="string">&quot;借出&quot;</span>)&#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="title function_">returnBook</span>(bookLog[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">      sum = sum+<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(sum!==<span class="number">0</span>)&#123;</span><br><span class="line">    message.<span class="title function_">error</span>(<span class="string">`共<span class="subst">$&#123;sum&#125;</span>本书归还失败,<span class="subst">$&#123;bookLog.length-sum&#125;</span>本书归还成功`</span>);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    message.<span class="title function_">success</span>(<span class="string">`归还成功`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">selectRow</span>([]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义一个还书的回调函数</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">handleReturn</span> = <span class="keyword">async</span> (<span class="params">bookLog: <span class="built_in">any</span></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (!selectedRowKeys?.<span class="property">length</span>) <span class="keyword">return</span>;</span><br><span class="line">  <span class="title function_">openConfirm</span>(<span class="string">`您确定归还<span class="subst">$&#123;selectedRowKeys.length&#125;</span>本书吗`</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">returnBooks</span>(bookLog);</span><br><span class="line">    refAction.<span class="property">current</span>?.<span class="title function_">reload</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="2-第二种解决方案（更加推荐，规范，但不知道怎么实现显示效果）"><a href="#2-第二种解决方案（更加推荐，规范，但不知道怎么实现显示效果）" class="headerlink" title="2.第二种解决方案（更加推荐，规范，但不知道怎么实现显示效果）"></a>2.第二种解决方案（更加推荐，规范，但不知道怎么实现显示效果）</h4><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(props.<span class="property">detailsData</span>)&#123;</span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">updateDepartment</span>(date,&#123;<span class="attr">throwError</span>:<span class="literal">true</span>&#125;)</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        pass</span><br><span class="line">    &#125;<span class="keyword">catch</span>(ex)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;<span class="comment">//表示报错不执行任何操作</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//以下为不报错时顺序执行的代码</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="16-对话框传递参数不同步的问题"><a href="#16-对话框传递参数不同步的问题" class="headerlink" title="16.对话框传递参数不同步的问题"></a>16.<del>对话框传递参数不同步的问题</del></h3><p>借出，还书的对话框显示状态与主页面相对有延时，两者不同步，如何修改？</p>
<p>即选中一栏之后，首次借出正常，若不取消勾选，第一次成功之后仍然可以成功借书（状态并未更新到借书状态框中），只有取消勾选，再次勾选，才能够在借书对话框中刷新状态。</p>
<h4 id="原因-11"><a href="#原因-11" class="headerlink" title="原因"></a>原因</h4><p>初步判断为rowselect中的列表参数首个元素添加参数未改变的问题</p>
<p><img src="E:\Files\Projects\CXCollege\software\Image\27.png" alt="27"></p>
<p>测试发现，书籍状态在选择行时向对话框传递过一次，但是在借出完书之后，选择行并未改变，并未重新写入，此时records中保存的仍然是修改之前的消息</p>
<h4 id="解决方案-13"><a href="#解决方案-13" class="headerlink" title="解决方案"></a>解决方案</h4><p>通过在借书、还书成功之后添加，取消勾选</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">selectRow</span>([]);</span><br></pre></td></tr></table></figure>



<h3 id="17-还多本书时，log页面显示参数缺失"><a href="#17-还多本书时，log页面显示参数缺失" class="headerlink" title="17.还多本书时，log页面显示参数缺失"></a>17.<del>还多本书时，log页面显示参数缺失</del></h3><h4 id="原因-12"><a href="#原因-12" class="headerlink" title="原因"></a>原因</h4><p>一开始以为是后端copy数据出现问题，通过F12查看发现是前端向后端传递的数据缺失</p>
<h4 id="解决方案-14"><a href="#解决方案-14" class="headerlink" title="解决方案"></a>解决方案</h4><p>values中添加borrowedTime，returnTime变量，bookDTOArray中添加id: item.id，修改bookLogDTOArray中的最后两行为  </p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">borrowedTime</span>:borrowedTime,</span><br><span class="line"><span class="attr">returnTime</span>: returnTime||<span class="literal">null</span></span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; readerName,borrowedTime,returnTime &#125; = values;</span><br><span class="line"></span><br><span class="line">formData.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//将一个包含书籍信息的DTO对象添加到bookDTOArray数组</span></span><br><span class="line">    bookDTOArray.<span class="title function_">push</span>(&#123;</span><br><span class="line">        <span class="attr">id</span>: item.<span class="property">id</span>,</span><br><span class="line">        <span class="attr">name</span>: item.<span class="property">name</span>,</span><br><span class="line">        <span class="attr">isbn</span>: item.<span class="property">isbn</span>,</span><br><span class="line">        <span class="attr">author</span>: item.<span class="property">author</span>,</span><br><span class="line">        <span class="attr">publisher</span>: item.<span class="property">publisher</span>,</span><br><span class="line">        <span class="attr">price</span>: item.<span class="property">price</span>,</span><br><span class="line">        <span class="attr">category</span>: item.<span class="property">category</span>,</span><br><span class="line">        <span class="attr">boughtTime</span>: item.<span class="property">boughtTime</span>,</span><br><span class="line">        <span class="attr">publishedTime</span>: item.<span class="property">publishedTime</span>,</span><br><span class="line">        <span class="attr">status</span>: item.<span class="property">status</span>,</span><br><span class="line">        <span class="attr">classification</span>: item.<span class="property">classification</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    bookLogDTOArray.<span class="title function_">push</span>(&#123;</span><br><span class="line">        readerName,</span><br><span class="line">        <span class="attr">bookId</span>: item.<span class="property">id</span>,</span><br><span class="line">        <span class="attr">bookName</span>: item.<span class="property">name</span>,</span><br><span class="line">        <span class="attr">bookIsbn</span>: item.<span class="property">isbn</span>,</span><br><span class="line">        <span class="attr">borrowedTime</span>:borrowedTime,</span><br><span class="line">        <span class="attr">returnTime</span>: returnTime||<span class="literal">null</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<h3 id="18-无法将主页面向对话框传递的数据暂存给formData"><a href="#18-无法将主页面向对话框传递的数据暂存给formData" class="headerlink" title="18.无法将主页面向对话框传递的数据暂存给formData"></a>18.<del>无法将主页面向对话框传递的数据暂存给formData</del></h3><h4 id="原因-13"><a href="#原因-13" class="headerlink" title="原因"></a>原因</h4><p>setFormData函数调用位置错误</p>
<p>之前在data下方调用此函数，网页控制台查看发现其一直为空</p>
<h4 id="解决方案-15"><a href="#解决方案-15" class="headerlink" title="解决方案"></a>解决方案</h4><p>在钩子函数中调用setFormData(props.detailData);</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">waitTime</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (props.<span class="property">detailData</span>) &#123;</span><br><span class="line">            form?.<span class="property">current</span>?.<span class="title function_">setFieldsValue</span>(props.<span class="property">detailData</span>);</span><br><span class="line">            <span class="title function_">setFormData</span>(props.<span class="property">detailData</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            form?.<span class="property">current</span>?.<span class="title function_">resetFields</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;, [props.<span class="property">detailData</span>, props.<span class="property">visible</span>]);</span><br></pre></td></tr></table></figure>





<h3 id="19-图像显示不正常"><a href="#19-图像显示不正常" class="headerlink" title="19.图像显示不正常"></a>19.<del>图像显示不正常</del></h3><p>bug21修改成功后此处也解决</p>
<h3 id="20-Navicat与后端执行MySQL语句结果不一致"><a href="#20-Navicat与后端执行MySQL语句结果不一致" class="headerlink" title="20.Navicat与后端执行MySQL语句结果不一致"></a>20.<del>Navicat与后端执行MySQL语句结果不一致</del></h3><h4 id="原因-14"><a href="#原因-14" class="headerlink" title="原因"></a>原因</h4><p>1.resultMap与resultType用错</p>
<p>2.语句放错xml文件导致BaseResultMap不同无法对应</p>
<h3 id="解决方案-16"><a href="#解决方案-16" class="headerlink" title="解决方案"></a>解决方案</h3><p>1.修改resultMap为BaseResultMap</p>
<p>BaseResultMap将取得的数据库字段与VO类做映射</p>
<p>2.将mysql语句从移动到借还记录的xml文件中</p>
<h3 id="21-时间乱序"><a href="#21-时间乱序" class="headerlink" title="21.时间乱序"></a>21.<del>时间乱序</del></h3><h4 id="原因-15"><a href="#原因-15" class="headerlink" title="原因"></a>原因</h4><p>MySQL表格中测试数据忘记删除，使用数组的contact函数导致乱序</p>
<p>其余可能原因</p>
<blockquote>
<p>归还时间为null的问题<br>contact的问题（可能性不大）</p>
</blockquote>
<h4 id="解决方案-17"><a href="#解决方案-17" class="headerlink" title="解决方案"></a>解决方案</h4><p>删除多余测试数据</p>
<h3 id="22-ts中的引号"><a href="#22-ts中的引号" class="headerlink" title="22.ts中的引号"></a>22.<del>ts中的引号</del></h3><p>以下为正确用法</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">message.<span class="title function_">error</span>(<span class="string">`共<span class="subst">$&#123;sum&#125;</span>本书借出失败`</span>);</span><br></pre></td></tr></table></figure>

<p>以下为错误用法</p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">message.<span class="title function_">error</span>(<span class="string">&#x27;共$&#123;sum&#125;本书借出失败&#x27;</span>);</span><br></pre></td></tr></table></figure>





<h3 id="23-setXXX异步更新问题"><a href="#23-setXXX异步更新问题" class="headerlink" title="23. setXXX异步更新问题"></a>23. <del>setXXX异步更新问题</del></h3><blockquote>
<p>它会将新的状态值加入到一个队列中，并在稍后的时间点异步地批量更新组件的状态。这意味着，调用 setXXX 并不会立即更新组件的状态值，而是等待 React 系统在适当的时机进行批量&gt;更新。</p>
</blockquote>
<h4 id="解决方案-18"><a href="#解决方案-18" class="headerlink" title="解决方案"></a>解决方案</h4><p>使用useEffect钩子函数，在检测到变量被，更新后再设置innerHTML</p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">fetchJinrishici</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> jinrishici = <span class="built_in">require</span>(<span class="string">&#x27;jinrishici&#x27;</span>);</span><br><span class="line">    <span class="keyword">await</span> jinrishici.<span class="title function_">load</span>(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;诗词内容&quot;</span>);</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(result.<span class="property">data</span>.<span class="property">content</span>);</span><br><span class="line">      <span class="title function_">setPoem</span>(result.<span class="property">data</span>.<span class="property">content</span>);</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;使用setPoem之后,poem变量&quot;</span>);</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(poem);</span><br><span class="line">      <span class="title function_">setInfo</span>(<span class="string">&quot;——&quot;</span> + result.<span class="property">data</span>.<span class="property">origin</span>.<span class="property">author</span> + <span class="string">&quot;《&quot;</span> + result.<span class="property">data</span>.<span class="property">origin</span>.<span class="property">title</span> + <span class="string">&quot;》&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">fetchJinrishici</span>();</span><br><span class="line">&#125;, []);</span><br><span class="line"></span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;poem&quot;</span>)) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;1123&quot;</span>)</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;poem&quot;</span>).<span class="property">innerHTML</span> = poem;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;info&quot;</span>)) &#123;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;info&quot;</span>).<span class="property">innerHTML</span> = info;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;, [poem, info]);</span><br></pre></td></tr></table></figure>




<h3 id="24-注释问题"><a href="#24-注释问题" class="headerlink" title="24.注释问题"></a>24.<del>注释问题</del></h3><p>typescripts不同位置注释格式不同的问题，使用ctrl+？能更方便的注释，避免错误</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://example.com">Bsgbsg7</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2023/05/07/open-innovation(1)/">http://example.com/2023/05/07/open-innovation(1)/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">Bsgbsg7's World</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="/img/head.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/pay.png" target="_blank"><img class="post-qr-code-img" src="/img/pay.png" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li></ul></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/head.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Bsgbsg7</div><div class="author-info__description">找到那个重要的人了吗？</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">16</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/bsgbsg7"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/bsgbsg7" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:Bsgbsg7@Outlook.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="tencent://message/?uin=2028163967" target="_blank" title="QQ"><i class="fab fa-qq"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content"></div><div id="welcome-info"></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E9%80%89%E9%A2%98%E4%B8%8E%E8%A6%81%E6%B1%82"><span class="toc-number">1.</span> <span class="toc-text">1.选题与要求</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%AA%E4%BA%BA%E5%9B%BE%E4%B9%A6%E9%A6%86"><span class="toc-number">1.1.</span> <span class="toc-text">个人图书馆</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%80%83%E6%A0%B8%E5%86%85%E5%AE%B9"><span class="toc-number">1.2.</span> <span class="toc-text">考核内容</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%90%8E%E7%AB%AF%E5%AD%A6%E4%B9%A0"><span class="toc-number">2.</span> <span class="toc-text">2.后端学习</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%AD%A5%E9%AA%A4"><span class="toc-number">2.1.</span> <span class="toc-text">基本步骤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc-number">2.2.</span> <span class="toc-text">分页查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%81%BF%E5%85%8D%E9%87%8D%E5%A4%8D%E5%88%9B%E5%BB%BA%E9%83%A8%E9%97%A8"><span class="toc-number">2.3.</span> <span class="toc-text">避免重复创建部门</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#dao%E4%B8%AD%E5%88%9B%E5%BB%BAMapper%E7%B1%BB"><span class="toc-number">2.3.1.</span> <span class="toc-text">dao中创建Mapper类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#xml%E4%B8%AD%E6%B7%BB%E5%8A%A0"><span class="toc-number">2.3.2.</span> <span class="toc-text">xml中添加</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Impl%E4%B8%AD%E6%B7%BB%E5%8A%A0Assert"><span class="toc-number">2.3.3.</span> <span class="toc-text">Impl中添加Assert</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%89%8D%E7%AB%AF%E5%AD%A6%E4%B9%A0"><span class="toc-number">3.</span> <span class="toc-text">3.前端学习</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86"><span class="toc-number">3.1.</span> <span class="toc-text">基本知识</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%AD%E5%A4%B4%E5%87%BD%E6%95%B0"><span class="toc-number">3.1.1.</span> <span class="toc-text">箭头函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89%E4%B8%80%E4%B8%AA%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0"><span class="toc-number">3.1.2.</span> <span class="toc-text">定义一个回调函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A3%B0%E6%98%8E%E5%8F%98%E9%87%8F%E4%B8%8E%E6%96%B9%E6%B3%95"><span class="toc-number">3.1.3.</span> <span class="toc-text">声明变量与方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A5%E5%BC%82%E6%AD%A5%E9%9D%9E%E9%98%BB%E5%A1%9E%E6%96%B9%E5%BC%8F%E8%BF%90%E8%A1%8C"><span class="toc-number">3.1.4.</span> <span class="toc-text">以异步非阻塞方式运行</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9B%9E%E8%B0%83%E5%BC%8F"><span class="toc-number">3.1.5.</span> <span class="toc-text">回调式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%82%E6%AD%A5%E5%87%BD%E6%95%B0%E7%9A%84%E6%89%A7%E8%A1%8C%E6%96%B9%E5%BC%8F"><span class="toc-number">3.1.6.</span> <span class="toc-text">异步函数的执行方式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E9%A1%B5%E5%B1%95%E7%A4%BA%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%9C%E9%9B%86%E7%9A%84antd-pro"><span class="toc-number">3.1.7.</span> <span class="toc-text">分页展示数据结果集的antd pro</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%B7%E6%96%B0%E6%93%8D%E4%BD%9C"><span class="toc-number">3.1.8.</span> <span class="toc-text">刷新操作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ProTable%E5%AD%98%E5%82%A8%E6%95%B0%E6%8D%AE"><span class="toc-number">3.1.9.</span> <span class="toc-text">ProTable存储数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E6%80%81%E5%AF%B9%E8%AF%9D%E6%A1%86%E6%98%BE%E7%A4%BA%E6%95%B0%E6%8D%AE"><span class="toc-number">3.1.10.</span> <span class="toc-text">模态对话框显示数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F"><span class="toc-number">3.1.11.</span> <span class="toc-text">注意</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#npm%E5%AE%89%E8%A3%85"><span class="toc-number">3.2.</span> <span class="toc-text">npm安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OpenAPI%E8%BF%90%E8%A1%8C%E5%87%BA%E9%94%99"><span class="toc-number">3.3.</span> <span class="toc-text">OpenAPI运行出错</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%EF%BC%9A"><span class="toc-number">3.3.1.</span> <span class="toc-text">解决方案：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E6%B3%A8%E8%A7%A3"><span class="toc-number">3.4.</span> <span class="toc-text">常用注解</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E4%B8%AA%E4%BA%BA%E5%9B%BE%E4%B9%A6%E9%A6%86"><span class="toc-number">4.</span> <span class="toc-text">4.个人图书馆</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E9%A1%B5%E9%9D%A2%E6%A1%86%E6%9E%B6"><span class="toc-number">4.1.</span> <span class="toc-text">基本页面框架</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF"><span class="toc-number">4.1.1.</span> <span class="toc-text">后端</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A2%9E%E5%8A%A0%E6%8E%A5%E5%8F%A3"><span class="toc-number">4.1.2.</span> <span class="toc-text">增加接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Impl%E4%B8%AD%E5%AE%9E%E7%8E%B0Service"><span class="toc-number">4.1.3.</span> <span class="toc-text">Impl中实现Service</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%96%B0%E5%A2%9EBookUtils-java%E5%B0%81%E8%A3%85%E5%90%84%E7%A7%8D%E5%8A%9F%E8%83%BD"><span class="toc-number">4.1.3.1.</span> <span class="toc-text">新增BookUtils.java封装各种功能</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9C%A8BookMapper-java%E4%B8%AD%E6%B7%BB%E5%8A%A0"><span class="toc-number">4.1.3.2.</span> <span class="toc-text">在BookMapper.java中添加</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#xml%E4%B8%AD%E6%B7%BB%E5%8A%A0-1"><span class="toc-number">4.1.3.3.</span> <span class="toc-text">xml中添加</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#BookController-java%E4%B8%AD%E6%B7%BB%E5%8A%A0"><span class="toc-number">4.1.3.4.</span> <span class="toc-text">BookController.java中添加</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0BookQueryDTO-java%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2"><span class="toc-number">4.1.3.5.</span> <span class="toc-text">添加BookQueryDTO.java模糊查询</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF"><span class="toc-number">4.1.4.</span> <span class="toc-text">前端</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#routes-ts%E4%B8%AD%E6%B7%BB%E5%8A%A0%E9%A1%B5%E9%9D%A2%E8%B7%AF%E7%94%B1"><span class="toc-number">4.1.4.1.</span> <span class="toc-text">routes.ts中添加页面路由</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9C%A8-src-locales-zh-CN-menu-ts%E4%BF%AE%E6%94%B9%E7%BB%B4%E6%8A%A4%E8%8F%9C%E5%8D%95%E4%B8%AD%E6%96%87%E5%90%8D%E7%A7%B0"><span class="toc-number">4.1.4.2.</span> <span class="toc-text">在\src\locales\zh-CN\menu.ts修改维护菜单中文名称</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA-src-pages-base-book-index-tsx"><span class="toc-number">4.1.4.3.</span> <span class="toc-text">创建 \src\pages\base\book\index.tsx</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%90%E8%A1%8COpenapi"><span class="toc-number">4.1.4.4.</span> <span class="toc-text">运行Openapi</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%A1%86%E6%9E%B6%E4%BB%A3%E7%A0%81"><span class="toc-number">4.1.4.5.</span> <span class="toc-text">基本框架代码</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%8C%E6%88%90%E5%9F%BA%E6%9C%AC%E9%A1%B5%E9%9D%A2%E6%98%BE%E7%A4%BA"><span class="toc-number">4.1.4.6.</span> <span class="toc-text">完成基本页面显示</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BABook%E5%A2%9E%E5%8A%A0%E5%8A%9F%E8%83%BD"><span class="toc-number">4.2.</span> <span class="toc-text">为Book增加功能</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-1"><span class="toc-number">4.2.1.</span> <span class="toc-text">后端</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-addBook"><span class="toc-number">4.2.1.1.</span> <span class="toc-text">1.addBook</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A2%9E%E5%8A%A0%E6%8E%A5%E5%8F%A3-1"><span class="toc-number">4.2.1.2.</span> <span class="toc-text">增加接口</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#BookController-java%E4%B8%AD%E6%B7%BB%E5%8A%A0-1"><span class="toc-number">4.2.1.3.</span> <span class="toc-text">BookController.java中添加</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0BookQueryDTO-java"><span class="toc-number">4.2.1.4.</span> <span class="toc-text">添加BookQueryDTO.java</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%8C%E5%96%84Impl%E5%AE%9E%E7%8E%B0"><span class="toc-number">4.2.1.5.</span> <span class="toc-text">完善Impl实现</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%8F%8F%E8%BF%B0"><span class="toc-number">4.2.1.5.1.</span> <span class="toc-text">描述</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95"><span class="toc-number">4.2.1.5.2.</span> <span class="toc-text">测试</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-updateBook"><span class="toc-number">4.2.1.6.</span> <span class="toc-text">2.updateBook</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A2%9E%E5%8A%A0%E6%8E%A5%E5%8F%A3-2"><span class="toc-number">4.2.1.7.</span> <span class="toc-text">增加接口</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#BookController-java%E4%B8%AD%E6%B7%BB%E5%8A%A0-2"><span class="toc-number">4.2.1.8.</span> <span class="toc-text">BookController.java中添加</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%8C%E5%96%84Impl%E5%AE%9E%E7%8E%B0-1"><span class="toc-number">4.2.1.9.</span> <span class="toc-text">完善Impl实现</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%8F%8F%E8%BF%B0-1"><span class="toc-number">4.2.1.9.1.</span> <span class="toc-text">描述</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95-1"><span class="toc-number">4.2.1.9.2.</span> <span class="toc-text">测试</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-deleteByCodes"><span class="toc-number">4.2.1.10.</span> <span class="toc-text">3.deleteByCodes</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A2%9E%E5%8A%A0%E6%8E%A5%E5%8F%A3-3"><span class="toc-number">4.2.1.11.</span> <span class="toc-text">增加接口</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#BookController-java%E4%B8%AD%E6%B7%BB%E5%8A%A0-3"><span class="toc-number">4.2.1.12.</span> <span class="toc-text">BookController.java中添加</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%8C%E5%96%84Impl%E5%AE%9E%E7%8E%B0-2"><span class="toc-number">4.2.1.13.</span> <span class="toc-text">完善Impl实现</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0BookMapper-java"><span class="toc-number">4.2.1.14.</span> <span class="toc-text">添加BookMapper.java</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0BookMapper-xml"><span class="toc-number">4.2.1.15.</span> <span class="toc-text">添加BookMapper.xml</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%8F%8F%E8%BF%B0-2"><span class="toc-number">4.2.1.15.1.</span> <span class="toc-text">描述</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95-2"><span class="toc-number">4.2.1.15.2.</span> <span class="toc-text">测试</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-%E5%A4%9A%E7%A7%8D%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2"><span class="toc-number">4.2.1.16.</span> <span class="toc-text">4.多种模糊查询</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#BookQueryDTO-java"><span class="toc-number">4.2.1.17.</span> <span class="toc-text">BookQueryDTO.java</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%8C%E5%96%84Impl%E5%AE%9E%E7%8E%B0-3"><span class="toc-number">4.2.1.18.</span> <span class="toc-text">完善Impl实现</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0BookMapper-xml-1"><span class="toc-number">4.2.1.19.</span> <span class="toc-text">添加BookMapper.xml</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF-1"><span class="toc-number">4.2.2.</span> <span class="toc-text">前端</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%80%9F%E9%98%85%E6%97%A5%E5%BF%97"><span class="toc-number">4.3.</span> <span class="toc-text">借阅日志</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%80%9F%E9%98%85%E6%97%A5%E5%BF%97%E8%A1%A8"><span class="toc-number">4.3.1.</span> <span class="toc-text">借阅日志表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">4.3.2.</span> <span class="toc-text">接口设计</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%B1%95%E7%A4%BA%E9%A1%B5%E9%9D%A2"><span class="toc-number">4.3.2.1.</span> <span class="toc-text">1.展示页面</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%AE%9E%E7%8E%B0%E5%9F%BA%E7%A1%80%E5%8A%9F%E8%83%BD%EF%BC%8C%E5%88%86%E9%A1%B5%EF%BC%8C%E6%9B%B4%E6%96%B0%EF%BC%8C%E5%88%A0%E9%99%A4%E3%80%81%E5%A2%9E%E5%8A%A0"><span class="toc-number">4.3.3.</span> <span class="toc-text">1.实现基础功能，分页，更新，删除、增加</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-2"><span class="toc-number">4.3.3.1.</span> <span class="toc-text">后端</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF-2"><span class="toc-number">4.3.3.2.</span> <span class="toc-text">前端</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#index%E4%B8%BB%E9%A1%B5%E9%9D%A2"><span class="toc-number">4.3.3.2.1.</span> <span class="toc-text">index主页面</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#inputdialog%E9%A1%B5%E9%9D%A2"><span class="toc-number">4.3.3.2.2.</span> <span class="toc-text">inputdialog页面</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%BA%8F%E5%8F%B7%E5%8F%8A%E5%80%9F%E9%98%85%E6%97%A5%E6%9C%9F%E6%8E%92%E5%BA%8F"><span class="toc-number">4.3.4.</span> <span class="toc-text">2.序号及借阅日期排序</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF-3"><span class="toc-number">4.3.4.1.</span> <span class="toc-text">前端</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-3"><span class="toc-number">4.3.4.2.</span> <span class="toc-text">后端</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95-3"><span class="toc-number">4.3.4.3.</span> <span class="toc-text">测试</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%80%9F%E4%B9%A6"><span class="toc-number">4.4.</span> <span class="toc-text">借书</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1-1"><span class="toc-number">4.4.1.</span> <span class="toc-text">接口设计</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%80%9F%E4%B9%A6-1"><span class="toc-number">4.4.1.1.</span> <span class="toc-text">借书</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%AE%9E%E7%8E%B0%E5%80%9F%E4%B9%A6%E5%8A%9F%E8%83%BD"><span class="toc-number">4.4.2.</span> <span class="toc-text">1.实现借书功能</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-4"><span class="toc-number">4.4.2.1.</span> <span class="toc-text">后端</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF-4"><span class="toc-number">4.4.2.2.</span> <span class="toc-text">前端</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%B8%BB%E9%A1%B5%E9%9D%A2%E6%B7%BB%E5%8A%A0%E5%80%9F%E4%B9%A6%E5%AF%B9%E8%AF%9D%E6%A1%86"><span class="toc-number">4.4.2.2.1.</span> <span class="toc-text">主页面添加借书对话框</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%80%9F%E4%B9%A6%E6%80%9D%E8%B7%AF"><span class="toc-number">4.4.2.2.2.</span> <span class="toc-text">借书思路</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#inputdialog%E5%AF%B9%E8%AF%9D%E6%A1%86"><span class="toc-number">4.4.2.2.3.</span> <span class="toc-text">inputdialog对话框</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95-4"><span class="toc-number">4.4.2.2.4.</span> <span class="toc-text">测试</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%88%A4%E6%96%AD%E5%80%9F%E4%B9%A6%E4%B8%8D%E5%90%88%E7%90%86%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-number">4.4.3.</span> <span class="toc-text">2.判断借书不合理的操作</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-5"><span class="toc-number">4.4.3.1.</span> <span class="toc-text">后端</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF-5"><span class="toc-number">4.4.3.2.</span> <span class="toc-text">前端</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E4%B8%80%E6%AC%A1%E5%80%9F%E5%A4%9A%E6%9C%AC%E4%B9%A6"><span class="toc-number">4.4.4.</span> <span class="toc-text">3.一次借多本书</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF-6"><span class="toc-number">4.4.4.1.</span> <span class="toc-text">前端</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-6"><span class="toc-number">4.4.4.2.</span> <span class="toc-text">后端</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%98%E4%B9%A6"><span class="toc-number">4.5.</span> <span class="toc-text">还书</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF-7"><span class="toc-number">4.5.1.</span> <span class="toc-text">前端</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-7"><span class="toc-number">4.5.2.</span> <span class="toc-text">后端</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BE%E8%A1%A8%E5%B1%95%E7%A4%BA"><span class="toc-number">4.6.</span> <span class="toc-text">图表展示</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E9%97%AE%E9%A2%98"><span class="toc-number">5.</span> <span class="toc-text">5.问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2%E5%90%8E%E7%AB%AFxml%E4%BF%AE%E6%94%B9%E9%94%99%E8%AF%AF"><span class="toc-number">5.1.</span> <span class="toc-text">1.分页查询后端xml修改错误</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">5.1.1.</span> <span class="toc-text">解决方案</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8reultMap-%E6%97%B6%E5%8F%AF%E4%BB%A5%E7%94%A8-%E2%80%9CBaseResultMap%E2%80%9D"><span class="toc-number">5.1.1.1.</span> <span class="toc-text">使用reultMap 时可以用 “BaseResultMap”</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%88%96%E4%BD%BF%E7%94%A8-resultType-%E8%A6%81%E5%86%99%E7%B1%BB%E7%9A%84%E5%85%A8%E5%90%8D%EF%BC%88%E5%8C%85%E5%90%AB%E5%8C%85%E5%90%8D%EF%BC%89"><span class="toc-number">5.1.1.2.</span> <span class="toc-text">或使用 resultType 要写类的全名（包含包名）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%97%B6%E9%97%B4%E6%A0%BC%E5%BC%8F%E4%B8%8D%E6%AD%A3%E7%A1%AE"><span class="toc-number">5.2.</span> <span class="toc-text">2.时间格式不正确</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%9F%E5%9B%A0"><span class="toc-number">5.2.1.</span> <span class="toc-text">原因</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-1"><span class="toc-number">5.2.2.</span> <span class="toc-text">解决方案</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-selectedRowKeys%E5%88%A0%E9%99%A4%E9%97%AE%E9%A2%98"><span class="toc-number">5.3.</span> <span class="toc-text">3.selectedRowKeys删除问题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%9F%E5%9B%A0-1"><span class="toc-number">5.3.1.</span> <span class="toc-text">原因</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-2"><span class="toc-number">5.3.2.</span> <span class="toc-text">解决方案</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E4%BB%B7%E6%A0%BC%E4%BD%BF%E7%94%A8Decimal%E6%97%A0%E6%B3%95%E6%98%BE%E7%A4%BA"><span class="toc-number">5.4.</span> <span class="toc-text">4.价格使用Decimal无法显示</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-3"><span class="toc-number">5.4.1.</span> <span class="toc-text">解决方案</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-Mysql%E8%AE%BE%E7%BD%AE%E4%B8%BB%E9%94%AE%E8%87%AA%E5%A2%9E%EF%BC%8C%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE%E5%90%8E%EF%BC%8C%E4%B8%BB%E9%94%AEid%E4%BE%9D%E7%84%B6%E4%BB%8E%E5%88%A0%E9%99%A4%E4%BD%8D%E7%BD%AE%E5%A2%9E%E5%8A%A0"><span class="toc-number">5.5.</span> <span class="toc-text">5.Mysql设置主键自增，删除数据后，主键id依然从删除位置增加</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8D%E6%98%AF%E9%97%AE%E9%A2%98%EF%BC%8C%E6%97%A0%E9%9C%80%E8%A7%A3%E5%86%B3"><span class="toc-number">5.5.1.</span> <span class="toc-text">不是问题，无需解决</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E5%89%8D%E7%AB%AF%E6%97%A0%E6%B3%95%E5%AE%9E%E7%8E%B0%E6%9F%A5%E8%AF%A2%E4%B9%A6%E7%B1%8D"><span class="toc-number">5.6.</span> <span class="toc-text">6.前端无法实现查询书籍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%9F%E5%9B%A0-2"><span class="toc-number">5.6.1.</span> <span class="toc-text">原因</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-4"><span class="toc-number">5.6.2.</span> <span class="toc-text">解决方案</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-BookLog%E4%B8%ADlist%E6%96%B9%E6%B3%95%E6%89%A7%E8%A1%8C%E6%97%B6%E6%8A%A5%E9%94%99"><span class="toc-number">5.7.</span> <span class="toc-text">7.BookLog中list方法执行时报错</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%9F%E5%9B%A0-3"><span class="toc-number">5.7.1.</span> <span class="toc-text">原因</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-5"><span class="toc-number">5.7.2.</span> <span class="toc-text">解决方案</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-swagger%E4%B8%AD%E6%B5%8B%E8%AF%95%E5%88%A0%E9%99%A4booklog%E6%97%B6%E6%8A%A5%E9%94%99"><span class="toc-number">5.8.</span> <span class="toc-text">8.swagger中测试删除booklog时报错</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%9F%E5%9B%A0-4"><span class="toc-number">5.8.1.</span> <span class="toc-text">原因</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-6"><span class="toc-number">5.8.2.</span> <span class="toc-text">解决方案</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E9%87%8A"><span class="toc-number">5.8.3.</span> <span class="toc-text">注释</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2%EF%BC%8C%E5%A4%9A%E7%A7%8D%E6%9D%A1%E4%BB%B6%E5%90%8C%E6%97%B6%E6%9F%A5%E6%89%BE%E6%97%B6%E6%B2%A1%E6%89%BE%E5%88%B0%E5%AF%B9%E8%B1%A1%E4%BC%9A%E6%8A%A5%E9%94%99"><span class="toc-number">5.9.</span> <span class="toc-text">9.分页查询，多种条件同时查找时没找到对象会报错</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%9F%E5%9B%A0-5"><span class="toc-number">5.9.1.</span> <span class="toc-text">原因</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-7"><span class="toc-number">5.9.2.</span> <span class="toc-text">解决方案</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-%E4%B9%A6%E7%B1%8D%E7%82%B9%E5%80%9F%E9%98%85%E4%B9%8B%E5%90%8E%E7%A1%AE%E5%AE%9A%EF%BC%8C%E5%8F%91%E7%8E%B0%E4%B8%A4%E4%B8%AA%E8%A1%A8%E6%A0%BC%E4%B8%AD%E9%83%BD%E4%BC%9A%E6%9C%89%E5%AD%97%E6%AE%B5%E4%B8%A2%E5%A4%B1"><span class="toc-number">5.10.</span> <span class="toc-text">10.书籍点借阅之后确定，发现两个表格中都会有字段丢失</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%9F%E5%9B%A0-6"><span class="toc-number">5.10.1.</span> <span class="toc-text">原因</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-8"><span class="toc-number">5.10.2.</span> <span class="toc-text">解决方案</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-%E5%80%9F%E4%B9%A6%E6%97%B6%E6%97%A0%E6%B3%95%E5%90%91%E5%AF%B9%E8%AF%9D%E6%A1%86%E4%BC%A0%E9%80%92%E5%8F%82%E6%95%B0"><span class="toc-number">5.11.</span> <span class="toc-text">11.借书时无法向对话框传递参数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%9F%E5%9B%A0-7"><span class="toc-number">5.11.1.</span> <span class="toc-text">原因</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-9"><span class="toc-number">5.11.2.</span> <span class="toc-text">解决方案</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-%E5%A4%9A%E4%BD%99%E6%8E%A5%E5%8F%A3%E5%88%A0%E9%99%A4%EF%BC%88%E6%9A%82%E6%9C%AA%E8%A7%A3%E5%86%B3%EF%BC%8C%E5%90%8E%E9%9C%80%E8%80%83%E8%99%91%EF%BC%89"><span class="toc-number">5.12.</span> <span class="toc-text">12.多余接口删除（暂未解决，后需考虑）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-lendBook%E5%87%BD%E6%95%B0%E6%8A%A5%E9%94%99"><span class="toc-number">5.13.</span> <span class="toc-text">13.lendBook函数报错</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%9F%E5%9B%A0-8"><span class="toc-number">5.13.1.</span> <span class="toc-text">原因</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-10"><span class="toc-number">5.13.2.</span> <span class="toc-text">解决方案</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-%E5%80%9F%E5%87%BA%E3%80%81%E5%BD%92%E8%BF%98Assert%E4%BB%8D%E7%84%B6%E4%B8%8D%E7%AC%A6%E5%90%88%E9%80%BB%E8%BE%91"><span class="toc-number">5.14.</span> <span class="toc-text">14.借出、归还Assert仍然不符合逻辑</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%9F%E5%9B%A0-9"><span class="toc-number">5.14.1.</span> <span class="toc-text">原因</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-11"><span class="toc-number">5.14.2.</span> <span class="toc-text">解决方案</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#15-%E5%80%9F%E5%87%BA%E6%88%90%E5%8A%9F%E5%90%8E%E6%B2%A1%E6%9C%89%E6%8F%90%E7%A4%BA"><span class="toc-number">5.15.</span> <span class="toc-text">15.借出成功后没有提示</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%9F%E5%9B%A0-10"><span class="toc-number">5.15.1.</span> <span class="toc-text">原因</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-12"><span class="toc-number">5.15.2.</span> <span class="toc-text">解决方案</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E7%AC%AC%E4%B8%80%E7%A7%8D%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%EF%BC%88%E5%AE%9E%E9%99%85%E9%87%87%E7%94%A8%E6%AD%A4%E7%A7%8D%E6%96%B9%E6%A1%88%E5%AE%9E%E7%8E%B0%E6%98%BE%E7%A4%BA%E7%9A%84%E6%95%88%E6%9E%9C%EF%BC%8C%E4%BD%86%E4%B8%8D%E8%A7%84%E8%8C%83%EF%BC%89"><span class="toc-number">5.15.2.1.</span> <span class="toc-text">1.第一种解决方案（实际采用此种方案实现显示的效果，但不规范）</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E7%AC%AC%E4%BA%8C%E7%A7%8D%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%EF%BC%88%E6%9B%B4%E5%8A%A0%E6%8E%A8%E8%8D%90%EF%BC%8C%E8%A7%84%E8%8C%83%EF%BC%8C%E4%BD%86%E4%B8%8D%E7%9F%A5%E9%81%93%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0%E6%98%BE%E7%A4%BA%E6%95%88%E6%9E%9C%EF%BC%89"><span class="toc-number">5.15.3.</span> <span class="toc-text">2.第二种解决方案（更加推荐，规范，但不知道怎么实现显示效果）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#16-%E5%AF%B9%E8%AF%9D%E6%A1%86%E4%BC%A0%E9%80%92%E5%8F%82%E6%95%B0%E4%B8%8D%E5%90%8C%E6%AD%A5%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">5.16.</span> <span class="toc-text">16.对话框传递参数不同步的问题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%9F%E5%9B%A0-11"><span class="toc-number">5.16.1.</span> <span class="toc-text">原因</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-13"><span class="toc-number">5.16.2.</span> <span class="toc-text">解决方案</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#17-%E8%BF%98%E5%A4%9A%E6%9C%AC%E4%B9%A6%E6%97%B6%EF%BC%8Clog%E9%A1%B5%E9%9D%A2%E6%98%BE%E7%A4%BA%E5%8F%82%E6%95%B0%E7%BC%BA%E5%A4%B1"><span class="toc-number">5.17.</span> <span class="toc-text">17.还多本书时，log页面显示参数缺失</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%9F%E5%9B%A0-12"><span class="toc-number">5.17.1.</span> <span class="toc-text">原因</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-14"><span class="toc-number">5.17.2.</span> <span class="toc-text">解决方案</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#18-%E6%97%A0%E6%B3%95%E5%B0%86%E4%B8%BB%E9%A1%B5%E9%9D%A2%E5%90%91%E5%AF%B9%E8%AF%9D%E6%A1%86%E4%BC%A0%E9%80%92%E7%9A%84%E6%95%B0%E6%8D%AE%E6%9A%82%E5%AD%98%E7%BB%99formData"><span class="toc-number">5.18.</span> <span class="toc-text">18.无法将主页面向对话框传递的数据暂存给formData</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%9F%E5%9B%A0-13"><span class="toc-number">5.18.1.</span> <span class="toc-text">原因</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-15"><span class="toc-number">5.18.2.</span> <span class="toc-text">解决方案</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#19-%E5%9B%BE%E5%83%8F%E6%98%BE%E7%A4%BA%E4%B8%8D%E6%AD%A3%E5%B8%B8"><span class="toc-number">5.19.</span> <span class="toc-text">19.图像显示不正常</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#20-Navicat%E4%B8%8E%E5%90%8E%E7%AB%AF%E6%89%A7%E8%A1%8CMySQL%E8%AF%AD%E5%8F%A5%E7%BB%93%E6%9E%9C%E4%B8%8D%E4%B8%80%E8%87%B4"><span class="toc-number">5.20.</span> <span class="toc-text">20.Navicat与后端执行MySQL语句结果不一致</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%9F%E5%9B%A0-14"><span class="toc-number">5.20.1.</span> <span class="toc-text">原因</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-16"><span class="toc-number">5.21.</span> <span class="toc-text">解决方案</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#21-%E6%97%B6%E9%97%B4%E4%B9%B1%E5%BA%8F"><span class="toc-number">5.22.</span> <span class="toc-text">21.时间乱序</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%9F%E5%9B%A0-15"><span class="toc-number">5.22.1.</span> <span class="toc-text">原因</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-17"><span class="toc-number">5.22.2.</span> <span class="toc-text">解决方案</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-ts%E4%B8%AD%E7%9A%84%E5%BC%95%E5%8F%B7"><span class="toc-number">5.23.</span> <span class="toc-text">22.ts中的引号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#23-setXXX%E5%BC%82%E6%AD%A5%E6%9B%B4%E6%96%B0%E9%97%AE%E9%A2%98"><span class="toc-number">5.24.</span> <span class="toc-text">23. setXXX异步更新问题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-18"><span class="toc-number">5.24.1.</span> <span class="toc-text">解决方案</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#24-%E6%B3%A8%E9%87%8A%E9%97%AE%E9%A2%98"><span class="toc-number">5.25.</span> <span class="toc-text">24.注释问题</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/11/19/%E5%AE%9E%E9%AA%8C%E4%B8%80%20%E8%A7%86%E8%A7%89%E6%84%9F%E7%9F%A5%EF%BC%9A%E7%BA%A2%E7%BB%BF%E7%81%AF%E4%B8%8E%E9%94%A5%E6%A1%B6%E6%A3%80%E6%B5%8B/" title="ROS智能车（一）：视觉感知">ROS智能车（一）：视觉感知</a><time datetime="2023-11-19T09:57:11.483Z" title="发表于 2023-11-19 17:57:11">2023-11-19</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/06/30/cx-lvgl-8/" title="ESP32 LVGL（8）">ESP32 LVGL（8）</a><time datetime="2023-06-29T17:09:55.020Z" title="发表于 2023-06-30 01:09:55">2023-06-30</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/06/28/cx-lvgl-7/" title="ESP32 LVGL（7）">ESP32 LVGL（7）</a><time datetime="2023-06-28T12:51:21.217Z" title="发表于 2023-06-28 20:51:21">2023-06-28</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/06/05/ros/" title="ROS">ROS</a><time datetime="2023-06-05T06:37:45.907Z" title="发表于 2023-06-05 14:37:45">2023-06-05</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/06/04/cx-lvgl-6/" title="ESP32 LVGL（6）">ESP32 LVGL（6）</a><time datetime="2023-06-04T15:39:18.292Z" title="发表于 2023-06-04 23:39:18">2023-06-04</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2023 By Bsgbsg7</div><div class="footer_custom_text">Hi, welcome to my <a target="_blank" rel="noopener" href="https://bsgbsg7.github.io/">blog</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><a class="icon-V hidden" onclick="switchNightMode()" title="浅色和深色模式转换"><svg width="25" height="25" viewBox="0 0 1024 1024"><use id="modeicon" xlink:href="#icon-moon"></use></svg></a><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button><button id="go-down" type="button" title="直达底部" onclick="btf.scrollToDest(document.body.scrollHeight, 500)"><i class="fas fa-arrow-down"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo.szbsgbsg7.top/',
      region: '',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo.szbsgbsg7.top/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      countELement.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    const runTwikoo = () => {
      twikoo.getRecentComments({
        envId: 'https://twikoo.szbsgbsg7.top/',
        region: '',
        pageSize: 6,
        includeReply: true
      }).then(function (res) {
        const twikooArray = res.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.id,
            'date': new Date(e.created).toISOString()
          }
        })

        saveToLocal.set('twikoo-newest-comments', JSON.stringify(twikooArray), 10/(60*24))
        generateHtml(twikooArray)
      }).catch(function (err) {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.innerHTML= "无法获取评论，请确认相关配置是否正确"
      })
    }

    if (typeof twikoo === 'object') {
      runTwikoo()
    } else {
      getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(runTwikoo)
    }
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (false) {
          const name = 'src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick} / </span><time datetime="${array[i].date}">${btf.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom.innerHTML= result
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('twikoo-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script defer src="/live2d-widget-master/autoload.js"></script><div class="aplayer no-destroy" data-id="1809713120" data-server="netease" lrc-type="0" preload="auto" mutex="true" data-type="song" data-fixed="true" data-autoplay="false"> </div><script async src="/js/title.js"></script><script async src="/js/bibi.js"></script><script defer src="https://npm.elemecdn.com/jquery@latest/dist/jquery.min.js"></script><script defer data-pjax src="/js/cat.js"></script><script defer data-pjax src="/js/emoji.js"></script><script src="/js/sun_moon.js" async></script><script src="https://cdn.staticfile.org/jquery/3.6.3/jquery.min.js"></script><script async data-pjax src="/js/txmap.js"></script><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>